import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{u as s,k as r,t as a,j as n,q as l}from"./index-D0yqgRjz.js";import{a as i,L as o}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function c(e){if(!e)return null;try{return JSON.parse(e)}catch(t){return null}}function d(){const d=i(),{isAuthenticated:x}=s(),{t:u}=r(),[h,m]=t.useState([]),[p,f]=t.useState(!0),[j,v]=t.useState(0),[g,y]=t.useState(1),[b,w]=t.useState(!1);t.useEffect(()=>{x?N():d("/login")},[x,g,b]);const N=async()=>{try{f(!0);const e=await a.getNotifications({page:g,limit:20,unreadOnly:b});m(e.data.notifications||[]),v(e.data.total||0)}catch(e){}finally{f(!1)}},k=e=>{e.isRead||(async e=>{try{await a.markRead(e),m(t=>t.map(t=>t.id===e?{...t,isRead:!0}:t))}catch(t){}})(e.id);const t=c(e.metadata);"nearby_new_user"===(null==t?void 0:t.type)&&t.shareCode&&d("/u/".concat(t.shareCode))},C=(t,s)=>{const r=c(s);if("nearby_new_user"===t||"nearby_new_user"===(null==r?void 0:r.type))return(null==r?void 0:r.avatar)?e.jsx("div",{className:"w-11 h-11 rounded-full overflow-hidden ring-2 ring-pink-500/30 flex-shrink-0",children:e.jsx("img",{src:l(r.avatar),alt:"",className:"w-full h-full object-cover",onError:n})}):e.jsx("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-pink-500/20 to-orange-500/20 flex items-center justify-center flex-shrink-0 ring-2 ring-pink-500/20",children:e.jsx("span",{className:"text-xl",children:"ðŸŽ­"})});switch(t){case"system":return e.jsx("div",{className:"w-11 h-11 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})});case"warning":return e.jsx("div",{className:"w-11 h-11 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})});case"success":return e.jsx("div",{className:"w-11 h-11 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})});default:return e.jsx("div",{className:"w-11 h-11 rounded-full bg-purple-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})})}},L=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),r=Math.floor(s/6e4),a=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<1?u("notifications.justNow"):r<60?u("notifications.minutesAgo").replace("{n}",String(r)):a<24?u("notifications.hoursAgo").replace("{n}",String(a)):n<7?u("notifications.daysAgo").replace("{n}",String(n)):t.toLocaleDateString("zh-CN")},M=h.filter(e=>!e.isRead).length;return e.jsxs("div",{className:"min-h-screen",style:{background:"var(--color-bg)"},children:[e.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-xl border-b",style:{background:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{to:"https://kighub.cn/",className:"hover:opacity-80 transition",style:{color:"var(--color-text-muted)"},children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-medium",style:{color:"var(--color-text)"},children:u("notifications.title")}),M>0&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-red-500/20 text-red-400 rounded-full",children:u("notifications.unreadCount").replace("{n}",String(M))})]})]}),M>0&&e.jsx("button",{onClick:async()=>{try{await a.markAllRead(),m(e=>e.map(e=>({...e,isRead:!0})))}catch(e){}},className:"text-sm text-purple-400 hover:text-purple-300 transition px-3 py-1.5 rounded-lg hover:bg-purple-500/10",children:u("notifications.markAllRead")})]})}),e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-3 border-b",style:{borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{w(!1),y(1)},className:"px-4 py-1.5 rounded-full text-sm transition ".concat(b?"text-white/60 hover:bg-white/10":"bg-purple-500/20 text-purple-400 ring-1 ring-purple-500/30"),style:b?{color:"var(--color-text-muted)"}:{},children:u("notifications.all")}),e.jsx("button",{onClick:()=>{w(!0),y(1)},className:"px-4 py-1.5 rounded-full text-sm transition ".concat(b?"bg-purple-500/20 text-purple-400 ring-1 ring-purple-500/30":"text-white/60 hover:bg-white/10"),style:b?{}:{color:"var(--color-text-muted)"},children:u("notifications.unread")})]})}),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[p?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})}):0===h.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",style:{color:"var(--color-text-muted)"},children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-purple-500/10 flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-purple-400/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsx("p",{className:"text-base mb-1",children:u("notifications.empty")}),e.jsx("p",{className:"text-sm opacity-60",children:u("notifications.emptyHint")})]}):e.jsx("div",{className:"divide-y",style:{borderColor:"var(--color-border)"},children:h.map(t=>{const s=c(t.metadata),r=("nearby_new_user"===t.type||"nearby_new_user"===(null==s?void 0:s.type))&&(null==s?void 0:s.shareCode);return e.jsx("div",{className:"p-4 transition cursor-pointer ".concat(t.isRead?"":"bg-purple-500/5"," ").concat(r?"hover:bg-purple-500/10":"hover:bg-white/5"),onClick:()=>k(t),children:e.jsxs("div",{className:"flex gap-3",children:[C(t.type,t.metadata),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium text-sm ".concat(t.isRead?"opacity-80":""),style:{color:"var(--color-text)"},children:t.title}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:!t.isRead&&e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-purple-500 shadow-lg shadow-purple-500/30"})})]}),e.jsx("p",{className:"text-sm mt-1 whitespace-pre-wrap",style:{color:"var(--color-text-muted)"},children:t.content}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-muted)",opacity:.6},children:L(t.createdAt)}),r&&e.jsx("span",{className:"text-xs text-purple-400 flex items-center gap-1",children:u("notifications.goSee")})]})]})]})},t.id)})}),j>20&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-6",children:[e.jsx("button",{onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===g,className:"px-4 py-2 bg-white/5 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm transition",children:u("notifications.prevPage")}),e.jsxs("span",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:[g," / ",Math.ceil(j/20)]}),e.jsx("button",{onClick:()=>y(e=>e+1),disabled:g>=Math.ceil(j/20),className:"px-4 py-2 bg-white/5 hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-sm transition",children:u("notifications.nextPage")})]})]})]})}export{d as default};
