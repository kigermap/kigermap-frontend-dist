import{b as e,c as t,j as s}from"./query-DSsWWIdM.js";import{a as n}from"./sentry-DvvTOdwe.js";import{u as i,k as r,e as a,w as o}from"./index-D0yqgRjz.js";import{u as l}from"./form-1tiFI3ZP.js";import{A as c}from"./AliyunCaptcha-Drnlehh6.js";import{a as d}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function u(){var u,m,h,x,p,g,b,w,f;const{user:S,fetchUser:v}=i(),{t:j,locale:N}=r(),y=d(),[P,q]=n.useState("email"),[C,k]=n.useState(0),[T,E]=n.useState(0),[F,Q]=n.useState(null),[V,A]=n.useState(!1),[z,L]=n.useState(""),[$,R]=n.useState(null),[M,I]=n.useState(!1),{showNotification:W,NotificationComponent:B}=a({position:"center"}),{data:Z,refetch:G}=e({queryKey:["user"],queryFn:()=>o.me(),enabled:!!S}),{register:K,handleSubmit:O,formState:{errors:U},reset:D,getValues:H}=l(),{register:J,handleSubmit:X,formState:{errors:Y},reset:_,watch:ee}=l(),{register:te,handleSubmit:se,formState:{errors:ne},reset:ie,getValues:re}=l(),{register:ae,handleSubmit:oe,formState:{errors:le},reset:ce}=l({defaultValues:{qqNumber:(null==(u=null==Z?void 0:Z.data)?void 0:u.qqNumber)||""}}),de=ee("newPassword"),ue=ee("confirmPassword");n.useEffect(()=>{L(de),ue&&R(ue===de)},[de,ue]),n.useEffect(()=>{var e;(null==(e=null==Z?void 0:Z.data)?void 0:e.qqNumber)&&ce({qqNumber:Z.data.qqNumber})},[null==(m=null==Z?void 0:Z.data)?void 0:m.qqNumber,ce]);const me=t({mutationFn:({email:e,captchaVerifyParam:t})=>o.sendCode(e,t,"update-email"),onSuccess:()=>{k(60);const e=setInterval(()=>{k(t=>t<=1?(clearInterval(e),0):t-1)},1e3);W(j("accountSettings.codeSent"),"success")},onError:e=>{var t,s;W((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||j("accountSettings.sendFailed"),"error")}}),he=t({mutationFn:o.updateEmail,onSuccess:async e=>{var t,s;W((null==(t=null==e?void 0:e.data)?void 0:t.message)||j("accountSettings.emailSuccess"),"success"),D(),k(0),(null==(s=null==e?void 0:e.data)?void 0:s.requiresLogin)?setTimeout(()=>y("/login"),2e3):(await v(),await G())},onError:e=>{var t,s;W((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||j("accountSettings.emailFailed"),"error")}}),xe=t({mutationFn:o.updatePassword,onSuccess:e=>{var t,s;W((null==(t=null==e?void 0:e.data)?void 0:t.message)||j("accountSettings.passwordSuccess"),"success"),_(),(null==(s=null==e?void 0:e.data)?void 0:s.requiresLogin)&&setTimeout(()=>y("/login"),2e3)},onError:e=>{var t,s;W((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||j("accountSettings.passwordFailed"),"error")}}),pe=t({mutationFn:e=>o.sendSmsCode(e),onSuccess:()=>{E(60);const e=setInterval(()=>{E(t=>t<=1?(clearInterval(e),0):t-1)},1e3);W(j("accountSettings.smsSent"),"success")},onError:e=>{var t,s,n,i;const r=null==(s=null==(t=null==e?void 0:e.response)?void 0:t.data)?void 0:s.retryAfter;r&&r>0&&E(Math.min(r,60)),W((null==(i=null==(n=e.response)?void 0:n.data)?void 0:i.error)||j("accountSettings.sendFailed"),"error")}}),ge=t({mutationFn:o.bindPhone,onSuccess:async()=>{W(j("accountSettings.phoneSuccess"),"success"),ie(),E(0),await v(),await G()},onError:e=>{var t,s;W((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||j("accountSettings.phoneFailed"),"error")}}),be=t({mutationFn:e=>o.bindQQ(e),onSuccess:async()=>{W(j("accountSettings.qqSuccess"),"success"),await v(),await G()},onError:e=>{var t,s;W((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||j("accountSettings.qqFailed"),"error")}}),we=e=>{if(!e)return{strength:0,message:""};let t=0;e.length>=8&&(t+=1),/[A-Z]/.test(e)&&(t+=1),/[a-z]/.test(e)&&(t+=1),/[0-9]/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);return{strength:t,message:["",j("accountSettings.strengthWeak"),j("accountSettings.strengthFair"),j("accountSettings.strengthGood"),j("accountSettings.strengthStrong"),j("accountSettings.strengthVeryStrong")][t]}};return s.jsxs("div",{className:"min-h-screen bg-[#0a0a0f]",children:[s.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-purple-900/10 via-transparent to-cyan-900/10 pointer-events-none"}),B,s.jsx("div",{className:"sticky top-0 z-30 backdrop-blur-lg bg-[#0a0a0f]/80 border-b border-white/[0.06]",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>y(-1),className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("h1",{className:"text-xl font-bold text-white",children:j("accountSettings.title")})]})})}),s.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[s.jsx("div",{className:"flex gap-1 p-1 bg-white/[0.03] border border-white/[0.06] rounded-xl mb-6",children:["email","password","phone","qq"].map(e=>s.jsx("button",{onClick:()=>q(e),className:"flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ".concat(P===e?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:{email:j("accountSettings.tabEmail"),password:j("accountSettings.tabPassword"),phone:j("accountSettings.tabPhone"),qq:j("accountSettings.tabQQ")}[e]},e))}),s.jsxs("div",{className:"bg-white/[0.02] border border-white/[0.06] rounded-2xl p-6",children:["email"===P&&s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:j("accountSettings.emailTitle")}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.currentEmail")}),s.jsx("div",{className:"px-4 py-3 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:s.jsx("span",{className:"text-white",children:(null==(h=null==Z?void 0:Z.data)?void 0:h.email)||(null==S?void 0:S.email)})})]}),s.jsxs("form",{onSubmit:O(e=>he.mutate(e)),children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.newEmail")}),s.jsx("input",{type:"email",className:"w-full px-4 py-3 bg-white/[0.03] border ".concat(V?"animate-shake":""," ").concat(!1===F?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.newEmailPlaceholder"),...K("email",{required:j("accountSettings.enterEmail"),pattern:{value:/^[^@]+@[^@]+\.[^@]+$/,message:j("accountSettings.invalidEmail")},onBlur:()=>{const{email:e}=H();if(e){const t=/^[^@]+@[^@]+\.[^@]+$/.test(e);Q(t),t||(A(!0),setTimeout(()=>A(!1),500))}},onChange:()=>{const{email:e}=H();Q(e?/^[^@]+@[^@]+\.[^@]+$/.test(e):null)}})}),U.email&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:U.email.message})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.verifyCode")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"flex-1 px-4 py-3 bg-white/[0.03] border ".concat(U.verificationCode?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.verifyCodePlaceholder"),...K("verificationCode",{required:j("accountSettings.enterVerifyCode")})}),s.jsx(c,{onSuccess:async e=>{var t,s;const n=H("email");if(!n)return W(j("accountSettings.enterEmail"),"error"),{captchaVerifyResult:!0,bizResult:!1};if(C>0)return{captchaVerifyResult:!0,bizResult:!1};try{return await me.mutateAsync({email:n,captchaVerifyParam:e}),{captchaVerifyResult:!0,bizResult:!0}}catch(i){const e=null==(s=null==(t=null==i?void 0:i.response)?void 0:t.data)?void 0:s.retryAfter;throw e&&e>0&&k(Math.min(e,600)),i}},buttonText:C>0?j("accountSettings.resendAfter").replace("{n}",String(C)):me.isPending?j("accountSettings.sending"):j("accountSettings.sendCode"),buttonClassName:"px-4 py-3 rounded-xl transition-all ".concat(C>0?"bg-white/10 text-white/40 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90"),disabled:C>0||me.isPending})]}),U.verificationCode&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:U.verificationCode.message})]}),s.jsx("button",{type:"submit",disabled:he.isPending,className:"w-full py-3 rounded-xl transition-all ".concat(he.isPending?"bg-white/10 text-white/40 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90"),children:he.isPending?j("accountSettings.changing"):j("accountSettings.confirmChange")})]}),s.jsxs("div",{className:"mt-8 p-4 bg-purple-500/10 border border-purple-500/20 rounded-xl",children:[s.jsx("h3",{className:"text-sm font-medium text-purple-400 mb-2",children:j("accountSettings.securityTip")}),s.jsxs("ul",{className:"text-xs text-white/60 space-y-1",children:[s.jsxs("li",{children:["• ",j("accountSettings.emailTip1")]}),s.jsxs("li",{children:["• ",j("accountSettings.emailTip2")]}),s.jsxs("li",{children:["• ",j("accountSettings.emailTip3")]})]})]})]}),"password"===P&&s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:j("accountSettings.passwordTitle")}),s.jsxs("form",{onSubmit:X(e=>{e.newPassword===e.confirmPassword?xe.mutate({oldPassword:e.oldPassword,newPassword:e.newPassword}):W(j("accountSettings.passwordMismatch"),"error")}),children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.currentPassword")}),s.jsx("input",{type:"password",className:"w-full px-4 py-3 bg-white/[0.03] border ".concat(Y.oldPassword?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.currentPasswordPlaceholder"),...J("oldPassword",{required:j("accountSettings.enterCurrentPassword")})}),Y.oldPassword&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:Y.oldPassword.message})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.newPassword")}),s.jsx("input",{type:"password",className:"w-full px-4 py-3 bg-white/[0.03] border ".concat(Y.newPassword?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.newPasswordPlaceholder"),...J("newPassword",{required:j("accountSettings.enterNewPassword"),minLength:{value:8,message:j("accountSettings.minPassword")}})}),Y.newPassword&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:Y.newPassword.message}),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 h-1.5 bg-white/[0.1] rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all duration-300 ".concat(we(z).strength>=4?"bg-green-500":we(z).strength>=3?"bg-yellow-500":"bg-red-500"),style:{width:"".concat(we(z).strength/4*100,"%")}})}),s.jsx("span",{className:"text-xs text-white/60",children:we(z).message})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.confirmPassword")}),s.jsx("input",{type:"password",className:"w-full px-4 py-3 bg-white/[0.03] border ".concat(M?"animate-shake":""," ").concat(!1===$||Y.confirmPassword?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.confirmPasswordPlaceholder"),...J("confirmPassword",{required:j("accountSettings.enterConfirmPassword"),validate:e=>e===de||(e&&(I(!0),setTimeout(()=>I(!1),500)),j("accountSettings.passwordMismatch"))})}),Y.confirmPassword&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:Y.confirmPassword.message})]}),s.jsx("button",{type:"submit",disabled:xe.isPending,className:"w-full py-3 rounded-xl transition-all ".concat(xe.isPending?"bg-white/10 text-white/40 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90"),children:xe.isPending?j("accountSettings.changing"):j("accountSettings.confirmChange")})]}),s.jsxs("div",{className:"mt-8 p-4 bg-purple-500/10 border border-purple-500/20 rounded-xl",children:[s.jsx("h3",{className:"text-sm font-medium text-purple-400 mb-2",children:j("accountSettings.securityTip")}),s.jsxs("ul",{className:"text-xs text-white/60 space-y-1",children:[s.jsxs("li",{children:["• ",j("accountSettings.passwordTip1")]}),s.jsxs("li",{children:["• ",j("accountSettings.passwordTip2")]}),s.jsxs("li",{children:["• ",j("accountSettings.passwordTip3")]})]})]})]}),"phone"===P&&s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:j("accountSettings.phoneTitle")}),"zh-CN"!==N&&"zh-TW"!==N&&s.jsx("div",{className:"mb-4 p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl",children:s.jsx("p",{className:"text-sm text-amber-400",children:j("accountSettings.phoneNotSupported")})}),(null==(x=null==Z?void 0:Z.data)?void 0:x.phone)&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.currentPhone")}),s.jsx("div",{className:"px-4 py-3 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:s.jsx("span",{className:"text-white",children:Z.data.phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")})})]}),s.jsxs("form",{onSubmit:se(e=>ge.mutate(e)),children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:(null==(p=null==Z?void 0:Z.data)?void 0:p.phone)?j("accountSettings.newPhone"):j("accountSettings.phone")}),s.jsx("input",{type:"tel",className:"w-full px-4 py-3 bg-white/[0.03] border ".concat(ne.phone?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.phonePlaceholder"),maxLength:11,...te("phone",{required:j("accountSettings.enterPhone"),pattern:{value:/^1[3-9]\d{9}$/,message:j("accountSettings.invalidPhoneFormat")}})}),ne.phone&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:ne.phone.message})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.verifyCode")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"flex-1 px-4 py-3 bg-white/[0.03] border ".concat(ne.verificationCode?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.verifyCodePlaceholder"),maxLength:6,...te("verificationCode",{required:j("accountSettings.enterVerifyCode")})}),s.jsx("button",{type:"button",onClick:()=>{const e=re("phone");e?/^1[3-9]\d{9}$/.test(e)?T>0||pe.mutate(e):W(j("accountSettings.invalidPhone"),"error"):W(j("accountSettings.enterPhone"),"error")},disabled:T>0||pe.isPending,className:"px-4 py-3 rounded-xl transition-all whitespace-nowrap ".concat(T>0?"bg-white/10 text-white/40 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90"),children:T>0?j("accountSettings.resendAfter").replace("{n}",String(T)):pe.isPending?j("accountSettings.sending"):j("accountSettings.sendCode")})]}),ne.verificationCode&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:ne.verificationCode.message})]}),s.jsx("button",{type:"submit",disabled:ge.isPending,className:"w-full py-3 rounded-xl transition-all ".concat(ge.isPending?"bg-white/10 text-white/40 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90"),children:ge.isPending?j("accountSettings.binding"):(null==(g=null==Z?void 0:Z.data)?void 0:g.phone)?j("accountSettings.changePhone"):j("accountSettings.bindPhone")})]}),s.jsxs("div",{className:"mt-8 p-4 bg-purple-500/10 border border-purple-500/20 rounded-xl",children:[s.jsx("h3",{className:"text-sm font-medium text-purple-400 mb-2",children:j("accountSettings.phoneTip")}),s.jsxs("ul",{className:"text-xs text-white/60 space-y-1",children:[s.jsxs("li",{children:["• ",j("accountSettings.phoneTip1")]}),s.jsxs("li",{children:["• ",j("accountSettings.phoneTip2")]}),s.jsxs("li",{children:["• ",j("accountSettings.phoneTip3")]})]})]})]}),"qq"===P&&s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:j("accountSettings.qqTitle")}),(null==(b=null==Z?void 0:Z.data)?void 0:b.qqNumber)&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("accountSettings.currentQQ")}),s.jsx("div",{className:"px-4 py-3 bg-white/[0.03] rounded-xl border border-white/[0.06]",children:s.jsx("span",{className:"text-white",children:Z.data.qqNumber})})]}),s.jsxs("form",{onSubmit:oe(e=>be.mutate(e.qqNumber)),children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm text-white/60 mb-2",children:(null==(w=null==Z?void 0:Z.data)?void 0:w.qqNumber)?j("accountSettings.newQQ"):j("accountSettings.qq")}),s.jsx("input",{type:"text",className:"w-full px-4 py-3 bg-white/[0.03] border ".concat(le.qqNumber?"border-red-500":"border-white/[0.06]"," rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-white"),placeholder:j("accountSettings.qqPlaceholder"),maxLength:12,...ae("qqNumber",{required:j("accountSettings.enterQQ"),pattern:{value:/^\d{5,12}$/,message:j("accountSettings.qqFormat")}})}),le.qqNumber&&s.jsx("p",{className:"text-red-400 text-xs mt-1",children:le.qqNumber.message})]}),s.jsx("button",{type:"submit",disabled:be.isPending,className:"w-full py-3 rounded-xl transition-all ".concat(be.isPending?"bg-white/10 text-white/40 cursor-not-allowed":"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:opacity-90"),children:be.isPending?j("accountSettings.binding"):(null==(f=null==Z?void 0:Z.data)?void 0:f.qqNumber)?j("accountSettings.updateQQ"):j("accountSettings.bindQQ")})]}),s.jsxs("div",{className:"mt-8 p-4 bg-purple-500/10 border border-purple-500/20 rounded-xl",children:[s.jsx("h3",{className:"text-sm font-medium text-purple-400 mb-2",children:j("accountSettings.phoneTip")}),s.jsxs("ul",{className:"text-xs text-white/60 space-y-1",children:[s.jsxs("li",{children:["• ",j("accountSettings.qqTip1")]}),s.jsxs("li",{children:["• ",j("accountSettings.qqTip2")]})]})]})]})]})]})]})}export{u as default};
