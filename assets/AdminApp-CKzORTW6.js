import{j as e,b as s,u as t,c as a}from"./query-DSsWWIdM.js";import{u as l,l as r,b as n,e as i,g as d}from"./index-D0yqgRjz.js";import{a as c}from"./sentry-DvvTOdwe.js";import{u as o,a as x,L as m,R as p,b as h,N as g}from"./router-jbVFofSC.js";import{A as u}from"./CustomSelect-B-AWyF9k.js";import"./store-BXxpTH1V.js";const b=[{path:"/admin",label:"ä»ªè¡¨ç›˜",icon:"ðŸ“Š",roles:["admin","reviewer","ops"]},{path:"/admin/users",label:"ç”¨æˆ·ç®¡ç†",icon:"ðŸ‘¥",roles:["admin","ops"]},{path:"/admin/shops",label:"å·¥åŠç®¡ç†",icon:"ðŸª",roles:["admin","reviewer"]},{path:"/admin/images",label:"å›¾ç‰‡å®¡æ ¸",icon:"ðŸ–¼ï¸",roles:["admin","ops","reviewer"]},{path:"/admin/reports",label:"ä¸¾æŠ¥ç®¡ç†",icon:"ðŸš©",roles:["admin","ops","reviewer"]},{path:"/admin/highlights",label:"ç²¾å½©æ—¶åˆ»å®¡æ ¸",icon:"âœ¨",roles:["admin","ops","reviewer"]},{path:"/admin/feedbacks",label:"åé¦ˆç®¡ç†",icon:"ðŸ’¬",roles:["admin","ops","reviewer"]},{path:"/admin/notifications",label:"é€šçŸ¥ç®¡ç†",icon:"ðŸ””",roles:["admin","ops"]},{path:"/admin/push",label:"æŽ¨é€ç®¡ç†",icon:"ðŸ“¤",roles:["admin","ops"]},{path:"/admin/versions",label:"ç‰ˆæœ¬ç®¡ç†",icon:"ðŸ“±",roles:["admin","ops"]},{path:"/admin/security",label:"å®‰å…¨ç®¡ç†",icon:"ðŸ”’",roles:["admin","ops"]}];function y({children:s}){var t,a;const n=o(),i=x(),{user:d,logout:p}=l(),[h,g]=c.useState(!1),u=b.filter(e=>e.roles.includes((null==d?void 0:d.role)||""));return e.jsxs("div",{className:"min-h-screen bg-gray-900",children:[e.jsxs("div",{className:"lg:hidden bg-gray-800 border-b border-gray-700 px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>g(!h),className:"text-gray-400 hover:text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("span",{className:"text-white font-semibold",children:"ç®¡ç†åŽå°"}),e.jsx("div",{className:"w-6"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("aside",{className:"\n          fixed lg:static inset-y-0 left-0 z-50\n          w-64 bg-gray-800 border-r border-gray-700\n          transform transition-transform duration-200 ease-in-out\n          ".concat(h?"translate-x-0":"-translate-x-full lg:translate-x-0","\n        "),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs(m,{to:"https://kighub.cn/",className:"flex items-center gap-2 text-white",children:[e.jsx("img",{src:r,alt:"Logo",className:"w-8 h-8"}),e.jsx("span",{className:"font-bold",children:"Kigurumi Map"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"ç®¡ç†åŽå°"})]}),e.jsx("div",{className:"p-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold",children:(null==(a=null==(t=null==d?void 0:d.email)?void 0:t[0])?void 0:a.toUpperCase())||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white truncate",children:null==d?void 0:d.email}),e.jsx("p",{className:"text-xs text-purple-400",children:(y=(null==d?void 0:d.role)||"",{admin:"ç®¡ç†å‘˜",shop_owner:"å·¥åŠç®¡ç†å‘˜",reviewer:"å®¡æ ¸å‘˜",ops:"è¿ç»´"}[y]||y)})]})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:u.map(s=>e.jsxs(m,{to:s.path,onClick:()=>g(!1),className:"\n                    flex items-center gap-3 px-3 py-2 rounded-lg transition-colors\n                    ".concat(n.pathname===s.path?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white","\n                  "),children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]},s.path))}),e.jsxs("div",{className:"p-4 border-t border-gray-700 space-y-2",children:[e.jsxs(m,{to:"https://kighub.cn/",className:"flex items-center gap-3 px-3 py-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors",children:[e.jsx("span",{children:"ðŸ "}),e.jsx("span",{children:"è¿”å›žå‰å°"})]}),e.jsxs("button",{onClick:()=>{p(),i("/admin/login")},className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-red-400 hover:bg-red-900/30 transition-colors",children:[e.jsx("span",{children:"ðŸšª"}),e.jsx("span",{children:"é€€å‡ºç™»å½•"})]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>g(!1)}),e.jsx("main",{className:"flex-1 min-h-screen lg:min-h-[calc(100vh)]",children:e.jsx("div",{className:"p-4 lg:p-6",children:s})})]})]});var y}function j(){const{user:t}=l(),{data:a,isLoading:r,error:i}=s({queryKey:["admin-dashboard"],queryFn:async()=>(await n.get("/admin/dashboard")).data}),d=null==a?void 0:a.stats,c=[{label:"æ€»ç”¨æˆ·æ•°",value:(null==d?void 0:d.totalUsers)||0,icon:"ðŸ‘¥",color:"from-blue-500 to-blue-600",roles:["admin","ops"]},{label:"å·²åˆ›å»ºèµ„æ–™",value:(null==d?void 0:d.totalProfiles)||0,icon:"ðŸ“",color:"from-green-500 to-green-600",roles:["admin","ops"]},{label:"ç…§ç‰‡æ€»æ•°",value:(null==d?void 0:d.totalPhotos)||0,icon:"ðŸ“·",color:"from-cyan-500 to-cyan-600",roles:["admin","ops"]},{label:"ä»Šæ—¥æ–°å¢ž",value:(null==d?void 0:d.newUsersToday)||0,icon:"ðŸ“ˆ",color:"from-purple-500 to-purple-600",roles:["admin","ops"]},{label:"å·¥åŠæ€»æ•°",value:(null==d?void 0:d.totalShops)||0,icon:"ðŸª",color:"from-orange-500 to-orange-600",roles:["admin","reviewer","shop_owner"]},{label:"è¥ä¸šä¸­å·¥åŠ",value:(null==d?void 0:d.activeShops)||0,icon:"âœ…",color:"from-teal-500 to-teal-600",roles:["admin","reviewer","shop_owner"]},{label:"å¾…å¤„ç†åé¦ˆ",value:(null==d?void 0:d.pendingFeedbacks)||0,icon:"ðŸ’¬",color:"from-yellow-500 to-yellow-600",roles:["admin","ops","reviewer"]},{label:"å°ç¦IPæ•°",value:(null==d?void 0:d.blockedIPs)||0,icon:"ðŸš«",color:"from-red-500 to-red-600",roles:["admin","ops"]},{label:"ä»Šæ—¥ç™»å½•å¤±è´¥",value:(null==d?void 0:d.failedLoginsToday)||0,icon:"âš ï¸",color:"from-pink-500 to-pink-600",roles:["admin","ops"]}].filter(e=>e.roles.includes((null==t?void 0:t.role)||""));return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):i?e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-4 text-red-400",children:"åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ä»ªè¡¨ç›˜"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"ç³»ç»Ÿæ¦‚è§ˆå’Œç»Ÿè®¡æ•°æ®"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:c.map((s,t)=>e.jsx("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 hover:border-gray-600 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:s.label}),e.jsx("p",{className:"text-3xl font-bold text-white mt-1",children:s.value.toLocaleString()})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br ".concat(s.color," flex items-center justify-center text-2xl"),children:s.icon})]})},t))}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"å¿«æ·æ“ä½œ"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:["admin"===(null==t?void 0:t.role)||"ops"===(null==t?void 0:t.role)?e.jsxs("a",{href:"/admin/users",className:"flex flex-col items-center gap-2 p-4 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ‘¥"}),e.jsx("span",{className:"text-sm text-gray-300",children:"ç®¡ç†ç”¨æˆ·"})]}):null,"admin"===(null==t?void 0:t.role)||"reviewer"===(null==t?void 0:t.role)||"shop_owner"===(null==t?void 0:t.role)?e.jsxs("a",{href:"/admin/shops",className:"flex flex-col items-center gap-2 p-4 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"text-2xl",children:"ðŸª"}),e.jsx("span",{className:"text-sm text-gray-300",children:"ç®¡ç†å·¥åŠ"})]}):null,"admin"===(null==t?void 0:t.role)||"ops"===(null==t?void 0:t.role)||"reviewer"===(null==t?void 0:t.role)?e.jsxs("a",{href:"/admin/feedbacks",className:"flex flex-col items-center gap-2 p-4 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’¬"}),e.jsx("span",{className:"text-sm text-gray-300",children:"å¤„ç†åé¦ˆ"})]}):null,"admin"===(null==t?void 0:t.role)||"ops"===(null==t?void 0:t.role)?e.jsxs("a",{href:"/admin/security",className:"flex flex-col items-center gap-2 p-4 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”’"}),e.jsx("span",{className:"text-sm text-gray-300",children:"å®‰å…¨ç®¡ç†"})]}):null]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"ç³»ç»Ÿä¿¡æ¯"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"å½“å‰ç”¨æˆ·"}),e.jsx("span",{className:"text-white",children:null==t?void 0:t.email})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"è§’è‰²"}),e.jsxs("span",{className:"text-purple-400",children:["admin"===(null==t?void 0:t.role)&&"ç®¡ç†å‘˜","shop_owner"===(null==t?void 0:t.role)&&"å·¥åŠç®¡ç†å‘˜","reviewer"===(null==t?void 0:t.role)&&"å®¡æ ¸å‘˜","ops"===(null==t?void 0:t.role)&&"è¿ç»´"]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"ç³»ç»Ÿç‰ˆæœ¬"}),e.jsx("span",{className:"text-white",children:"v2.0.0"})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"åŽç«¯"}),e.jsx("span",{className:"text-white",children:"Go + Fiber"})]})]})]})]})}function v(){const l=t(),{showNotification:r,NotificationComponent:o}=i({position:"center"}),[x,m]=c.useState(1),[p,h]=c.useState(""),[g,b]=c.useState(""),[y,j]=c.useState(!1),[v,N]=c.useState(null),[f,w]=c.useState(!1),[k,C]=c.useState(!1),[S,P]=c.useState(!1),[I,q]=c.useState(""),[A,F]=c.useState(""),[L,U]=c.useState(""),[K,z]=c.useState([]),{data:D,isLoading:M}=s({queryKey:["admin-users",x,p,g,y],queryFn:async()=>{const e=new URLSearchParams;e.append("page",x.toString()),e.append("limit","20"),p&&e.append("search",p),g&&e.append("role",g),y&&e.append("bannedOnly","true");return(await n.get("/admin/users?".concat(e))).data}}),R=a({mutationFn:async({userId:e,roles:s})=>{await n.put("/admin/users/".concat(e,"/roles"),{roles:s})},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-users"]}),P(!1),N(null),z([])}}),T=a({mutationFn:async({userId:e,reason:s,expiresAt:t})=>{await n.post("/admin/users/".concat(e,"/ban"),{reason:s,expiresAt:t})},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-users"]}),w(!1),q(""),F(""),N(null)}}),Q=a({mutationFn:async e=>{await n.post("/admin/users/".concat(e,"/unban"))},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-users"]})}}),_=a({mutationFn:async({userId:e,newPassword:s})=>{await n.post("/admin/users/".concat(e,"/reset-password"),{newPassword:s})},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-users"]}),C(!1),U(""),N(null),r("å¯†ç å·²é‡ç½®","success")}}),B={user:"æ™®é€šç”¨æˆ·",shop_owner:"å·¥åŠç®¡ç†å‘˜",reviewer:"å®¡æ ¸å‘˜",ops:"è¿ç»´",admin:"ç®¡ç†å‘˜"},E={user:"bg-gray-600",shop_owner:"bg-blue-600",reviewer:"bg-green-600",ops:"bg-yellow-600",admin:"bg-purple-600"};return e.jsxs("div",{className:"space-y-6",children:[o,e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ç”¨æˆ·ç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"ç®¡ç†ç”¨æˆ·è´¦æˆ·ã€è§’è‰²å’Œæƒé™"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("input",{type:"text",placeholder:"æœç´¢é‚®ç®±ã€æ‰‹æœºå·æˆ–CNå...",value:p,onChange:e=>{h(e.target.value),m(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500"}),e.jsx(u,{value:g,onChange:e=>{b(e),m(1)},options:[{value:"",label:"å…¨éƒ¨è§’è‰²"},{value:"user",label:"æ™®é€šç”¨æˆ·"},{value:"shop_owner",label:"å·¥åŠç®¡ç†å‘˜"},{value:"reviewer",label:"å®¡æ ¸å‘˜"},{value:"ops",label:"è¿ç»´"},{value:"admin",label:"ç®¡ç†å‘˜"}],className:"w-36"}),e.jsxs("label",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:e=>{j(e.target.checked),m(1)},className:"w-4 h-4 rounded bg-gray-700 border-gray-600"}),"ä»…æ˜¾ç¤ºå°ç¦ç”¨æˆ·"]})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç”¨æˆ·"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"è§’è‰²"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"çŠ¶æ€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"æ³¨å†Œæ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-400",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"åŠ è½½ä¸­..."})}):0===(null==D?void 0:D.users.length)?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"æš‚æ— æ•°æ®"})}):null==D?void 0:D.users.map(s=>{var t,a;return e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar?e.jsx("img",{src:d(s.avatar),alt:"",className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center text-gray-400",children:(null==(a=null==(t=s.email||s.phone)?void 0:t[0])?void 0:a.toUpperCase())||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.cnName||"æœªè®¾ç½®"}),s.email&&e.jsx("p",{className:"text-gray-400 text-sm",children:s.email}),s.phone&&e.jsxs("p",{className:"text-gray-400 text-sm",children:["ðŸ“± ",s.phone]}),!s.email&&!s.phone&&e.jsx("p",{className:"text-gray-500 text-sm",children:"æ— è”ç³»æ–¹å¼"})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(s.roles||[s.role]).map(s=>e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium text-white ".concat(E[s]||"bg-gray-600"),children:B[s]||s},s))})}),e.jsx("td",{className:"px-4 py-3",children:s.isBanned?e.jsxs("div",{children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-red-600 text-white",children:"å·²å°ç¦"}),s.banReason&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",title:s.banReason,children:[s.banReason.slice(0,20),"..."]})]}):e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-green-600 text-white",children:"æ­£å¸¸"})}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>(e=>{N(e),z((e.roles||[e.role]).filter(e=>"admin"!==e)),P(!0)})(s),className:"px-3 py-1 text-xs bg-purple-600 hover:bg-purple-500 text-white rounded",children:"ç¼–è¾‘è§’è‰²"}),s.isBanned?e.jsx("button",{onClick:()=>Q.mutate(s.id),className:"px-3 py-1 text-xs bg-green-600 hover:bg-green-500 text-white rounded",children:"è§£å°"}):e.jsx("button",{onClick:()=>{N(s),w(!0)},className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-500 text-white rounded",children:"å°ç¦"}),e.jsx("button",{onClick:()=>{N(s),C(!0)},className:"px-3 py-1 text-xs bg-yellow-600 hover:bg-yellow-500 text-white rounded",children:"é‡ç½®å¯†ç "}),s.shareCode&&e.jsx("a",{href:"/u/".concat(s.shareCode),target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded",children:"æŸ¥çœ‹ä¸»é¡µ"})]})})]},s.id)})})]})}),D&&D.totalPages>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:1===x,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-4 py-2 text-gray-400",children:[x," / ",D.totalPages]}),e.jsx("button",{onClick:()=>m(e=>Math.min(D.totalPages,e+1)),disabled:x===D.totalPages,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]}),S&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"ç¼–è¾‘ç”¨æˆ·è§’è‰²"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["ä¸º ",v.email||v.phone," åˆ†é…è§’è‰²"]}),(v.roles||[v.role]).includes("admin")&&e.jsx("div",{className:"mb-4 p-3 bg-purple-900/30 border border-purple-700 rounded-lg",children:e.jsx("p",{className:"text-purple-300 text-sm",children:"âš ï¸ è¯¥ç”¨æˆ·æ‹¥æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œç®¡ç†å‘˜è§’è‰²æ— æ³•é€šè¿‡æ­¤ç•Œé¢ä¿®æ”¹"})}),e.jsx("div",{className:"space-y-3",children:[{value:"user",label:"æ™®é€šç”¨æˆ·",color:"bg-gray-600"},{value:"shop_owner",label:"å·¥åŠç®¡ç†å‘˜",color:"bg-blue-600"},{value:"reviewer",label:"å®¡æ ¸å‘˜",color:"bg-green-600"},{value:"ops",label:"è¿ç»´",color:"bg-yellow-600"}].map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600",children:[e.jsx("input",{type:"checkbox",checked:K.includes(s.value),onChange:()=>(e=>{K.includes(e)?z(K.filter(s=>s!==e)):z([...K,e])})(s.value),className:"w-5 h-5 rounded bg-gray-600 border-gray-500"}),e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium text-white ".concat(s.color),children:s.label})]},s.value))}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{P(!1),N(null),z([])},className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!v)return;const e=(v.roles||[v.role]).includes("admin")?[...K,"admin"]:K;(0===e.length||1===e.length&&"admin"===e[0])&&e.push("user"),R.mutate({userId:v.id,roles:e})},className:"px-4 py-2 bg-purple-600 text-white rounded-lg",children:"ä¿å­˜"})]})]})}),f&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"å°ç¦ç”¨æˆ·"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["ç¡®å®šè¦å°ç¦ ",v.email||v.phone," å—ï¼Ÿ"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"å°ç¦åŽŸå› "}),e.jsx("textarea",{value:I,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",rows:3,placeholder:"è¯·è¾“å…¥å°ç¦åŽŸå› ..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"å°ç¦å¤©æ•°ï¼ˆç•™ç©ºä¸ºæ°¸ä¹…ï¼‰"}),e.jsx("input",{type:"number",value:A,onChange:e=>F(e.target.value?Number(e.target.value):""),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"å¤©æ•°",min:1})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{w(!1),N(null),q(""),F("")},className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{if(!v||!I)return;const e=A?new Date(Date.now()+24*Number(A)*60*60*1e3).toISOString():void 0;T.mutate({userId:v.id,reason:I,expiresAt:e})},disabled:!I,className:"px-4 py-2 bg-red-600 text-white rounded-lg disabled:opacity-50",children:"ç¡®è®¤å°ç¦"})]})]})}),k&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"é‡ç½®å¯†ç "}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["ä¸º ",v.email||v.phone," è®¾ç½®æ–°å¯†ç "]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"æ–°å¯†ç "}),e.jsx("input",{type:"text",value:L,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"è‡³å°‘6ä½",minLength:6})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{C(!1),N(null),U("")},className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{!v||L.length<6||_.mutate({userId:v.id,newPassword:L})},disabled:L.length<6,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg disabled:opacity-50",children:"ç¡®è®¤é‡ç½®"})]})]})})]})}function N(){const l=t(),{showNotification:r,NotificationComponent:o}=i({position:"center"}),[x,p]=c.useState(1),[h,g]=c.useState(""),[b,y]=c.useState(""),[j,v]=c.useState(""),[N,f]=c.useState(null),[w,k]=c.useState(!1),[C,S]=c.useState(!1),[P,I]=c.useState(""),{data:q,isLoading:A}=s({queryKey:["admin-shops",x,h,b,j],queryFn:async()=>{const e=new URLSearchParams({page:x.toString(),limit:"20"});h&&e.append("search",h),b&&e.append("isActive",b),j&&e.append("isVerified",j);return(await n.get("/admin/shops?".concat(e))).data}}),{data:F,refetch:L}=s({queryKey:["shop-managers",null==N?void 0:N.id],queryFn:async()=>{if(!N)return{managers:[]};return(await n.get("/admin/shops/".concat(N.id,"/managers"))).data},enabled:!!N&&w}),{data:U}=s({queryKey:["search-users",P],queryFn:async()=>{if(!P||P.length<2)return{users:[]};return(await n.get("/admin/users?search=".concat(encodeURIComponent(P),"&limit=10"))).data},enabled:P.length>=2}),K=a({mutationFn:async({shopId:e,updates:s})=>{await n.put("/admin/shops/".concat(e,"/status"),s)},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-shops"]})}}),z=a({mutationFn:async({shopId:e,userId:s,role:t})=>{await n.post("/admin/shops/".concat(e,"/managers"),{userId:s,role:t})},onSuccess:()=>{L(),S(!1),I("")}}),D=a({mutationFn:async({shopId:e,userId:s})=>{await n.delete("/admin/shops/".concat(e,"/managers/").concat(s))},onSuccess:()=>{L()}}),M=(e,s)=>{"isVerified"!==s||e.isVerified||e.lat&&e.lng?K.mutate({shopId:e.id,updates:{[s]:!e[s]}}):r("åªæœ‰å…¬å¼€ä½ç½®çš„å·¥åŠæ‰èƒ½æˆä¸ºè®¤è¯å·¥åŠ","error")};return e.jsxs("div",{className:"space-y-6",children:[o,e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"å·¥åŠç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"ç®¡ç†å¤´å£³å·¥åŠ"})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl p-4 border border-gray-700",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),p(1)},className:"flex flex-wrap gap-4",children:[e.jsx("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"æœç´¢å·¥åŠåç§°...",className:"flex-1 min-w-[200px] px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400"}),e.jsx(u,{value:b,onChange:e=>{y(e),p(1)},options:[{value:"",label:"å…¨éƒ¨çŠ¶æ€"},{value:"true",label:"è¥ä¸šä¸­"},{value:"false",label:"å·²å…³é—­"}],className:"w-32"}),e.jsx(u,{value:j,onChange:e=>{v(e),p(1)},options:[{value:"",label:"å…¨éƒ¨è®¤è¯"},{value:"true",label:"å·²è®¤è¯"},{value:"false",label:"æœªè®¤è¯"}],className:"w-32"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"æœç´¢"})]})}),e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"å·¥åŠ"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"çŠ¶æ€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"ä½ç½®"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"ç»Ÿè®¡"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:null==q?void 0:q.shops.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/30",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.logo?e.jsx("img",{src:d(s.logo),alt:"",className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-600 flex items-center justify-center text-2xl",children:"ðŸª"}),e.jsxs("div",{children:[e.jsx(m,{to:"/edit-shop/".concat(s.slug),className:"text-white font-medium hover:text-purple-400 transition-colors",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-400",children:["/",s.slug]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full ".concat(s.isActive?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"),children:s.isActive?"è¥ä¸šä¸­":"å·²å…³é—­"}),s.isVerified&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-blue-500/20 text-blue-400",children:"å·²è®¤è¯"}),s.isFeatured&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-yellow-500/20 text-yellow-400",children:"æŽ¨è"})]})}),e.jsx("td",{className:"px-4 py-3",children:s.lat&&s.lng?e.jsx("span",{className:"text-green-400 text-sm",children:"ðŸ“ å·²å…¬å¼€"}):e.jsx("span",{className:"text-gray-500 text-sm",children:"æœªå…¬å¼€"})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-400",children:[e.jsxs("span",{children:["ðŸ‘ ",s.viewCount]}),e.jsxs("span",{className:"ml-3",children:["â¤ï¸ ",s.favoriteCount]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>(e=>{f(e),k(!0)})(s),className:"px-2 py-1 text-xs rounded bg-purple-500/20 text-purple-400 hover:bg-purple-500/30",children:"ç®¡ç†å‘˜"}),e.jsx("button",{onClick:()=>M(s,"isActive"),className:"px-2 py-1 text-xs rounded ".concat(s.isActive?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"),children:s.isActive?"å…³é—­":"å¼€å¯"}),e.jsx("button",{onClick:()=>M(s,"isVerified"),className:"px-2 py-1 text-xs rounded bg-blue-500/20 text-blue-400",title:s.lat&&s.lng?"":"éœ€è¦å…¬å¼€ä½ç½®æ‰èƒ½è®¤è¯",children:s.isVerified?"å–æ¶ˆè®¤è¯":"è®¤è¯"}),e.jsx("button",{onClick:()=>M(s,"isFeatured"),className:"px-2 py-1 text-xs rounded bg-yellow-500/20 text-yellow-400",children:s.isFeatured?"å–æ¶ˆæŽ¨è":"æŽ¨è"})]})})]},s.id))})]})}),q&&q.totalPages>1&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-700 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["å…± ",q.total," æ¡ï¼Œç¬¬ ",q.page," / ",q.totalPages," é¡µ"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(e=>Math.max(1,e-1)),disabled:1===x,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>p(e=>Math.min(q.totalPages,e+1)),disabled:x===q.totalPages,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]})]})}),w&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-white",children:[N.name," - ç®¡ç†å‘˜"]}),e.jsx("button",{onClick:()=>{k(!1),f(null)},className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-3",children:"å½“å‰ç®¡ç†å‘˜"}),0===(null==F?void 0:F.managers.length)?e.jsx("p",{className:"text-gray-500 text-sm",children:"æš‚æ— ç®¡ç†å‘˜"}):e.jsx("div",{className:"space-y-2",children:null==F?void 0:F.managers.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:s.userName||"æœªè®¾ç½®æ˜µç§°"}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.userEmail})]}),e.jsx("button",{onClick:()=>(e=>{N&&confirm("ç¡®å®šè¦ç§»é™¤ ".concat(e.userName||e.userEmail," çš„ç®¡ç†æƒé™å—ï¼Ÿ"))&&D.mutate({shopId:N.id,userId:e.userId})})(s),className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-500 text-white rounded",children:"ç§»é™¤"})]},s.id))})]}),e.jsx("button",{onClick:()=>S(!0),className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg",children:"+ æ·»åŠ ç®¡ç†å‘˜"})]})}),C&&N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"æ·»åŠ ç®¡ç†å‘˜"}),e.jsx("button",{onClick:()=>{S(!1),I("")},className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"æœç´¢ç”¨æˆ·"}),e.jsx("input",{type:"text",value:P,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"è¾“å…¥é‚®ç®±æˆ–æ˜µç§°æœç´¢..."})]}),P.length>=2&&e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:0===(null==U?void 0:U.users.length)?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"æœªæ‰¾åˆ°ç”¨æˆ·"}):null==U?void 0:U.users.map(s=>{var t,a;const l=null==F?void 0:F.managers.some(e=>e.userId===s.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar?e.jsx("img",{src:d(s.avatar),alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center text-gray-400",children:(null==(a=null==(t=s.email||s.phone)?void 0:t[0])?void 0:a.toUpperCase())||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:s.cnName||"æœªè®¾ç½®"}),e.jsx("p",{className:"text-gray-400 text-xs",children:s.email||s.phone})]})]}),l?e.jsx("span",{className:"text-gray-500 text-xs",children:"å·²æ·»åŠ "}):e.jsx("button",{onClick:()=>(e=>{N&&z.mutate({shopId:N.id,userId:e.id,role:"manager"})})(s),className:"px-3 py-1 text-xs bg-purple-600 hover:bg-purple-500 text-white rounded",children:"æ·»åŠ "})]},s.id)})})]})})]})}const f=[{value:"bug",label:"BugæŠ¥å‘Š",color:"bg-red-500"},{value:"feature",label:"åŠŸèƒ½å»ºè®®",color:"bg-blue-500"},{value:"question",label:"é—®é¢˜å’¨è¯¢",color:"bg-yellow-500"},{value:"other",label:"å…¶ä»–",color:"bg-gray-500"}],w=[{value:"pending",label:"å¾…å¤„ç†",color:"bg-yellow-500"},{value:"processing",label:"å¤„ç†ä¸­",color:"bg-blue-500"},{value:"resolved",label:"å·²è§£å†³",color:"bg-green-500"},{value:"closed",label:"å·²å…³é—­",color:"bg-gray-500"}];function k(){const l=t(),[r,i]=c.useState(1),[d,o]=c.useState(""),[x,m]=c.useState(""),[p,h]=c.useState(null),{data:g,isLoading:b}=s({queryKey:["admin-feedbacks",r,d,x],queryFn:async()=>{const e=new URLSearchParams({page:r.toString(),limit:"20"});d&&e.append("status",d),x&&e.append("type",x);return(await n.get("/admin/feedbacks?".concat(e))).data}}),y=a({mutationFn:async({feedbackId:e,status:s})=>{await n.put("/admin/feedbacks/".concat(e,"/status"),{status:s})},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-feedbacks"]}),h(null)}}),j=e=>f.find(s=>s.value===e)||f[3],v=e=>w.find(s=>s.value===e)||w[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"åé¦ˆç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"å¤„ç†ç”¨æˆ·åé¦ˆå’Œé—®é¢˜"})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl p-4 border border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(u,{value:d,onChange:e=>{o(e),i(1)},options:[{value:"",label:"å…¨éƒ¨çŠ¶æ€"},...w.map(e=>({value:e.value,label:e.label}))],className:"w-40"}),e.jsx(u,{value:x,onChange:e=>{m(e),i(1)},options:[{value:"",label:"å…¨éƒ¨ç±»åž‹"},...f.map(e=>({value:e.value,label:e.label}))],className:"w-40"})]})}),e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"divide-y divide-gray-700",children:[null==g?void 0:g.feedbacks.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-700/30 cursor-pointer",onClick:()=>h(s),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full text-white ".concat(j(s.type).color),children:j(s.type).label}),e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full text-white ".concat(v(s.status).color),children:v(s.status).label})]}),e.jsx("h3",{className:"text-white font-medium truncate",children:s.title}),e.jsx("p",{className:"text-gray-400 text-sm mt-1 line-clamp-2",children:s.content})]}),e.jsx("div",{className:"text-right text-sm text-gray-400 whitespace-nowrap",children:new Date(s.createdAt).toLocaleDateString("zh-CN")})]})},s.id)),0===(null==g?void 0:g.feedbacks.length)&&e.jsx("div",{className:"p-8 text-center text-gray-400",children:"æš‚æ— åé¦ˆ"})]}),g&&g.totalPages>1&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-700 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["å…± ",g.total," æ¡è®°å½•ï¼Œç¬¬ ",g.page," / ",g.totalPages," é¡µ"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(e=>Math.max(1,e-1)),disabled:1===r,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>i(e=>Math.min(g.totalPages,e+1)),disabled:r===g.totalPages,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"ä¸‹ä¸€é¡µ"})]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-2xl border border-gray-700 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full text-white ".concat(j(p.type).color),children:j(p.type).label}),e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full text-white ".concat(v(p.status).color),children:v(p.status).label})]}),e.jsx("button",{onClick:()=>h(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:p.title}),e.jsxs("div",{className:"text-sm text-gray-400 mb-4",children:["æäº¤æ—¶é—´ï¼š",new Date(p.createdAt).toLocaleString("zh-CN"),p.contact&&e.jsxs("span",{className:"ml-4",children:["è”ç³»æ–¹å¼ï¼š",p.contact]})]}),e.jsx("div",{className:"bg-gray-700/50 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:p.content})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm text-gray-400",children:"æ›´æ–°çŠ¶æ€"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(s=>e.jsx("button",{onClick:()=>y.mutate({feedbackId:p.id,status:s.value}),disabled:y.isPending,className:"px-4 py-2 rounded-lg text-sm transition-colors ".concat(p.status===s.value?"".concat(s.color," text-white"):"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:s.label},s.value))})]})]})})]})}const C={info:"bg-blue-500/20 text-blue-400",warning:"bg-yellow-500/20 text-yellow-400",error:"bg-red-500/20 text-red-400",critical:"bg-red-600/30 text-red-300"};function S(){var l,r,i,d,o,x;const m=t(),[p,h]=c.useState("logs"),[g,u]=c.useState(1),[b,y]=c.useState(!1),[j,v]=c.useState({ip:"",reason:"",duration:""}),N=s({queryKey:["admin-security-logs",g],queryFn:async()=>(await n.get("/admin/security/logs?page=".concat(g,"&limit=50"))).data,enabled:"logs"===p}),f=s({queryKey:["admin-blocked-ips",g],queryFn:async()=>(await n.get("/admin/security/blocked-ips?page=".concat(g,"&limit=50"))).data,enabled:"blocked-ips"===p}),w=s({queryKey:["admin-login-attempts",g],queryFn:async()=>(await n.get("/admin/security/login-attempts?page=".concat(g,"&limit=50"))).data,enabled:"login-attempts"===p}),k=s({queryKey:["admin-firewall-bans"],queryFn:async()=>(await n.get("/admin/security/firewall-bans")).data,enabled:"firewall-bans"===p,refetchInterval:3e4}),S=a({mutationFn:async e=>{await n.delete("/admin/security/blocked-ips/".concat(e))},onSuccess:()=>{m.invalidateQueries({queryKey:["admin-blocked-ips"]})}}),P=a({mutationFn:async e=>{await n.post("/admin/security/blocked-ips",e)},onSuccess:()=>{m.invalidateQueries({queryKey:["admin-blocked-ips"]}),y(!1),v({ip:"",reason:"",duration:""})}}),I=a({mutationFn:async e=>{await n.post("/admin/security/unban-firewall",{ip:e})},onSuccess:()=>{m.invalidateQueries({queryKey:["admin-firewall-bans"]}),m.invalidateQueries({queryKey:["admin-blocked-ips"]})}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"å®‰å…¨ç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"ç›‘æŽ§ç³»ç»Ÿå®‰å…¨çŠ¶æ€"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700",children:[e.jsx("div",{className:"flex border-b border-gray-700",children:[{id:"logs",label:"å®‰å…¨æ—¥å¿—",icon:"ðŸ“‹"},{id:"blocked-ips",label:"æ•°æ®åº“å°ç¦",icon:"ðŸš«"},{id:"firewall-bans",label:"é˜²ç«å¢™å°ç¦",icon:"ðŸ”¥"},{id:"login-attempts",label:"ç™»å½•è®°å½•",icon:"ðŸ”"}].map(s=>e.jsxs("button",{onClick:()=>{h(s.id),u(1)},className:"flex items-center gap-2 px-6 py-3 text-sm font-medium transition-colors ".concat(p===s.id?"text-purple-400 border-b-2 border-purple-400":"text-gray-400 hover:text-white"),children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]},s.id))}),e.jsxs("div",{className:"p-4",children:["logs"===p&&e.jsx("div",{className:"space-y-4",children:N.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:null==(l=N.data)?void 0:l.logs.map(s=>e.jsx("div",{className:"bg-gray-700/50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full ".concat(C[s.severity]||C.info),children:s.severity}),e.jsx("span",{className:"text-xs text-gray-400",children:s.type})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:s.message}),e.jsxs("div",{className:"flex gap-4 mt-1 text-xs text-gray-500",children:[s.ip&&e.jsxs("span",{children:["IP: ",s.ip]}),s.email&&e.jsxs("span",{children:["Email: ",s.email]})]})]}),e.jsx("span",{className:"text-xs text-gray-500 whitespace-nowrap",children:new Date(s.createdAt).toLocaleString("zh-CN")})]})},s.id))}),N.data&&N.data.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-700",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["å…± ",N.data.total," æ¡è®°å½•"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(e=>Math.max(1,e-1)),disabled:1===g,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>u(e=>e+1),disabled:g>=N.data.totalPages,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]})]})}),"blocked-ips"===p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"æ•°æ®åº“ä¸­çš„å°ç¦è®°å½•ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰"}),e.jsx("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"+ å°ç¦IP"})]}),f.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"IPåœ°å€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"åŽŸå› "}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"è¿‡æœŸæ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"çŠ¶æ€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:null==(r=f.data)?void 0:r.blockedIPs.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/30",children:[e.jsx("td",{className:"px-4 py-3 text-white font-mono",children:s.ip}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:s.reason}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:s.expiresAt?new Date(s.expiresAt).toLocaleString("zh-CN"):"æ°¸ä¹…"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full ".concat(s.unblocked?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:s.unblocked?"å·²è§£å°":"å°ç¦ä¸­"})}),e.jsx("td",{className:"px-4 py-3",children:!s.unblocked&&e.jsx("button",{onClick:()=>S.mutate(s.id),className:"text-green-400 hover:text-green-300 text-sm",children:"è§£å°"})})]},s.id))})]})}),f.data&&f.data.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-700",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["å…± ",f.data.total," æ¡è®°å½•"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(e=>Math.max(1,e-1)),disabled:1===g,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>u(e=>e+1),disabled:g>=f.data.totalPages,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]})]})]}),"firewall-bans"===p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"é˜²ç«å¢™å†…å­˜ä¸­çš„å®žæ—¶å°ç¦ï¼ˆæœåŠ¡é‡å¯åŽæ¸…ç©ºï¼Œå·²åŒæ­¥åˆ°æ•°æ®åº“ï¼‰"}),e.jsx("button",{onClick:()=>k.refetch(),className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors",children:"ðŸ”„ åˆ·æ–°"})]}),k.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):0===(null==(i=k.data)?void 0:i.bannedIPs.length)?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("span",{className:"text-4xl mb-4",children:"âœ…"}),e.jsx("p",{children:"å½“å‰æ²¡æœ‰è¢«é˜²ç«å¢™å°ç¦çš„IP"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"IPåœ°å€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"å°ç¦åŽŸå› "}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"å°ç¦æ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"è¿‡æœŸæ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:null==(d=k.data)?void 0:d.bannedIPs.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/30",children:[e.jsx("td",{className:"px-4 py-3 text-white font-mono",children:s.ip}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:s.reason||"æœªçŸ¥"}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.bannedAt).toLocaleString("zh-CN")}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.expiresAt).toLocaleString("zh-CN")}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>I.mutate(s.ip),disabled:I.isPending,className:"text-green-400 hover:text-green-300 text-sm disabled:opacity-50",children:I.isPending?"è§£å°ä¸­...":"è§£å°"})})]},s.ip))})]})}),e.jsx("div",{className:"pt-4 border-t border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["å…± ",(null==(o=k.data)?void 0:o.total)||0," æ¡è®°å½• Â· æ¯30ç§’è‡ªåŠ¨åˆ·æ–°"]})})]}),"login-attempts"===p&&e.jsx("div",{className:"space-y-4",children:w.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"é‚®ç®±"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"æ‰‹æœºå·"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"çŠ¶æ€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"IP"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-300",children:"æ—¶é—´"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:null==(x=w.data)?void 0:x.attempts.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/30",children:[e.jsx("td",{className:"px-4 py-3 text-white",children:s.email||"-"}),e.jsx("td",{className:"px-4 py-3 text-white",children:s.phone||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full ".concat(s.success?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:s.success?"æˆåŠŸ":"å¤±è´¥"})}),e.jsx("td",{className:"px-4 py-3 text-gray-400 font-mono text-sm",children:s.ip||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.createdAt).toLocaleString("zh-CN")})]},s.id))})]})}),w.data&&w.data.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-700",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["å…± ",w.data.total," æ¡è®°å½•"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(e=>Math.max(1,e-1)),disabled:1===g,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>u(e=>e+1),disabled:g>=w.data.totalPages,className:"px-3 py-1 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]})]})})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"å°ç¦IP"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"IPåœ°å€"}),e.jsx("input",{type:"text",value:j.ip,onChange:e=>v(s=>({...s,ip:e.target.value})),placeholder:"192.168.1.1",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"å°ç¦åŽŸå› "}),e.jsx("input",{type:"text",value:j.reason,onChange:e=>v(s=>({...s,reason:e.target.value})),placeholder:"æ¶æ„è¯·æ±‚",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"å°ç¦æ—¶é•¿ï¼ˆå°æ—¶ï¼Œç•™ç©ºä¸ºæ°¸ä¹…ï¼‰"}),e.jsx("input",{type:"number",value:j.duration,onChange:e=>v(s=>({...s,duration:e.target.value})),placeholder:"24",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 px-4 py-2 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{let e;if(j.duration){const s=parseInt(j.duration);isNaN(s)||(e=new Date(Date.now()+60*s*60*1e3).toISOString())}P.mutate({ip:j.ip,reason:j.reason,expiresAt:e})},disabled:!j.ip||!j.reason||P.isPending,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:P.isPending?"å°ç¦ä¸­...":"ç¡®è®¤å°ç¦"})]})]})]})})]})}function P(){const l=t(),[r,i]=c.useState(1),[d,o]=c.useState(!1),[x,m]=c.useState({title:"",content:"",type:"system",targetType:"all",targetRoles:[],targetUserIds:"",expiresInDays:""}),{data:p,isLoading:h}=s({queryKey:["admin-notifications",r],queryFn:async()=>(await n.get("/admin/notifications?page=".concat(r,"&limit=20"))).data}),g=a({mutationFn:async e=>{await n.post("/admin/notifications",e)},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-notifications"]}),o(!1),m({title:"",content:"",type:"system",targetType:"all",targetRoles:[],targetUserIds:"",expiresInDays:""})}}),b=a({mutationFn:async e=>{await n.delete("/admin/notifications/".concat(e))},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-notifications"]})}}),y={system:"ç³»ç»Ÿé€šçŸ¥",announcement:"å…¬å‘Š",update:"æ›´æ–°",warning:"è­¦å‘Š"},j={all:"å…¨éƒ¨ç”¨æˆ·",role:"æŒ‡å®šè§’è‰²",user:"æŒ‡å®šç”¨æˆ·"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"é€šçŸ¥ç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"å‘é€å’Œç®¡ç†ç³»ç»Ÿé€šçŸ¥"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"+"}),e.jsx("span",{children:"å‘é€é€šçŸ¥"})]})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"æ ‡é¢˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç±»åž‹"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç›®æ ‡"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"åˆ›å»ºæ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"è¿‡æœŸæ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-400",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"åŠ è½½ä¸­..."})}):0===(null==p?void 0:p.notifications.length)?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"æš‚æ— é€šçŸ¥"})}):null==p?void 0:p.notifications.map(s=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.title}),e.jsx("p",{className:"text-gray-400 text-sm truncate max-w-xs",children:s.content})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-blue-600 text-white",children:y[s.type]||s.type})}),e.jsxs("td",{className:"px-4 py-3 text-gray-400 text-sm",children:[j[s.targetType]||s.targetType,s.targetRoles&&s.targetRoles.length>0&&e.jsxs("span",{className:"ml-1",children:["(",s.targetRoles.join(", "),")"]})]}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:s.expiresAt?new Date(s.expiresAt).toLocaleString():"æ°¸ä¸è¿‡æœŸ"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡é€šçŸ¥å—ï¼Ÿ")&&b.mutate(s.id)},className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-500 text-white rounded",children:"åˆ é™¤"})})]},s.id))})]})}),p&&p.totalPages>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>i(e=>Math.max(1,e-1)),disabled:1===r,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-4 py-2 text-gray-400",children:[r," / ",p.totalPages]}),e.jsx("button",{onClick:()=>i(e=>Math.min(p.totalPages,e+1)),disabled:r===p.totalPages,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"å‘é€é€šçŸ¥"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"æ ‡é¢˜"}),e.jsx("input",{type:"text",value:x.title,onChange:e=>m({...x,title:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"é€šçŸ¥æ ‡é¢˜"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"å†…å®¹"}),e.jsx("textarea",{value:x.content,onChange:e=>m({...x,content:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",rows:4,placeholder:"é€šçŸ¥å†…å®¹..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ç±»åž‹"}),e.jsx(u,{value:x.type,onChange:e=>m({...x,type:e}),options:[{value:"system",label:"ç³»ç»Ÿé€šçŸ¥"},{value:"announcement",label:"å…¬å‘Š"},{value:"update",label:"æ›´æ–°"},{value:"warning",label:"è­¦å‘Š"}]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ç›®æ ‡ç”¨æˆ·"}),e.jsx(u,{value:x.targetType,onChange:e=>m({...x,targetType:e}),options:[{value:"all",label:"å…¨éƒ¨ç”¨æˆ·"},{value:"role",label:"æŒ‡å®šè§’è‰²"},{value:"user",label:"æŒ‡å®šç”¨æˆ·"}]})]})]}),"role"===x.targetType&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"é€‰æ‹©è§’è‰²"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"user",label:"æ™®é€šç”¨æˆ·"},{value:"shop_owner",label:"å·¥åŠç®¡ç†å‘˜"},{value:"reviewer",label:"å®¡æ ¸å‘˜"},{value:"ops",label:"è¿ç»´"},{value:"admin",label:"ç®¡ç†å‘˜"}].map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:x.targetRoles.includes(s.value),onChange:e=>{e.target.checked?m({...x,targetRoles:[...x.targetRoles,s.value]}):m({...x,targetRoles:x.targetRoles.filter(e=>e!==s.value)})},className:"w-4 h-4 rounded bg-gray-700 border-gray-600"}),s.label]},s.value))})]}),"user"===x.targetType&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ç”¨æˆ·IDï¼ˆé€—å·åˆ†éš”ï¼‰"}),e.jsx("input",{type:"text",value:x.targetUserIds,onChange:e=>m({...x,targetUserIds:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"user_id_1, user_id_2, ..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"æœ‰æ•ˆæœŸï¼ˆå¤©ï¼Œç•™ç©ºä¸ºæ°¸ä¹…ï¼‰"}),e.jsx("input",{type:"number",value:x.expiresInDays,onChange:e=>m({...x,expiresInDays:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"å¤©æ•°",min:1})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{const e={title:x.title,content:x.content,type:x.type,targetType:x.targetType};"role"===x.targetType&&x.targetRoles.length>0&&(e.targetRoles=x.targetRoles),"user"===x.targetType&&x.targetUserIds&&(e.targetUserIds=x.targetUserIds.split(",").map(e=>e.trim()).filter(Boolean)),x.expiresInDays&&(e.expiresAt=new Date(Date.now()+24*Number(x.expiresInDays)*60*60*1e3).toISOString()),g.mutate(e)},disabled:!x.title||!x.content,className:"px-4 py-2 bg-purple-600 text-white rounded-lg disabled:opacity-50",children:"å‘é€"})]})]})})]})}const I={profile:"ç”¨æˆ·èµ„æ–™",shop:"å·¥åŠ",kigurumi:"å¤´å£³",product:"äº§å“",album:"ç›¸å†Œ"},q={pending:"bg-yellow-500/20 text-yellow-400",approved:"bg-green-500/20 text-green-400",rejected:"bg-red-500/20 text-red-400",hidden:"bg-gray-500/20 text-gray-400"},A={pending:"å¾…å®¡æ ¸",approved:"å·²é€šè¿‡",rejected:"å·²ä¸‹æž¶",hidden:"å·²ä¸‹æž¶"};function F(){const[s,t]=c.useState(null);return s?e.jsx(U,{user:s,onBack:()=>t(null)}):e.jsx(L,{onSelectUser:t})}function L({onSelectUser:l}){const r=t(),{showNotification:d,NotificationComponent:o}=i({position:"center"}),[x,m]=c.useState(1),[p,h]=c.useState(""),[g,u]=c.useState("pending"),{data:b}=s({queryKey:["admin-images-stats"],queryFn:async()=>(await n.get("/admin/images/stats")).data.stats}),{data:y,isLoading:j}=s({queryKey:["admin-image-users",x,p,g],queryFn:async()=>{const e=new URLSearchParams({page:x.toString(),limit:"20"});p&&e.append("search",p),g&&e.append("filter",g);return(await n.get("/admin/images/users?".concat(e))).data}}),v=a({mutationFn:()=>n.post("/admin/images/sync"),onSuccess:()=>{r.invalidateQueries({queryKey:["admin-image-users"]}),r.invalidateQueries({queryKey:["admin-images-stats"]}),d("å›¾ç‰‡åŒæ­¥å®Œæˆ","success")}}),N=b,f=(null==y?void 0:y.users)||[];return e.jsxs("div",{className:"space-y-6",children:[o,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"å›¾ç‰‡å®¡æ ¸"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"æŒ‰ç”¨æˆ·æŸ¥çœ‹å’Œå®¡æ ¸ä¸Šä¼ çš„å›¾ç‰‡"})]}),e.jsx("button",{onClick:()=>v.mutate(),disabled:v.isPending,className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg disabled:opacity-50 text-sm",children:v.isPending?"åŒæ­¥ä¸­...":"åŒæ­¥å›¾ç‰‡"})]}),N&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-yellow-400 text-sm",children:"å¾…å®¡æ ¸"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:N.pending})]}),e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-green-400 text-sm",children:"å·²é€šè¿‡"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:N.approved})]}),e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-red-400 text-sm",children:"å·²ä¸‹æž¶"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:N.rejected+N.hidden})]}),e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-purple-400 text-sm",children:"æ€»è®¡"}),e.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:N.pending+N.approved+N.rejected+N.hidden})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsx("input",{type:"text",placeholder:"æœç´¢ç”¨æˆ·å/é‚®ç®±...",value:p,onChange:e=>{h(e.target.value),m(1)},className:"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 text-sm"}),e.jsx("div",{className:"flex gap-2",children:[{value:"pending",label:"æœ‰å¾…å®¡æ ¸"},{value:"",label:"å…¨éƒ¨ç”¨æˆ·"}].map(s=>e.jsx("button",{onClick:()=>{u(s.value),m(1)},className:"px-3 py-2 rounded-lg text-sm transition ".concat(g===s.value?"bg-purple-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"),children:s.label},s.value))})]}),j?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-purple-500"})}):0===f.length?e.jsx("div",{className:"text-center py-16 text-gray-500",children:"æš‚æ— æ•°æ®"}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsxs("div",{onClick:()=>l(s),className:"bg-gray-800/50 border border-gray-700 rounded-xl p-4 hover:bg-gray-800 cursor-pointer transition flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400 font-bold",children:(s.ownerName||"?")[0]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.ownerName||"æœªçŸ¥ç”¨æˆ·"}),e.jsx("p",{className:"text-gray-500 text-xs",children:s.ownerEmail||s.ownerId})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[s.pending>0&&e.jsxs("span",{className:"px-2.5 py-1 bg-yellow-500/20 text-yellow-400 rounded-lg font-medium",children:[s.pending," å¾…å®¡æ ¸"]}),e.jsxs("span",{className:"text-green-400",children:[s.approved," é€šè¿‡"]}),s.removed>0&&e.jsxs("span",{className:"text-red-400",children:[s.removed," ä¸‹æž¶"]}),e.jsxs("span",{className:"text-gray-500",children:["å…± ",s.total," å¼ "]}),e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},s.ownerId))}),y&&y.totalPages>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:x<=1,className:"px-3 py-1.5 bg-white/5 rounded-lg text-sm disabled:opacity-30",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-3 py-1.5 text-sm text-white/60",children:[x," / ",y.totalPages]}),e.jsx("button",{onClick:()=>m(e=>Math.min(y.totalPages,e+1)),disabled:x>=y.totalPages,className:"px-3 py-1.5 bg-white/5 rounded-lg text-sm disabled:opacity-30",children:"ä¸‹ä¸€é¡µ"})]})]})}function U({user:l,onBack:r}){const o=t(),{showNotification:x,NotificationComponent:m}=i({position:"center"}),[p,h]=c.useState([]),[g,u]=c.useState(""),[b,y]=c.useState(null),[j,v]=c.useState(null),[N,f]=c.useState(""),[w,k]=c.useState(!0),{data:C,isLoading:S}=s({queryKey:["admin-user-images",l.ownerId,g],queryFn:async()=>{const e=new URLSearchParams;g&&e.append("status",g);return(await n.get("/admin/images/users/".concat(l.ownerId,"?").concat(e))).data}}),P=(null==C?void 0:C.images)||[],F=""===g?{total:P.length,pending:P.filter(e=>"pending"===e.status).length,approved:P.filter(e=>"approved"===e.status).length,removed:P.filter(e=>"rejected"===e.status||"hidden"===e.status).length}:null,L=F?{...l,...F}:l,U=a({mutationFn:async e=>{await n.post("/admin/images/users/".concat(L.ownerId,"/approve"),{imageIds:e.length>0?e:void 0,notify:w})},onSuccess:(e,s)=>{const t=s.length||L.pending;x("å·²é€šè¿‡ ".concat(t," å¼ å›¾ç‰‡"),"success"),o.invalidateQueries({queryKey:["admin-user-images"]}),o.invalidateQueries({queryKey:["admin-image-users"]}),o.invalidateQueries({queryKey:["admin-images-stats"]}),h([]),v(null)},onError:()=>x("æ“ä½œå¤±è´¥","error")}),K=a({mutationFn:async e=>{await n.post("/admin/images/users/".concat(L.ownerId,"/remove"),{imageIds:e.length>0?e:void 0,reason:N||void 0,notify:w})},onSuccess:(e,s)=>{const t=s.length||P.length;x("å·²ä¸‹æž¶ ".concat(t," å¼ å›¾ç‰‡"),"success"),o.invalidateQueries({queryKey:["admin-user-images"]}),o.invalidateQueries({queryKey:["admin-image-users"]}),o.invalidateQueries({queryKey:["admin-images-stats"]}),h([]),v(null),f("")},onError:()=>x("æ“ä½œå¤±è´¥","error")}),z=U.isPending||K.isPending;return e.jsxs("div",{className:"space-y-6",children:[m,e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:r,className:"w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center transition",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white",children:[L.ownerName||"æœªçŸ¥ç”¨æˆ·"," çš„å›¾ç‰‡"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:L.ownerEmail||L.ownerId})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3 text-sm",children:[e.jsxs("span",{className:"text-yellow-400",children:[L.pending," å¾…å®¡æ ¸"]}),e.jsxs("span",{className:"text-green-400",children:[L.approved," å·²é€šè¿‡"]}),L.removed>0&&e.jsxs("span",{className:"text-red-400",children:[L.removed," å·²ä¸‹æž¶"]}),e.jsxs("span",{className:"text-gray-500",children:["å…± ",L.total," å¼ "]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v("approveAll"),disabled:z||0===L.pending,className:"px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg text-sm disabled:opacity-50 transition",children:"å…¨éƒ¨é€šè¿‡"}),e.jsx("button",{onClick:()=>v("removeAll"),disabled:z,className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg text-sm disabled:opacity-50 transition",children:"å…¨éƒ¨ä¸‹æž¶"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("div",{className:"flex gap-2",children:[{value:"",label:"å…¨éƒ¨"},{value:"pending",label:"å¾…å®¡æ ¸"},{value:"approved",label:"å·²é€šè¿‡"}].map(s=>e.jsx("button",{onClick:()=>{u(s.value),h([])},className:"px-3 py-1.5 rounded-lg text-sm transition ".concat(g===s.value?"bg-purple-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"),children:s.label},s.value))}),p.length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>v("approve"),disabled:z,className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white rounded-lg text-xs disabled:opacity-50",children:["é€šè¿‡é€‰ä¸­ (",p.length,")"]}),e.jsxs("button",{onClick:()=>v("remove"),disabled:z,className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white rounded-lg text-xs disabled:opacity-50",children:["ä¸‹æž¶é€‰ä¸­ (",p.length,")"]})]})]}),S?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-purple-500"})}):0===P.length?e.jsx("div",{className:"text-center py-16 text-gray-500",children:"æš‚æ— å›¾ç‰‡"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-400",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.length===P.length&&P.length>0,onChange:()=>{p.length===P.length?h([]):h(P.map(e=>e.id))},className:"w-4 h-4 rounded bg-gray-700 border-gray-600"}),"å…¨é€‰"]}),e.jsxs("span",{children:["å…± ",P.length," å¼ "]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:P.map(s=>e.jsxs("div",{className:"relative group rounded-xl overflow-hidden bg-gray-700 ".concat(p.includes(s.id)?"ring-2 ring-purple-500":""),children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:p.includes(s.id),onChange:()=>{return e=s.id,void h(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-5 h-5 rounded bg-gray-800/80 border-gray-600 cursor-pointer"})}),e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] ".concat(q[s.status]||q.pending),children:A[s.status]||s.status})}),e.jsx("div",{className:"aspect-square cursor-pointer",onClick:()=>y(s.imageUrl),children:e.jsx("img",{src:d(s.imageUrl),alt:"",className:"w-full h-full object-cover",loading:"lazy"})}),e.jsx("div",{className:"p-1.5 text-[10px] text-gray-400 truncate",children:I[s.sourceType]||s.sourceType}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex items-center justify-center gap-2",children:["approved"!==s.status&&e.jsx("button",{onClick:()=>{h([s.id]),v("approve")},className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white rounded text-xs",children:"é€šè¿‡"}),e.jsx("button",{onClick:()=>{h([s.id]),v("remove")},className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white rounded text-xs",children:"ä¸‹æž¶"})]})]},s.id))})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>!z&&v(null),children:e.jsxs("div",{className:"bg-[#1a1a24] rounded-2xl p-6 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:j.includes("approve")?"ç¡®è®¤é€šè¿‡":"ç¡®è®¤ä¸‹æž¶"}),e.jsxs("p",{className:"text-white/60 text-sm mb-4",children:["approveAll"===j&&"å°†é€šè¿‡è¯¥ç”¨æˆ·æ‰€æœ‰å¾…å®¡æ ¸å›¾ç‰‡ï¼ˆ".concat(L.pending," å¼ ï¼‰"),"removeAll"===j&&"å°†ä¸‹æž¶è¯¥ç”¨æˆ·æ‰€æœ‰å›¾ç‰‡ï¼Œå›¾ç‰‡å°†ä»Žæ•°æ®åº“å’Œ OSS ä¸­æ°¸ä¹…åˆ é™¤","approve"===j&&"å°†é€šè¿‡é€‰ä¸­çš„ ".concat(p.length," å¼ å›¾ç‰‡"),"remove"===j&&"å°†ä¸‹æž¶é€‰ä¸­çš„ ".concat(p.length," å¼ å›¾ç‰‡ï¼Œå›¾ç‰‡å°†ä»Žæ•°æ®åº“å’Œ OSS ä¸­æ°¸ä¹…åˆ é™¤")]}),j.includes("remove")&&e.jsx("textarea",{value:N,onChange:e=>f(e.target.value),placeholder:"ä¸‹æž¶åŽŸå› ï¼ˆå¯é€‰ï¼Œå°†é€šçŸ¥ç”¨æˆ·ï¼‰",className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm text-white placeholder-white/30 mb-3 resize-none",rows:2}),e.jsxs("label",{className:"flex items-center gap-2 text-white/60 text-sm mb-4 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:e=>k(e.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600"}),"é€šçŸ¥ç”¨æˆ·"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{v(null),f("")},disabled:z,className:"flex-1 py-2.5 bg-white/10 rounded-xl text-sm text-white disabled:opacity-50",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{j&&("approve"===j?U.mutate(p):"remove"===j?K.mutate(p):"approveAll"===j?U.mutate([]):"removeAll"===j&&K.mutate([]))},disabled:z,className:"flex-1 py-2.5 rounded-xl text-sm text-white font-medium disabled:opacity-50 ".concat(j.includes("remove")?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"),children:z?"å¤„ç†ä¸­...":"ç¡®è®¤"})]})]})}),b&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",onClick:()=>y(null),children:[e.jsx("button",{className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center",onClick:()=>y(null),children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("img",{src:d(b)||b,alt:"",className:"max-w-full max-h-full object-contain",onClick:e=>e.stopPropagation()})]})]})}const K={inappropriate:"ä¸å½“å†…å®¹",copyright:"ä¾µæƒå†…å®¹",spam:"åžƒåœ¾ä¿¡æ¯",other:"å…¶ä»–"},z={pending:"å¾…å¤„ç†",approved:"å·²ç¡®è®¤è¿è§„",rejected:"å·²é©³å›ž"},D={pending:"bg-yellow-500/20 text-yellow-400",approved:"bg-red-500/20 text-red-400",rejected:"bg-green-500/20 text-green-400"};function M(){const l=t(),{showNotification:r,NotificationComponent:o}=i({position:"center"}),[x,m]=c.useState(1),[p,h]=c.useState(""),[g,u]=c.useState(null),[b,y]=c.useState("approved"),[j,v]=c.useState(""),[N,f]=c.useState(null),{data:w,isLoading:k}=s({queryKey:["admin-reports",x,p],queryFn:async()=>{const e=new URLSearchParams({page:x.toString(),limit:"20"});p&&e.append("status",p);return(await n.get("/admin/reports?".concat(e))).data}}),{data:C}=s({queryKey:["admin-report-stats"],queryFn:async()=>(await n.get("/admin/reports/stats")).data.stats}),S=a({mutationFn:async({id:e,status:s,adminNote:t})=>{await n.put("/admin/reports/".concat(e),{status:s,adminNote:t})},onSuccess:()=>{l.invalidateQueries({queryKey:["admin-reports"]}),l.invalidateQueries({queryKey:["admin-report-stats"]}),r("å®¡æ ¸å®Œæˆ","success"),u(null),v("")},onError:()=>{r("æ“ä½œå¤±è´¥","error")}}),P=(null==w?void 0:w.reports)||[],I=(null==w?void 0:w.total)||0,q=(null==w?void 0:w.totalPages)||1;return e.jsxs("div",{className:"space-y-6",children:[o,e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:(null==C?void 0:C.pending)||0}),e.jsx("div",{className:"text-xs text-white/50",children:"å¾…å¤„ç†"})]}),e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:(null==C?void 0:C.approved)||0}),e.jsx("div",{className:"text-xs text-white/50",children:"å·²ç¡®è®¤è¿è§„"})]}),e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:(null==C?void 0:C.rejected)||0}),e.jsx("div",{className:"text-xs text-white/50",children:"å·²é©³å›ž"})]})]}),e.jsx("div",{className:"flex gap-2",children:["","pending","approved","rejected"].map(s=>e.jsx("button",{onClick:()=>{h(s),m(1)},className:"px-3 py-1.5 rounded-lg text-sm transition ".concat(p===s?"bg-purple-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"),children:""===s?"å…¨éƒ¨":z[s]},s))}),k?e.jsx("div",{className:"text-center py-12 text-white/50",children:"åŠ è½½ä¸­..."}):0===P.length?e.jsx("div",{className:"text-center py-12 text-white/50",children:"æš‚æ— ä¸¾æŠ¥è®°å½•"}):e.jsx("div",{className:"space-y-3",children:P.map(s=>e.jsx("div",{className:"bg-white/[0.03] border border-white/[0.08] rounded-xl p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden bg-white/5 flex-shrink-0 cursor-pointer",onClick:()=>f(s.imageUrlSigned),children:e.jsx("img",{src:d(s.imageUrlSigned)||s.imageUrlSigned,alt:"",className:"w-full h-full object-cover",onError:e=>{e.target.src=""}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-2 py-0.5 rounded text-xs ".concat(D[s.status]),children:z[s.status]}),e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-white/10 text-white/60",children:K[s.reason]||s.reason})]}),e.jsxs("div",{className:"text-sm text-white/70 space-y-0.5",children:[e.jsxs("p",{children:["ä¸¾æŠ¥äºº: ",s.reporterName||s.reporterId]}),e.jsxs("p",{children:["è¢«ä¸¾æŠ¥äºº: ",s.reportedUserName||"æœªçŸ¥"]}),e.jsx("p",{className:"text-white/40 text-xs",children:new Date(s.createdAt).toLocaleString("zh-CN")})]}),s.adminNote&&e.jsxs("p",{className:"text-xs text-white/40 mt-1",children:["å¤‡æ³¨: ",s.adminNote]})]}),"pending"===s.status&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>{u(s),y("approved")},className:"px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-xs transition",children:"ç¡®è®¤è¿è§„"}),e.jsx("button",{onClick:()=>{u(s),y("rejected")},className:"px-3 py-1.5 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg text-xs transition",children:"é©³å›ž"})]})]})},s.id))}),q>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:x<=1,className:"px-3 py-1.5 bg-white/5 rounded-lg text-sm disabled:opacity-30",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-3 py-1.5 text-sm text-white/60",children:[x," / ",q," (å…±",I,"æ¡)"]}),e.jsx("button",{onClick:()=>m(e=>Math.min(q,e+1)),disabled:x>=q,className:"px-3 py-1.5 bg-white/5 rounded-lg text-sm disabled:opacity-30",children:"ä¸‹ä¸€é¡µ"})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>u(null),children:e.jsxs("div",{className:"bg-[#1a1a24] rounded-2xl p-6 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"approved"===b?"ç¡®è®¤è¿è§„ - å°†åˆ é™¤å›¾ç‰‡å¹¶é€šçŸ¥åŒæ–¹":"é©³å›žä¸¾æŠ¥ - å°†é€šçŸ¥ä¸¾æŠ¥äºº"}),e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:d(g.imageUrlSigned)||g.imageUrlSigned,alt:"",className:"w-full max-h-48 object-contain rounded-lg bg-white/5"})}),e.jsx("textarea",{value:j,onChange:e=>v(e.target.value),placeholder:"ç®¡ç†å‘˜å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰",className:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm text-white placeholder-white/30 mb-4 resize-none",rows:2}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(null),className:"flex-1 py-2.5 bg-white/10 rounded-xl text-sm text-white",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>S.mutate({id:g.id,status:b,adminNote:j||void 0}),disabled:S.isPending,className:"flex-1 py-2.5 rounded-xl text-sm text-white font-medium ".concat("approved"===b?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"," disabled:opacity-50"),children:S.isPending?"å¤„ç†ä¸­...":"approved"===b?"ç¡®è®¤è¿è§„å¹¶åˆ é™¤":"é©³å›žä¸¾æŠ¥"})]})]})}),N&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",onClick:()=>f(null),children:[e.jsx("button",{className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center",onClick:()=>f(null),children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("img",{src:N,alt:"",className:"max-w-full max-h-full object-contain",onClick:e=>e.stopPropagation()})]})]})}function R(){var l;const r=t(),{showNotification:o,NotificationComponent:x}=i({position:"center"}),[m,p]=c.useState(1),[h,g]=c.useState("pending"),[b,y]=c.useState(!1),[j,v]=c.useState(null),[N,f]=c.useState(null),[w,k]=c.useState(null),[C,S]=c.useState(""),{data:P,isLoading:I}=s({queryKey:["admin-highlights",m,h],queryFn:async()=>{const e=new URLSearchParams({page:m.toString(),limit:"20"});h&&e.append("status",h);return(await n.get("/admin/highlights?".concat(e))).data}}),q=a({mutationFn:async({id:e,status:s,rejectReason:t})=>{await n.put("/admin/highlights/".concat(e,"/review"),{status:s,rejectReason:t})},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-highlights"]}),y(!1),k(null),S(""),o("å®¡æ ¸å®Œæˆ","success")},onError:()=>o("æ“ä½œå¤±è´¥","error")}),A=(e,s)=>{k(e),S(""),"approved"===s?q.mutate({id:e.id,status:"approved"}):y(!0)},F=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN")}catch(s){return e}},L=(null==P?void 0:P.highlights)||[],U=(null==P?void 0:P.totalPages)||1;return e.jsxs("div",{children:[x,e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ç²¾å½©æ—¶åˆ»å®¡æ ¸"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"å®¡æ ¸ç”¨æˆ·å‘å¸ƒçš„ç²¾å½©æ—¶åˆ»å†…å®¹"})]}),e.jsx("div",{className:"w-40",children:e.jsx(u,{value:h,onChange:e=>{g(e),p(1)},options:[{value:"pending",label:"å¾…å®¡æ ¸"},{value:"approved",label:"å·²é€šè¿‡"},{value:"rejected",label:"å·²æ‹’ç»"},{value:"",label:"å…¨éƒ¨"}]})})]}),I?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"})}):0===L.length?e.jsx("div",{className:"text-center py-20 text-gray-500",children:"æš‚æ— æ•°æ®"}):e.jsx("div",{className:"space-y-4",children:L.map(s=>{const t={pending:{text:"å¾…å®¡æ ¸",cls:"bg-yellow-500/20 text-yellow-400"},approved:{text:"å·²é€šè¿‡",cls:"bg-green-500/20 text-green-400"},rejected:{text:"å·²æ‹’ç»",cls:"bg-red-500/20 text-red-400"}}[a=s.status]||{text:a,cls:"bg-gray-500/20 text-gray-400"};var a;return e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsx("div",{className:"lg:w-80 flex-shrink-0 p-3",children:e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:s.photos.slice(0,6).map((s,t)=>e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>f(s),children:e.jsx("img",{src:d(s),alt:"",className:"w-full h-full object-cover"})},t))})}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"text-white font-semibold text-lg",children:s.title}),e.jsx("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium whitespace-nowrap ".concat(t.cls),children:t.text})]}),s.description&&e.jsx("p",{className:"text-gray-400 text-sm mt-2 line-clamp-2",children:s.description}),s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:s.tags.map(s=>e.jsxs("span",{className:"px-2 py-0.5 bg-purple-500/15 text-purple-400 rounded text-xs",children:["#",s]},s))}),"rejected"===s.status&&s.rejectReason&&e.jsx("div",{className:"mt-2 px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxs("p",{className:"text-red-400 text-xs",children:["æ‹’ç»åŽŸå› ï¼š",s.rejectReason]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[s.author&&e.jsxs("span",{className:"flex items-center gap-1.5",children:[s.author.avatar?e.jsx("img",{src:d(s.author.avatar),alt:"",className:"w-5 h-5 rounded-full object-cover"}):e.jsx("span",{className:"w-5 h-5 rounded-full bg-purple-600 flex items-center justify-center text-[10px] text-white",children:s.author.cnName[0]}),s.author.cnName]}),(s.city||s.province)&&e.jsxs("span",{children:["ðŸ“ ",[s.city,s.province].filter(Boolean).join(" Â· ")]}),e.jsx("span",{children:F(s.createdAt)}),e.jsxs("span",{children:["ðŸ‘ ",s.viewCount," â¤ï¸ ",s.likeCount," â­ ",s.favoriteCount]})]}),"pending"===s.status&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(s,"approved"),disabled:q.isPending,className:"px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white text-xs rounded-lg transition-colors disabled:opacity-50",children:"âœ“ é€šè¿‡"}),e.jsx("button",{onClick:()=>A(s,"rejected"),disabled:q.isPending,className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-xs rounded-lg transition-colors disabled:opacity-50",children:"âœ— æ‹’ç»"})]}),"pending"!==s.status&&e.jsx("button",{onClick:()=>v(s),className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs rounded-lg transition-colors",children:"è¯¦æƒ…"})]})]})]})},s.id)})}),U>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>p(e=>Math.max(1,e-1)),disabled:m<=1,className:"px-3 py-1.5 bg-gray-800 text-gray-300 rounded-lg text-sm disabled:opacity-40 hover:bg-gray-700",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-3 py-1.5 text-gray-400 text-sm",children:[m," / ",U]}),e.jsx("button",{onClick:()=>p(e=>Math.min(U,e+1)),disabled:m>=U,className:"px-3 py-1.5 bg-gray-800 text-gray-300 rounded-lg text-sm disabled:opacity-40 hover:bg-gray-700",children:"ä¸‹ä¸€é¡µ"})]}),b&&w&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:()=>y(!1),children:e.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-md p-6",onClick:e=>e.stopPropagation(),children:[e.jsx("h3",{className:"text-white font-semibold text-lg mb-1",children:"æ‹’ç»ç²¾å½©æ—¶åˆ»"}),e.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:["ã€Œ",w.title,"ã€"]}),e.jsx("textarea",{value:C,onChange:e=>S(e.target.value),placeholder:"è¯·è¾“å…¥æ‹’ç»åŽŸå› ...",className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm resize-none h-24 focus:outline-none focus:border-purple-500"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>y(!1),className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg text-sm hover:bg-gray-600",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{w&&C.trim()&&q.mutate({id:w.id,status:"rejected",rejectReason:C.trim()})},disabled:!C.trim()||q.isPending,className:"px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-500 disabled:opacity-50",children:q.isPending?"å¤„ç†ä¸­...":"ç¡®è®¤æ‹’ç»"})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>f(null),children:e.jsx("div",{className:"max-w-4xl max-h-[90vh] p-4",onClick:e=>e.stopPropagation(),children:e.jsx("img",{src:d(N),alt:"",className:"max-w-full max-h-[80vh] object-contain"})})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:()=>v(null),children:e.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 w-full max-w-lg p-6 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[e.jsx("h3",{className:"text-white font-semibold text-lg mb-3",children:j.title}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:j.photos.map((s,t)=>e.jsx("img",{src:d(s),alt:"",className:"w-full aspect-square object-cover rounded-lg cursor-pointer hover:opacity-80",onClick:()=>f(s)},t))}),j.description&&e.jsx("p",{className:"text-gray-400 text-sm mb-3",children:j.description}),e.jsxs("div",{className:"space-y-1.5 text-xs text-gray-500",children:[e.jsxs("p",{children:["ä½œè€…ï¼š",(null==(l=j.author)?void 0:l.cnName)||"-"]}),e.jsxs("p",{children:["ä½ç½®ï¼š",[j.city,j.province,j.country].filter(Boolean).join(" Â· ")||"-"]}),e.jsxs("p",{children:["åˆ›å»ºæ—¶é—´ï¼š",F(j.createdAt)]}),j.reviewedAt&&e.jsxs("p",{children:["å®¡æ ¸æ—¶é—´ï¼š",F(j.reviewedAt)]}),j.rejectReason&&e.jsxs("p",{className:"text-red-400",children:["æ‹’ç»åŽŸå› ï¼š",j.rejectReason]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>v(null),className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg text-sm hover:bg-gray-600",children:"å…³é—­"})})]})})]})}const T=["admin","reviewer","ops"];function Q(){const s=x(),{user:t,login:a,isLoading:n}=l(),[i,d]=c.useState(""),[o,m]=c.useState(""),[p,h]=c.useState(""),[g,u]=c.useState(!1);c.useEffect(()=>{t&&T.includes(t.role)&&s("/admin")},[t,s]);return n?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-8 border border-gray-700",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:r,alt:"Logo",className:"w-16 h-16 mx-auto"})}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ç®¡ç†åŽå°"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Kigurumi Map Admin"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),h(""),u(!0);try{await a(i,o);const e=l.getState().user;e&&T.includes(e.role)?s("/admin"):(h("æ‚¨æ²¡æœ‰æƒé™è®¿é—®ç®¡ç†åŽå°"),l.getState().logout())}catch(t){h(t.message||"ç™»å½•å¤±è´¥")}finally{u(!1)}},className:"space-y-6",children:[p&&e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-3 text-red-400 text-sm",children:p}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"é‚®ç®±"}),e.jsx("input",{type:"email",value:i,onChange:e=>d(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-colors",placeholder:"admin@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"å¯†ç "}),e.jsx("input",{type:"password",value:o,onChange:e=>m(e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-colors",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:g?"ç™»å½•ä¸­...":"ç™»å½•"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("a",{href:"/",className:"text-gray-400 hover:text-purple-400 text-sm transition-colors",children:"â† è¿”å›žé¦–é¡µ"})})]}),e.jsx("p",{className:"text-center text-gray-500 text-xs mt-4",children:"ä»…é™ç®¡ç†å‘˜ã€å®¡æ ¸å‘˜ã€è¿ç»´ç™»å½•"})]})})}function _(){var l,r,i,d,o,x;const m=t(),[p,h]=c.useState("devices"),[g,b]=c.useState(1),[y,j]=c.useState(1),[v,N]=c.useState(""),[f,w]=c.useState(!1),[k,C]=c.useState([]),[S,P]=c.useState({title:"",content:"",targetType:"all",targetIds:[],pushType:"notification",createNotification:!0}),{data:I,isLoading:q}=s({queryKey:["admin-devices",g,v],queryFn:async()=>{const e=new URLSearchParams({page:String(g),limit:"20"});v&&e.append("platform",v);return(await n.get("/admin/devices?".concat(e))).data}}),{data:A,isLoading:F}=s({queryKey:["admin-push-records",y],queryFn:async()=>(await n.get("/admin/push/records?page=".concat(y,"&limit=20"))).data}),L=a({mutationFn:async e=>(await n.post("/admin/push/send",e)).data,onSuccess:()=>{m.invalidateQueries({queryKey:["admin-push-records"]}),w(!1),P({title:"",content:"",targetType:"all",targetIds:[],pushType:"notification",createNotification:!0}),C([])},onError:e=>{var s,t;alert("æŽ¨é€å¤±è´¥: "+((null==(t=null==(s=null==e?void 0:e.response)?void 0:s.data)?void 0:t.error)||e.message))}}),U={pending:{label:"å¾…å‘é€",color:"bg-yellow-600"},sent:{label:"å·²å‘é€",color:"bg-green-600"},failed:{label:"å¤±è´¥",color:"bg-red-600"},partial:{label:"éƒ¨åˆ†æˆåŠŸ",color:"bg-orange-600"}},K={all:"å…¨éƒ¨è®¾å¤‡",user:"æŒ‡å®šç”¨æˆ·",device:"æŒ‡å®šè®¾å¤‡"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"æŽ¨é€ç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"ç®¡ç†è®¾å¤‡å’Œå‘é€æŽ¨é€é€šçŸ¥"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“¤"}),e.jsx("span",{children:"å‘é€æŽ¨é€"})]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-700 pb-2",children:[e.jsxs("button",{onClick:()=>h("devices"),className:"px-4 py-2 rounded-t-lg transition ".concat("devices"===p?"bg-purple-600 text-white":"text-gray-400 hover:text-white"),children:["è®¾å¤‡åˆ—è¡¨ (",(null==I?void 0:I.total)||0,")"]}),e.jsxs("button",{onClick:()=>h("records"),className:"px-4 py-2 rounded-t-lg transition ".concat("records"===p?"bg-purple-600 text-white":"text-gray-400 hover:text-white"),children:["æŽ¨é€è®°å½• (",(null==A?void 0:A.total)||0,")"]})]}),"devices"===p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"w-40",children:e.jsx(u,{value:v,onChange:N,options:[{value:"",label:"å…¨éƒ¨å¹³å°"},{value:"ios",label:"iOS"},{value:"android",label:"Android"}]})}),k.length>0&&e.jsxs("span",{className:"text-sm text-purple-400",children:["å·²é€‰æ‹© ",k.length," ä¸ªè®¾å¤‡"]})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:((null==(l=null==I?void 0:I.devices)?void 0:l.length)||0)>0&&(null==(r=null==I?void 0:I.devices)?void 0:r.length)===k.length,onChange:()=>{const e=(null==I?void 0:I.devices)||[];if(0===e.length)return;const s=e.map(e=>e.deviceId);C(e=>e.length===s.length?[]:s)},className:"w-4 h-4 rounded bg-gray-700 border-gray-600"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç”¨æˆ·"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"å¹³å°"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"è®¾å¤‡ä¿¡æ¯"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"æœ€åŽæ´»è·ƒ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:q?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"åŠ è½½ä¸­..."})}):0===((null==(i=null==I?void 0:I.devices)?void 0:i.length)||0)?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"æš‚æ— è®¾å¤‡"})}):null==(d=null==I?void 0:I.devices)?void 0:d.map(s=>{var t,a,l,r;return e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:k.includes(s.deviceId),onChange:()=>{return e=s.deviceId,void C(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-4 h-4 rounded bg-gray-700 border-gray-600"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white text-sm",children:(null==(a=null==(t=s.email)?void 0:t[0])?void 0:a.toUpperCase())||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:s.cnName||s.email||"æœªçŸ¥ç”¨æˆ·"}),e.jsxs("p",{className:"text-gray-500 text-xs",children:[(null==(l=s.accountId)?void 0:l.slice(0,8))||"-","..."]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("ios"===s.platform?"bg-blue-600":"bg-green-600"," text-white"),children:(null==(r=s.platform)?void 0:r.toUpperCase())||"-"})}),e.jsxs("td",{className:"px-4 py-3 text-gray-400 text-sm",children:[e.jsx("div",{children:s.deviceModel||"-"}),e.jsx("div",{className:"text-xs text-gray-500",children:s.appVersion&&"App: ".concat(s.appVersion)})]}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:s.updatedAt?new Date(s.updatedAt).toLocaleString():"-"})]},s.id)})})]})}),I&&I.totalPages>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>b(e=>Math.max(1,e-1)),disabled:1===g,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-4 py-2 text-gray-400",children:[g," / ",I.totalPages]}),e.jsx("button",{onClick:()=>b(e=>Math.min(I.totalPages,e+1)),disabled:g===I.totalPages,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]}),"records"===p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"æ ‡é¢˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç›®æ ‡"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç±»åž‹"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"çŠ¶æ€"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"å‘é€æ—¶é—´"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"åŠ è½½ä¸­..."})}):0===((null==(o=null==A?void 0:A.records)?void 0:o.length)||0)?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"æš‚æ— æŽ¨é€è®°å½•"})}):null==(x=null==A?void 0:A.records)?void 0:x.map(s=>{var t,a;return e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.title}),e.jsx("p",{className:"text-gray-400 text-sm truncate max-w-xs",children:s.content})]})}),e.jsxs("td",{className:"px-4 py-3 text-gray-400 text-sm",children:[K[s.targetType]||s.targetType,s.targetIds&&s.targetIds.length>0&&e.jsxs("span",{className:"ml-1",children:["(",s.targetIds.length,")"]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("notification"===s.pushType?"bg-purple-600":"bg-blue-600"," text-white"),children:"notification"===s.pushType?"é€šçŸ¥":"æ¶ˆæ¯"})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((null==(t=U[s.status])?void 0:t.color)||"bg-gray-600"," text-white"),children:(null==(a=U[s.status])?void 0:a.label)||s.status}),(void 0!==s.sentCount||void 0!==s.failedCount)&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["æˆåŠŸ: ",s.sentCount||0," / å¤±è´¥: ",s.failedCount||0]})]}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:new Date(s.createdAt).toLocaleString()})]},s.id)})})]})}),A&&A.totalPages>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>j(e=>Math.max(1,e-1)),disabled:1===y,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸Šä¸€é¡µ"}),e.jsxs("span",{className:"px-4 py-2 text-gray-400",children:[y," / ",A.totalPages]}),e.jsx("button",{onClick:()=>j(e=>Math.min(A.totalPages,e+1)),disabled:y===A.totalPages,className:"px-4 py-2 bg-gray-700 text-white rounded disabled:opacity-50",children:"ä¸‹ä¸€é¡µ"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"å‘é€æŽ¨é€"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"æ ‡é¢˜ *"}),e.jsx("input",{type:"text",value:S.title,onChange:e=>P({...S,title:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",placeholder:"æŽ¨é€æ ‡é¢˜"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"å†…å®¹ *"}),e.jsx("textarea",{value:S.content,onChange:e=>P({...S,content:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white",rows:4,placeholder:"æŽ¨é€å†…å®¹..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"æŽ¨é€ç±»åž‹"}),e.jsx(u,{value:S.pushType,onChange:e=>P({...S,pushType:e}),options:[{value:"notification",label:"é€šçŸ¥ï¼ˆæ˜¾ç¤ºæ¨ªå¹…ï¼‰"},{value:"message",label:"æ¶ˆæ¯ï¼ˆé™é»˜ï¼‰"}]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ç›®æ ‡èŒƒå›´"}),e.jsx(u,{value:S.targetType,onChange:e=>P({...S,targetType:e}),options:[{value:"all",label:"å…¨éƒ¨è®¾å¤‡"},{value:"device",label:"é€‰ä¸­çš„è®¾å¤‡"}]})]})]}),"device"===S.targetType&&e.jsx("div",{className:"p-3 bg-gray-700/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-400",children:k.length>0?"å·²é€‰æ‹© ".concat(k.length," ä¸ªè®¾å¤‡"):"è¯·åœ¨è®¾å¤‡åˆ—è¡¨ä¸­é€‰æ‹©è¦æŽ¨é€çš„è®¾å¤‡"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"createNotification",checked:S.createNotification,onChange:e=>P({...S,createNotification:e.target.checked}),className:"w-4 h-4 rounded bg-gray-700 border-gray-600"}),e.jsx("label",{htmlFor:"createNotification",className:"text-sm text-gray-300",children:"åŒæ—¶åˆ›å»ºç«™å†…é€šçŸ¥ï¼ˆç”¨æˆ·å¯åœ¨æ¶ˆæ¯ä¸­å¿ƒæŸ¥çœ‹ï¼‰"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 bg-gray-700 text-white rounded-lg",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:()=>{const e={...S};"device"===S.targetType&&(e.targetIds=k),L.mutate(e)},disabled:!S.title||!S.content||"device"===S.targetType&&0===k.length,className:"px-4 py-2 bg-purple-600 text-white rounded-lg disabled:opacity-50",children:L.isPending?"å‘é€ä¸­...":"å‘é€æŽ¨é€"})]})]})})]})}const B="https://gitee.com/kigermap/kigermap_app/releases/latest";function E(){const l=t(),[r,i]=c.useState(!1),[d,o]=c.useState(null),[x,m]=c.useState(null),[p,h]=c.useState({version:"",buildNumber:1,platform:"android",releaseNotes:"",downloadUrl:B,forceUpdate:!1}),[g,u]=c.useState(""),{data:b,isLoading:y}=s({queryKey:["admin-versions"],queryFn:async()=>(await n.get("/admin/versions")).data}),j=a({mutationFn:async e=>(await n.post("/admin/versions",e)).data,onSuccess:()=>{l.invalidateQueries({queryKey:["admin-versions"]}),i(!1),h({version:"",buildNumber:1,platform:"android",releaseNotes:"",downloadUrl:B,forceUpdate:!1}),u("")},onError:e=>{var s,t;u((null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.error)||"åˆ›å»ºå¤±è´¥")}}),v=a({mutationFn:async e=>(await n.put("/admin/versions/".concat(e,"/toggle"))).data,onSuccess:()=>{l.invalidateQueries({queryKey:["admin-versions"]})}}),N=a({mutationFn:async e=>(await n.delete("/admin/versions/".concat(e))).data,onSuccess:()=>{l.invalidateQueries({queryKey:["admin-versions"]}),m(null)}}),f=(null==b?void 0:b.versions)||[],w=f.filter(e=>"android"===e.platform),k=f.filter(e=>"ios"===e.platform),C=w.find(e=>e.isActive),S=k.find(e=>e.isActive);return y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ç‰ˆæœ¬ç®¡ç†"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"ç®¡ç† App ç‰ˆæœ¬å‘å¸ƒä¸Žæ›´æ–°æŽ¨é€"})]}),e.jsx("button",{onClick:()=>i(!r),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:r?"âœ• å–æ¶ˆ":"+ å‘å¸ƒæ–°ç‰ˆæœ¬"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ¤–"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:"Android å½“å‰ç‰ˆæœ¬"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"å®¢æˆ·ç«¯æ£€æµ‹åˆ°ä½ŽäºŽæ­¤ç‰ˆæœ¬å°†æç¤ºæ›´æ–°"})]})]}),C?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-green-400 font-mono",children:["v",C.version]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Build ",C.buildNumber]}),C.forceUpdate&&e.jsx("span",{className:"text-xs bg-red-900/50 text-red-300 px-2 py-0.5 rounded",children:"å¼ºåˆ¶æ›´æ–°"})]}),e.jsxs("a",{href:C.downloadUrl,target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 text-sm hover:text-purple-300 truncate block",children:["ðŸ“Ž ",C.downloadUrl]})]}):e.jsx("p",{className:"text-gray-500",children:"æš‚æœªå‘å¸ƒ"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-5 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:"iOS å½“å‰ç‰ˆæœ¬"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"å®¢æˆ·ç«¯æ£€æµ‹åˆ°ä½ŽäºŽæ­¤ç‰ˆæœ¬å°†æç¤ºæ›´æ–°"})]})]}),S?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-blue-400 font-mono",children:["v",S.version]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Build ",S.buildNumber]}),S.forceUpdate&&e.jsx("span",{className:"text-xs bg-red-900/50 text-red-300 px-2 py-0.5 rounded",children:"å¼ºåˆ¶æ›´æ–°"})]}),e.jsxs("a",{href:S.downloadUrl,target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 text-sm hover:text-purple-300 truncate block",children:["ðŸ“Ž ",S.downloadUrl]})]}):e.jsx("p",{className:"text-gray-500",children:"æš‚æœªå‘å¸ƒ"})]})]}),e.jsx("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700/50",children:e.jsxs("p",{className:"text-gray-400 text-sm",children:["ðŸ“‹ ",e.jsx("span",{className:"text-gray-300",children:"æ›´æ–°æµç¨‹ï¼š"}),"å‘å¸ƒæ–°ç‰ˆæœ¬ â†’ App å¯åŠ¨æ—¶è°ƒç”¨ ",e.jsx("code",{className:"text-purple-400 bg-gray-700 px-1 rounded",children:"/app/version/check"})," æ£€æŸ¥æ›´æ–° â†’ å¼¹çª—æç¤ºç”¨æˆ· â†’ Android åº”ç”¨å†…ä¸‹è½½å®‰è£… / iOS è·³è½¬ App Store"]})}),r&&e.jsxs("form",{onSubmit:e=>{e.preventDefault(),p.version&&p.releaseNotes&&p.downloadUrl&&!(p.buildNumber<=0)?j.mutate(p):u("è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ")},className:"bg-gray-800 rounded-xl p-6 border border-gray-700 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"å‘å¸ƒæ–°ç‰ˆæœ¬"}),e.jsx("p",{className:"text-gray-400 text-sm",children:'å‘å¸ƒåŽï¼ŒåŒå¹³å°çš„æ—§ç‰ˆæœ¬å°†è‡ªåŠ¨è®¾ä¸º"åŽ†å²ç‰ˆæœ¬"ï¼Œæ–°ç‰ˆæœ¬æˆä¸ºå½“å‰æ´»è·ƒç‰ˆæœ¬ã€‚'}),g&&e.jsx("div",{className:"text-red-400 text-sm bg-red-900/30 border border-red-500/50 rounded p-3",children:g}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"å¹³å° *"}),e.jsxs("select",{value:p.platform,onChange:e=>{const s=e.target.value;h({...p,platform:s,downloadUrl:"android"===s?B:""})},className:"w-full bg-gray-700 text-white rounded-lg px-3 py-2 border border-gray-600 focus:border-purple-500 focus:outline-none",children:[e.jsx("option",{value:"android",children:"ðŸ¤– Android"}),e.jsx("option",{value:"ios",children:"ðŸŽ iOS"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"ç‰ˆæœ¬å· *"}),e.jsx("input",{type:"text",value:p.version,onChange:e=>h({...p,version:e.target.value}),placeholder:"å¦‚ 1.2.0",className:"w-full bg-gray-700 text-white rounded-lg px-3 py-2 border border-gray-600 focus:border-purple-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1",children:["æž„å»ºå· * ",e.jsx("span",{className:"text-gray-500",children:"(pubspec.yaml ä¸­ + å·åŽçš„æ•°å­—)"})]}),e.jsx("input",{type:"number",value:p.buildNumber,onChange:e=>h({...p,buildNumber:parseInt(e.target.value)||0}),min:1,className:"w-full bg-gray-700 text-white rounded-lg px-3 py-2 border border-gray-600 focus:border-purple-500 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1",children:["ä¸‹è½½åœ°å€ * ",e.jsxs("span",{className:"text-gray-500",children:["(","android"===p.platform?"APK ç›´é“¾ï¼Œæ”¯æŒ OSS / CDN":"App Store æˆ– TestFlight é“¾æŽ¥",")"]})]}),e.jsx("input",{type:"text",value:p.downloadUrl,onChange:e=>h({...p,downloadUrl:e.target.value}),placeholder:"android"===p.platform?"https://upload.kigermap.com/apk/kigermap-v1.2.0.apk":"https://apps.apple.com/app/...",className:"w-full bg-gray-700 text-white rounded-lg px-3 py-2 border border-gray-600 focus:border-purple-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1",children:["æ›´æ–°å†…å®¹ * ",e.jsx("span",{className:"text-gray-500",children:"(å°†å±•ç¤ºåœ¨ App æ›´æ–°å¼¹çª—ä¸­)"})]}),e.jsx("textarea",{value:p.releaseNotes,onChange:e=>h({...p,releaseNotes:e.target.value}),rows:4,placeholder:"1. ä¿®å¤äº†åœ°å›¾æ‹–åŠ¨é—ªé€€é—®é¢˜\n2. æ–°å¢žæ”¶è—åŠŸèƒ½\n3. ä¼˜åŒ–æ€§èƒ½",className:"w-full bg-gray-700 text-white rounded-lg px-3 py-2 border border-gray-600 focus:border-purple-500 focus:outline-none resize-none"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.forceUpdate,onChange:e=>h({...p,forceUpdate:e.target.checked}),className:"w-4 h-4 rounded border-gray-600 text-purple-600 focus:ring-purple-500 bg-gray-700"}),e.jsx("span",{className:"text-sm text-gray-300",children:"å¼ºåˆ¶æ›´æ–°"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"ï¼ˆå¼€å¯åŽç”¨æˆ·æ— æ³•è·³è¿‡æ›´æ–°å¼¹çª—ï¼Œå¿…é¡»æ›´æ–°æ‰èƒ½ä½¿ç”¨ï¼‰"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",disabled:j.isPending,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:j.isPending?"å‘å¸ƒä¸­...":"ç¡®è®¤å‘å¸ƒ"})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-white font-semibold",children:"ç‰ˆæœ¬åŽ†å²"}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["å…± ",f.length," ä¸ªç‰ˆæœ¬"]})]}),0===f.length?e.jsxs("div",{className:"text-center text-gray-500 py-16",children:[e.jsx("p",{className:"text-4xl mb-3",children:"ðŸ“±"}),e.jsx("p",{children:"æš‚æ— ç‰ˆæœ¬è®°å½•"}),e.jsx("p",{className:"text-sm mt-1",children:'ç‚¹å‡»"å‘å¸ƒæ–°ç‰ˆæœ¬"å¼€å§‹'})]}):e.jsx("div",{className:"divide-y divide-gray-700/50",children:f.map(s=>e.jsxs("div",{className:"px-4 py-4 hover:bg-gray-700/20 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium ".concat("ios"===s.platform?"bg-blue-900/50 text-blue-300":"bg-green-900/50 text-green-300"),children:"ios"===s.platform?"ðŸŽ iOS":"ðŸ¤– Android"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-white font-mono font-semibold",children:["v",s.version]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["Build ",s.buildNumber]}),s.forceUpdate&&e.jsx("span",{className:"text-xs bg-red-900/50 text-red-300 px-1.5 py-0.5 rounded",children:"å¼ºåˆ¶"}),s.isActive&&e.jsx("span",{className:"text-xs bg-green-900/50 text-green-300 px-1.5 py-0.5 rounded",children:"å½“å‰ç‰ˆæœ¬"}),!s.isActive&&e.jsx("span",{className:"text-xs bg-gray-700 text-gray-400 px-1.5 py-0.5 rounded",children:"åŽ†å²"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("span",{className:"text-gray-500 text-xs",children:s.createdByEmail||"ç³»ç»Ÿ"}),e.jsx("span",{className:"text-gray-600 text-xs",children:"Â·"}),e.jsx("span",{className:"text-gray-500 text-xs",children:new Date(s.createdAt).toLocaleString("zh-CN")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(d===s.id?null:s.id),className:"px-3 py-1.5 text-xs text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors",title:"æŸ¥çœ‹è¯¦æƒ…",children:d===s.id?"æ”¶èµ·":"è¯¦æƒ…"}),e.jsx("button",{onClick:()=>v.mutate(s.id),disabled:v.isPending,className:"px-3 py-1.5 text-xs rounded-lg transition-colors ".concat(s.isActive?"text-yellow-400 bg-yellow-900/30 hover:bg-yellow-900/50":"text-green-400 bg-green-900/30 hover:bg-green-900/50"),title:s.isActive?"åœç”¨æ­¤ç‰ˆæœ¬":"å¯ç”¨æ­¤ç‰ˆæœ¬",children:s.isActive?"åœç”¨":"å¯ç”¨"}),x===s.id?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>N.mutate(s.id),disabled:N.isPending,className:"px-3 py-1.5 text-xs text-red-400 bg-red-900/50 hover:bg-red-900/70 rounded-lg transition-colors",children:"ç¡®è®¤åˆ é™¤"}),e.jsx("button",{onClick:()=>m(null),className:"px-2 py-1.5 text-xs text-gray-400 hover:text-white transition-colors",children:"å–æ¶ˆ"})]}):e.jsx("button",{onClick:()=>m(s.id),className:"px-3 py-1.5 text-xs text-red-400 bg-red-900/20 hover:bg-red-900/40 rounded-lg transition-colors",title:"åˆ é™¤ç‰ˆæœ¬",children:"åˆ é™¤"})]})]}),d===s.id&&e.jsxs("div",{className:"mt-3 ml-[72px] space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"æ›´æ–°å†…å®¹"}),e.jsx("div",{className:"bg-gray-900/50 rounded-lg p-3 text-sm text-gray-300 whitespace-pre-wrap",children:s.releaseNotes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"ä¸‹è½½åœ°å€"}),e.jsx("a",{href:s.downloadUrl,target:"_blank",rel:"noopener noreferrer",className:"text-purple-400 text-sm hover:text-purple-300 break-all",children:s.downloadUrl})]})]})]},s.id))})]})]})}const O=["admin","reviewer","ops"];function V({children:s}){const{user:t,isInitialized:a}=l();return a?t&&O.includes(t.role)?e.jsx(e.Fragment,{children:s}):e.jsx(g,{to:"/admin/login",replace:!0}):e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})})}function W(){return e.jsxs(p,{children:[e.jsx(h,{path:"login",element:e.jsx(Q,{})}),e.jsx(h,{path:"/*",element:e.jsx(V,{children:e.jsx(y,{children:e.jsxs(p,{children:[e.jsx(h,{index:!0,element:e.jsx(j,{})}),e.jsx(h,{path:"users",element:e.jsx(v,{})}),e.jsx(h,{path:"shops",element:e.jsx(N,{})}),e.jsx(h,{path:"feedbacks",element:e.jsx(k,{})}),e.jsx(h,{path:"notifications",element:e.jsx(P,{})}),e.jsx(h,{path:"push",element:e.jsx(_,{})}),e.jsx(h,{path:"versions",element:e.jsx(E,{})}),e.jsx(h,{path:"security",element:e.jsx(S,{})}),e.jsx(h,{path:"images",element:e.jsx(F,{})}),e.jsx(h,{path:"reports",element:e.jsx(M,{})}),e.jsx(h,{path:"highlights",element:e.jsx(R,{})}),e.jsx(h,{path:"*",element:e.jsx(g,{to:"/admin",replace:!0})})]})})})})]})}export{W as default};
