import{j as t}from"./query-DSsWWIdM.js";import{a as e}from"./sentry-DvvTOdwe.js";import{k as s}from"./index-D0yqgRjz.js";import{L as r}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";const o=[{type:"normal",icon:"âœï¸",labelKey:"tools.photoEditor.brushNormal"},{type:"marker",icon:"ðŸ–Šï¸",labelKey:"tools.photoEditor.brushMarker"},{type:"neon",icon:"âœ¨",labelKey:"tools.photoEditor.brushNeon"},{type:"graffiti",icon:"ðŸ¤Ÿ",labelKey:"tools.photoEditor.brushGraffiti"},{type:"crayon",icon:"ðŸ–ï¸",labelKey:"tools.photoEditor.brushCrayon"},{type:"dotted",icon:"âš¬",labelKey:"tools.photoEditor.brushDotted"},{type:"calligraphy",icon:"ðŸ–Œï¸",labelKey:"tools.photoEditor.brushCalligraphy"},{type:"spray",icon:"ðŸ’¨",labelKey:"tools.photoEditor.brushSpray"},{type:"eraser",icon:"ðŸ§¹",labelKey:"tools.photoEditor.brushEraser"}],n=["#ffffff","#000000","#EF4444","#F97316","#EAB308","#22C55E","#06B6D4","#3B82F6","#8B5CF6","#EC4899","#F472B6","#6366F1"],i=Object.assign({"/src/assets/tools/photo-editor/stickers/sticker1.png":"https://cdn-frontend-static.kigermap.com/assets/sticker1-38mmhz3b.png","/src/assets/tools/photo-editor/stickers/sticker10.png":"https://cdn-frontend-static.kigermap.com/assets/sticker10-il3UTrwN.png","/src/assets/tools/photo-editor/stickers/sticker11.png":"https://cdn-frontend-static.kigermap.com/assets/sticker11-BNsw8jES.png","/src/assets/tools/photo-editor/stickers/sticker12.png":"https://cdn-frontend-static.kigermap.com/assets/sticker12-BJTJN19g.png","/src/assets/tools/photo-editor/stickers/sticker13.png":"https://cdn-frontend-static.kigermap.com/assets/sticker13-C_2JCPDb.png","/src/assets/tools/photo-editor/stickers/sticker14.png":"https://cdn-frontend-static.kigermap.com/assets/sticker14-x5lpuO9O.png","/src/assets/tools/photo-editor/stickers/sticker15.png":"https://cdn-frontend-static.kigermap.com/assets/sticker15-CcyXET6Y.png","/src/assets/tools/photo-editor/stickers/sticker16.png":"https://cdn-frontend-static.kigermap.com/assets/sticker16-CB0Ztylh.png","/src/assets/tools/photo-editor/stickers/sticker17.png":"https://cdn-frontend-static.kigermap.com/assets/sticker17-5VcswKud.png","/src/assets/tools/photo-editor/stickers/sticker18.png":"https://cdn-frontend-static.kigermap.com/assets/sticker18-Bzcfqd53.png","/src/assets/tools/photo-editor/stickers/sticker19.png":"https://cdn-frontend-static.kigermap.com/assets/sticker19-BQT_Zbyy.png","/src/assets/tools/photo-editor/stickers/sticker2.png":"https://cdn-frontend-static.kigermap.com/assets/sticker2-DtfT_zIB.png","/src/assets/tools/photo-editor/stickers/sticker20.png":"https://cdn-frontend-static.kigermap.com/assets/sticker20-D81HmG3-.png","/src/assets/tools/photo-editor/stickers/sticker21.png":"https://cdn-frontend-static.kigermap.com/assets/sticker21-DmM0O5oq.png","/src/assets/tools/photo-editor/stickers/sticker22.png":"https://cdn-frontend-static.kigermap.com/assets/sticker22-BLr6jxd6.png","/src/assets/tools/photo-editor/stickers/sticker23.png":"https://cdn-frontend-static.kigermap.com/assets/sticker23-BjbeFdLY.png","/src/assets/tools/photo-editor/stickers/sticker24.png":"https://cdn-frontend-static.kigermap.com/assets/sticker24-B4BIa0Gd.png","/src/assets/tools/photo-editor/stickers/sticker25.png":"https://cdn-frontend-static.kigermap.com/assets/sticker25-rc92JpKV.png","/src/assets/tools/photo-editor/stickers/sticker26.png":"https://cdn-frontend-static.kigermap.com/assets/sticker26-DwLyRqdJ.png","/src/assets/tools/photo-editor/stickers/sticker27.png":"https://cdn-frontend-static.kigermap.com/assets/sticker27-BEi-p9Uf.png","/src/assets/tools/photo-editor/stickers/sticker28.png":"https://cdn-frontend-static.kigermap.com/assets/sticker28-CySwcxJM.png","/src/assets/tools/photo-editor/stickers/sticker29.png":"https://cdn-frontend-static.kigermap.com/assets/sticker29-C7Gfqxke.png","/src/assets/tools/photo-editor/stickers/sticker3.png":"https://cdn-frontend-static.kigermap.com/assets/sticker3-DVJSBMyl.png","/src/assets/tools/photo-editor/stickers/sticker30.png":"https://cdn-frontend-static.kigermap.com/assets/sticker30-COjy7fwf.png","/src/assets/tools/photo-editor/stickers/sticker4.png":"https://cdn-frontend-static.kigermap.com/assets/sticker4-P3isdio2.png","/src/assets/tools/photo-editor/stickers/sticker5.png":"https://cdn-frontend-static.kigermap.com/assets/sticker5-D7FAEvjA.png","/src/assets/tools/photo-editor/stickers/sticker6.png":"https://cdn-frontend-static.kigermap.com/assets/sticker6-CWUC2w7C.png","/src/assets/tools/photo-editor/stickers/sticker7.png":"https://cdn-frontend-static.kigermap.com/assets/sticker7-PdP5IsXU.png","/src/assets/tools/photo-editor/stickers/sticker8.png":"https://cdn-frontend-static.kigermap.com/assets/sticker8-D0Hyp4Dw.png","/src/assets/tools/photo-editor/stickers/sticker9.png":"https://cdn-frontend-static.kigermap.com/assets/sticker9-CPeOS_Ki.png"}),l=Object.entries(i).map(([t,e])=>({path:t,url:e,filename:t.split("/").pop()||""})).sort((t,e)=>{var s,r;return parseInt((null==(s=t.path.match(/sticker(\d+)\.png/))?void 0:s[1])||"0")-parseInt((null==(r=e.path.match(/sticker(\d+)\.png/))?void 0:r[1])||"0")}),a=Object.fromEntries(l.map(({filename:t,url:e})=>[t,e])),c=["graffiti","neon"];function d(t,e){const s=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return"rgba(".concat(s,",").concat(r,",").concat(o,",").concat(e,")")}function h(t,e){if(!e||!e.points||0===e.points.length)return;const{brush:s}=e,r=s.opacity;switch(t.lineCap="round",t.lineJoin="round",s.type){case"normal":t.strokeStyle=d(s.color,r),t.lineWidth=s.size,p(t,e.points);break;case"marker":t.strokeStyle=d(s.color,.4*r),t.lineCap="square",t.lineWidth=2.5*s.size,p(t,e.points);break;case"neon":t.save(),t.strokeStyle=d(s.strokeColor,.15*r),t.lineWidth=4*s.size,t.shadowColor=s.strokeColor,t.shadowBlur=8,p(t,e.points),t.restore(),t.strokeStyle=d(s.color,.9*r),t.lineWidth=.6*s.size,p(t,e.points);break;case"dotted":t.fillStyle=d(s.color,r),function(t,e,s,r){let o=0;for(let n=0;n<e.length;n++){if(n>0){const t=e[n].x-e[n-1].x,s=e[n].y-e[n-1].y;o+=Math.sqrt(t*t+s*s)}(o>=r||0===n)&&(t.beginPath(),t.arc(e[n].x,e[n].y,s/2,0,2*Math.PI),t.fill(),o=0)}}(t,e.points,s.size,3*s.size);break;case"calligraphy":t.strokeStyle=d(s.color,r),t.lineCap="butt",function(t,e,s){if(e.length<2)return;for(let r=0;r<e.length-1;r++){const o=e[r+1].x-e[r].x,n=e[r+1].y-e[r].y,i=Math.sqrt(o*o+n*n);t.lineWidth=Math.min(Math.max(2*s/(1+.05*i),.3*s),2.5*s),t.beginPath(),t.moveTo(e[r].x,e[r].y),t.lineTo(e[r+1].x,e[r+1].y),t.stroke()}}(t,e.points,s.size);break;case"spray":!function(t,e,s,r,o){let n=42;const i=()=>(n=1103515245*n+12345&2147483647,n);for(const l of e)for(let e=0;e<12;e++){const e=i()%Math.floor(6*r)-3*r,n=i()%Math.floor(6*r)-3*r,a=e*e+n*n;a<r*r*9&&(t.fillStyle=d(s,Math.min(Math.max(.6-a/(r*r*15),.05),.6)*o),t.beginPath(),t.arc(l.x+e,l.y+n,.8,0,2*Math.PI),t.fill())}}(t,e.points,s.color,s.size,r);break;case"graffiti":!function(t,e,s){if(e.points.length<2)return;const{color:r,strokeColor:o,size:n}=e.brush;t.strokeStyle=d(o,.8*s),t.lineWidth=2.2*n,t.lineCap="round",t.lineJoin="round",p(t,e.points),t.strokeStyle=d(r,s),t.lineWidth=1.2*n,p(t,e.points)}(t,e,r);break;case"crayon":!function(t,e,s){if(e.points.length<2)return;const{color:r,size:o}=e.brush;let n=parseInt(r.slice(1),16)||42;for(let i=0;i<3;i++){t.strokeStyle=d(r,.35*s),t.lineWidth=o*(.6+.3*i),t.lineCap="round",t.beginPath();for(let s=0;s<e.points.length;s++){n=1103515245*n+12345&2147483647;const r=(n%100-50)*o*.02;n=1103515245*n+12345&2147483647;const i=(n%100-50)*o*.02;0===s?t.moveTo(e.points[s].x+r,e.points[s].y+i):t.lineTo(e.points[s].x+r,e.points[s].y+i)}t.stroke()}}(t,e,r);break;case"eraser":t.save(),t.globalCompositeOperation="destination-out",t.strokeStyle="rgba(0,0,0,1)",t.lineWidth=3*s.size,t.lineCap="round",p(t,e.points),t.restore()}}function p(t,e){if(e.length<2)return t.beginPath(),t.arc(e[0].x,e[0].y,t.lineWidth/2,0,2*Math.PI),void t.fill();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length-1;s++){const r=(e[s].x+e[s+1].x)/2,o=(e[s].y+e[s+1].y)/2;t.quadraticCurveTo(e[s].x,e[s].y,r,o)}t.lineTo(e[e.length-1].x,e[e.length-1].y),t.stroke()}function u(){var i,d,p,u,x,f,k,b,y;const{t:v}=s(),C=e.useRef(null),w=e.useRef(null),j=e.useRef(null),N=e.useRef(null),[M,E]=e.useState(null),[B,P]=e.useState([]),[z,I]=e.useState([]),[R,L]=e.useState([]),S=e.useRef(0),[F,D]=e.useState({type:"normal",color:"#ffffff",strokeColor:"#000000",size:4,opacity:1}),[Y,X]=e.useState("draw"),[W,K]=e.useState("none"),[T,q]=e.useState("fill"),[U,O]=e.useState(!1),[A,J]=e.useState({w:0,h:0}),H=e.useRef(null),_=e.useRef(!1),G=e.useRef(null),[V,Z]=e.useState(null),Q=e.useRef(null),$=e.useRef(null),tt=e.useRef(null),et=e.useRef(null),st=c.includes(F.type),rt="eraser"===F.type,ot=e.useMemo(()=>{if(!M||0===A.w||0===A.h)return{width:0,height:0};const t=M.width/M.height;let e,s;return A.w/A.h>t?(s=A.h,e=s*t):(e=A.w,s=e/t),{width:Math.floor(e),height:Math.floor(s)}},[M,A]);e.useEffect(()=>{const t=N.current;if(!t)return;const e=()=>{const{clientWidth:e,clientHeight:s}=t;e>0&&s>0&&J({w:e,h:s})};e();const s=new ResizeObserver(e);return s.observe(t),()=>s.disconnect()},[M]);const nt=e.useCallback(t=>{const e=new FileReader;e.onload=t=>{var e;const s=new Image;s.onload=()=>{E(s),P([]),L([]),I([]),Z(null),G.current=null},s.src=null==(e=t.target)?void 0:e.result},e.readAsDataURL(t)},[]),it=e.useCallback(t=>{var e;const s=null==(e=t.target.files)?void 0:e[0];s&&nt(s),t.target.value=""},[nt]),lt=e.useCallback(()=>{const t=C.current,e=w.current;if(!t||!e||0===ot.width||0===ot.height)return;const s=t.getContext("2d"),r=e.getContext("2d");s.clearRect(0,0,t.width,t.height),M&&s.drawImage(M,0,0,t.width,t.height),r.clearRect(0,0,e.width,e.height);for(const o of B)h(r,o);H.current&&h(r,H.current),s.drawImage(e,0,0);for(const o of R)s.save(),s.translate(o.x,o.y),s.rotate(o.rotation),s.scale(o.scale,o.scale),s.drawImage(o.img,-o.img.width/2,-o.img.height/2),s.restore()},[M,B,R,V,ot]);e.useEffect(()=>{lt()},[lt]);const at=e.useCallback((t,e)=>{const s=C.current,r=s.getBoundingClientRect();return{x:(t-r.left)*(s.width/r.width),y:(e-r.top)*(s.height/r.height)}},[]),ct=e.useCallback((t,e)=>{for(let s=R.length-1;s>=0;s--){const r=R[s],o=t-r.x,n=e-r.y,i=Math.min(Math.max(r.img.width*r.scale/2,30),200);if(Math.abs(o)<i&&Math.abs(n)<i)return r.id}return null},[R]),dt=e.useCallback((t,e)=>{t.stopPropagation(),t.preventDefault();const s=R.find(t=>t.id===V);if(!s)return;tt.current=e;const r=C.current,o=r.getBoundingClientRect();et.current={x:t.clientX,y:t.clientY,stickerX:s.x,stickerY:s.y,scale:s.scale,rotation:s.rotation,angle:Math.atan2(t.clientY-(o.top+s.y*o.height/r.height),t.clientX-(o.left+s.x*o.width/r.width))},t.target.setPointerCapture(t.pointerId)},[R,V]),ht=e.useCallback(t=>{if(!tt.current||!et.current||null===V)return;const e=et.current,s=C.current,r=s.getBoundingClientRect(),o=s.width/r.width,n=s.height/r.height;if("move"===tt.current){const s=(t.clientX-e.x)*o,r=(t.clientY-e.y)*n;L(t=>t.map(t=>t.id===V?{...t,x:e.stickerX+s,y:e.stickerY+r}:t))}else if("resize"===tt.current){const s=r.left+e.stickerX/o,i=r.top+e.stickerY/n,l=Math.sqrt((t.clientX-s)**2+(t.clientY-i)**2),a=Math.sqrt((e.x-s)**2+(e.y-i)**2);if(a>0){const t=Math.min(Math.max(e.scale*(l/a),.05),3);L(e=>e.map(e=>e.id===V?{...e,scale:t}:e))}}else if("rotate"===tt.current){const s=r.left+e.stickerX/o,i=r.top+e.stickerY/n,l=Math.atan2(t.clientY-i,t.clientX-s),a=e.rotation+(l-e.angle);L(t=>t.map(t=>t.id===V?{...t,rotation:a}:t))}},[V]),pt=e.useCallback(()=>{tt.current=null,et.current=null},[]),ut=e.useCallback(t=>{if("touch"===t.pointerType&&"sticker"===Y)return;if("sticker"===Y){const e=at(t.clientX,t.clientY),s=ct(e.x,e.y);return G.current=s,Z(s),void(null!==s&&(Q.current=e,t.target.setPointerCapture(t.pointerId)))}const e=at(t.clientX,t.clientY);H.current={points:[{...e,pressure:t.pressure||.5}],brush:{...F}},_.current=!0,t.target.setPointerCapture(t.pointerId)},[Y,F,at,ct]),mt=e.useCallback(t=>{if("sticker"===Y&&"touch"===t.pointerType)return;if(null!==G.current&&Q.current&&"sticker"===Y){const e=at(t.clientX,t.clientY),s=e.x-Q.current.x,r=e.y-Q.current.y;return Q.current=e,void L(t=>t.map(t=>t.id===G.current?{...t,x:t.x+s,y:t.y+r}:t))}if(!_.current||!H.current)return;const e=at(t.clientX,t.clientY);H.current.points.push({...e,pressure:t.pressure||.5}),lt()},[Y,at,lt]),gt=e.useCallback(()=>{if(null!==G.current&&Q.current)return void(Q.current=null);const t=H.current;t&&t.points.length>0&&(P(e=>[...e,t]),I(t=>[...t,"path"])),H.current=null,_.current=!1},[]),xt=e.useCallback(t=>{if("sticker"!==Y)return;t.preventDefault();const e=t.touches;if(1===e.length&&null!==G.current&&Q.current){const t=at(e[0].clientX,e[0].clientY),s=t.x-Q.current.x,r=t.y-Q.current.y;Q.current=t,L(t=>t.map(t=>t.id===G.current?{...t,x:t.x+s,y:t.y+r}:t))}if(2===e.length&&null!==G.current&&$.current){const t=e[1].clientX-e[0].clientX,s=e[1].clientY-e[0].clientY,r=Math.sqrt(t*t+s*s),o=Math.atan2(s,t),n=r/$.current.dist,i=o-$.current.angle;L(t=>t.map(t=>t.id===G.current?{...t,scale:Math.min(Math.max($.current.scale*n,.1),3),rotation:$.current.rotation+i}:t))}},[Y,at]),ft=e.useCallback(t=>{if("sticker"!==Y)return;const e=t.touches;if(1===e.length){const t=at(e[0].clientX,e[0].clientY),s=ct(t.x,t.y);G.current=s,Z(s),null!==s&&(Q.current=t)}if(2===e.length&&null!==G.current){t.preventDefault();const s=e[1].clientX-e[0].clientX,r=e[1].clientY-e[0].clientY,o=R.find(t=>t.id===G.current);o&&($.current={dist:Math.sqrt(s*s+r*r),angle:Math.atan2(r,s),scale:o.scale,rotation:o.rotation})}},[Y,at,ct,R]),kt=e.useCallback(()=>{"sticker"===Y&&(Q.current=null,$.current=null)},[Y]),bt=e.useCallback(t=>{if(null===V)return;t.preventDefault();const e=t.deltaY>0?-.05:.05;t.shiftKey?L(t=>t.map(t=>t.id===V?{...t,rotation:t.rotation+2*e}:t)):L(t=>t.map(t=>t.id===V?{...t,scale:Math.min(Math.max(t.scale+e,.1),3)}:t))},[V]);e.useEffect(()=>{const t=C.current;if(t)return t.addEventListener("touchstart",ft,{passive:!1}),t.addEventListener("touchmove",xt,{passive:!1}),t.addEventListener("touchend",kt),t.addEventListener("wheel",bt,{passive:!1}),()=>{t.removeEventListener("touchstart",ft),t.removeEventListener("touchmove",xt),t.removeEventListener("touchend",kt),t.removeEventListener("wheel",bt)}},[ft,xt,kt,bt]);const yt=e.useCallback(t=>{const e=new Image;e.onload=()=>{const s=S.current++;L(r=>[...r,{id:s,src:t,x:ot.width/2,y:ot.height/2,scale:.3,rotation:0,img:e}]),I(t=>[...t,"sticker"]),G.current=s,Z(s),X("sticker"),K("none")},e.src=a[t]},[ot]),vt=e.useCallback(()=>{I(t=>{if(0===t.length)return t;const e=[...t];return"path"===e.pop()?P(t=>t.slice(0,-1)):(L(t=>t.slice(0,-1)),Z(null),G.current=null),e})},[]),Ct=e.useCallback(()=>{confirm(v("tools.photoEditor.clearConfirm"))&&(P([]),L([]),I([]),Z(null),G.current=null)},[]),wt=e.useCallback(async()=>{if(M&&!U&&0!==ot.width){O(!0),Z(null),G.current=null,await new Promise(t=>setTimeout(t,50));try{const t=document.createElement("canvas");t.width=M.width,t.height=M.height;const e=t.getContext("2d"),s=M.width/ot.width;e.drawImage(M,0,0);const r=document.createElement("canvas");r.width=M.width,r.height=M.height;const o=r.getContext("2d");o.scale(s,s);for(const n of B)h(o,n);e.drawImage(r,0,0);for(const n of R)e.save(),e.translate(n.x*s,n.y*s),e.rotate(n.rotation),e.scale(n.scale*s,n.scale*s),e.drawImage(n.img,-n.img.width/2,-n.img.height/2),e.restore();t.toBlob(t=>{if(!t)return;const e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download="edited_".concat(Date.now(),".png"),s.click(),URL.revokeObjectURL(e),O(!1)},"image/png")}catch(t){alert(v("tools.photoEditor.saveFail")),O(!1)}}},[M,B,R,ot,U]),jt=e.useCallback((t,e)=>{K(e=>e===t?"none":t),e&&X(e),"brush"===t&&(Z(null),G.current=null)},[]);return M?t.jsxs("div",{className:"h-[100dvh] flex flex-col overflow-hidden",style:{backgroundColor:"var(--color-background)"},children:[t.jsxs("header",{className:"flex-shrink-0 flex items-center gap-1 px-2 sm:px-4 h-11 border-b",style:{borderColor:"var(--color-border)",backgroundColor:"var(--glass-dark-bg)"},children:[t.jsx(r,{to:"/tools",className:"p-1.5 rounded-lg hover:opacity-80",style:{color:"var(--color-text-muted)"},children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),t.jsx("span",{className:"text-sm font-medium mr-auto hidden sm:block",style:{color:"var(--color-text)"},children:v("tools.photoEditor.title")}),"draw"===Y&&t.jsxs("div",{className:"flex items-center gap-1.5 mr-auto sm:mr-0 px-2 py-1 rounded-lg",style:{backgroundColor:"rgba(139,92,246,0.1)"},children:[t.jsx("div",{className:"w-3.5 h-3.5 rounded-full border border-white/20",style:{backgroundColor:rt?"#666":F.color}}),t.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:[(null==(i=o.find(t=>t.type===F.type))?void 0:i.labelKey)?v(o.find(t=>t.type===F.type).labelKey):""," Â· ",F.size,"px"]})]}),t.jsx("button",{onClick:vt,disabled:0===z.length,className:"p-1.5 rounded-lg transition-opacity disabled:opacity-20",style:{color:"var(--color-text)"},title:v("tools.photoEditor.undo"),children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a5 5 0 015 5v2M3 10l4-4M3 10l4 4"})})}),t.jsx("button",{onClick:Ct,className:"p-1.5 rounded-lg hover:opacity-80",style:{color:"var(--color-text-muted)"},title:v("tools.photoEditor.clearAll"),children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),U?t.jsx("div",{className:"w-16 h-8 flex items-center justify-center",children:t.jsx("div",{className:"w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})}):t.jsx("button",{onClick:wt,className:"px-3 py-1 rounded-full text-xs font-semibold text-white active:scale-95 transition-transform",style:{background:"linear-gradient(135deg, #8B5CF6, #6366F1)"},children:"ðŸ’¾ ä¿å­˜"})]}),t.jsxs("div",{ref:N,className:"flex-1 min-h-0 flex items-center justify-center bg-black/90 relative overflow-hidden",children:[ot.width>0&&ot.height>0?t.jsxs(t.Fragment,{children:[t.jsx("canvas",{ref:C,width:ot.width,height:ot.height,className:"shadow-2xl",style:{width:ot.width,height:ot.height,cursor:"draw"===Y?rt?"cell":"crosshair":"default",touchAction:"none"},onPointerDown:ut,onPointerMove:mt,onPointerUp:gt,onPointerLeave:gt}),t.jsx("canvas",{ref:w,width:ot.width,height:ot.height,className:"hidden"}),null!==V&&"sticker"===Y&&(()=>{var e;const s=R.find(t=>t.id===V);if(!s)return null;const r=C.current,o=null==r?void 0:r.getBoundingClientRect();if(!r||!o)return null;const n=o.width/r.width,i=o.height/r.height,l=null==(e=N.current)?void 0:e.getBoundingClientRect();if(!l)return null;const a=o.left-l.left,c=o.top-l.top,d=a+s.x*n,h=c+s.y*i,p=s.img.width*s.scale*n,u=s.img.height*s.scale*i,m=p/2,g=180*s.rotation/Math.PI,x=10;return t.jsxs("div",{style:{position:"absolute",left:d,top:h,transform:"translate(-50%, -50%) rotate(".concat(g,"deg)"),width:p,height:u,pointerEvents:"none",zIndex:10},children:[t.jsx("div",{style:{position:"absolute",inset:-2,border:"2px solid #8B5CF6",borderRadius:4,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",inset:0,cursor:"move",pointerEvents:"auto"},onPointerDown:t=>dt(t,"move"),onPointerMove:ht,onPointerUp:pt}),[{x:-5,y:-5,cursor:"nwse-resize"},{x:p-5,y:-5,cursor:"nesw-resize"},{x:-5,y:u-5,cursor:"nesw-resize"},{x:p-5,y:u-5,cursor:"nwse-resize"}].map((e,s)=>t.jsx("div",{style:{position:"absolute",left:e.x,top:e.y,width:x,height:x,backgroundColor:"#fff",border:"2px solid #8B5CF6",borderRadius:2,cursor:e.cursor,pointerEvents:"auto",touchAction:"none"},onPointerDown:t=>dt(t,"resize"),onPointerMove:ht,onPointerUp:pt},"resize-".concat(s))),t.jsx("div",{style:{position:"absolute",left:m-1,top:-28,width:2,height:20,backgroundColor:"#8B5CF6",pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",left:m-8,top:-36,width:16,height:16,backgroundColor:"#fff",border:"2px solid #8B5CF6",borderRadius:"50%",cursor:"grab",pointerEvents:"auto",touchAction:"none",display:"flex",alignItems:"center",justifyContent:"center"},onPointerDown:t=>dt(t,"rotate"),onPointerMove:ht,onPointerUp:pt,children:t.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"#8B5CF6",strokeWidth:"3",strokeLinecap:"round",children:[t.jsx("path",{d:"M1 4v6h6M23 20v-6h-6"}),t.jsx("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})]})}),t.jsx("div",{style:{position:"absolute",right:-12,top:-12,width:22,height:22,backgroundColor:"#EF4444",borderRadius:"50%",cursor:"pointer",pointerEvents:"auto",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 6px rgba(0,0,0,0.3)"},onClick:()=>{L(t=>t.filter(t=>t.id!==V)),Z(null),G.current=null},children:t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"#fff",strokeWidth:"3",strokeLinecap:"round",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})})()]}):t.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"}),t.jsx("input",{ref:j,type:"file",accept:"image/*",className:"hidden",onChange:it})]}),t.jsxs("div",{className:"flex-shrink-0 border-t safe-area-bottom",style:{borderColor:"var(--color-border)",backgroundColor:"var(--glass-dark-bg)"},children:[null!==V&&"none"===W&&t.jsxs("div",{className:"border-b px-3 sm:px-4 py-1.5 flex items-center gap-3",style:{borderColor:"var(--color-border)"},children:[t.jsxs("span",{className:"text-[11px] flex-shrink-0",style:{color:"var(--color-text-muted)"},children:[Math.round(100*(null!=(p=null==(d=R.find(t=>t.id===V))?void 0:d.scale)?p:.3)),"%"]}),t.jsx("input",{type:"range",min:5,max:300,value:Math.round(100*(null!=(x=null==(u=R.find(t=>t.id===V))?void 0:u.scale)?x:.3)),onChange:t=>L(e=>e.map(e=>e.id===V?{...e,scale:+t.target.value/100}:e)),className:"flex-1 h-1 accent-purple-500"}),t.jsxs("span",{className:"text-[11px] flex-shrink-0",style:{color:"var(--color-text-muted)"},children:[Math.round(180*(null!=(k=null==(f=R.find(t=>t.id===V))?void 0:f.rotation)?k:0)/Math.PI),"Â°"]}),t.jsx("input",{type:"range",min:-180,max:180,value:Math.round(180*(null!=(y=null==(b=R.find(t=>t.id===V))?void 0:b.rotation)?y:0)/Math.PI),onChange:t=>L(e=>e.map(e=>e.id===V?{...e,rotation:+t.target.value*Math.PI/180}:e)),className:"flex-1 h-1 accent-purple-500"}),t.jsx("button",{onClick:()=>{Z(null),G.current=null},className:"text-[11px] px-2 py-0.5 rounded active:scale-95",style:{color:"var(--color-text-muted)"},children:v("tools.photoEditor.done")})]}),t.jsxs("div",{className:"flex justify-evenly py-1.5",children:[t.jsx(m,{icon:"ðŸ–Œï¸",label:v("tools.photoEditor.brush"),active:"brush"===W,onClick:()=>{jt("brush","draw")}}),t.jsx(m,{icon:"ðŸ˜Š",label:v("tools.photoEditor.sticker"),active:"sticker"===W,onClick:()=>{jt("sticker")}}),t.jsx(m,{icon:"âœ‹",label:v("tools.photoEditor.move"),active:"sticker"===Y&&"none"===W,onClick:()=>{X("sticker"),K("none")}}),t.jsx(m,{icon:"ðŸ–¼ï¸",label:v("tools.photoEditor.changeImg"),active:!1,onClick:()=>{var t;return null==(t=j.current)?void 0:t.click()}})]}),"brush"===W&&t.jsxs("div",{className:"border-t px-3 sm:px-4 py-2.5 space-y-2.5 overflow-y-auto max-h-[45vh] sm:max-h-72",style:{borderColor:"var(--color-border)"},children:[t.jsx("div",{className:"flex gap-1.5 overflow-x-auto pb-1 -mx-1 px-1 scrollbar-hide",children:o.map(e=>t.jsxs("button",{onClick:()=>D(t=>({...t,type:e.type})),className:"flex flex-col items-center gap-0.5 flex-shrink-0 w-12 py-1.5 rounded-xl border transition-all active:scale-95",style:{borderColor:F.type===e.type?"#8B5CF6":"var(--color-border)",backgroundColor:F.type===e.type?"rgba(139,92,246,0.15)":"transparent"},children:[t.jsx("span",{className:"text-base leading-none",children:e.icon}),t.jsx("span",{className:"text-[9px] leading-none",style:{color:F.type===e.type?"#8B5CF6":"var(--color-text-muted)"},children:v(e.labelKey)})]},e.type))}),t.jsx(g,{label:v("tools.photoEditor.size"),value:F.size,min:1,max:30,display:"".concat(F.size),preview:t.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:t.jsx("div",{style:{width:Math.min(Math.max(F.size,2),20),height:Math.min(Math.max(F.size,2),20),borderRadius:"50%",backgroundColor:rt?"#666":F.color}})}),onChange:t=>D(e=>({...e,size:t}))}),!rt&&t.jsx(g,{label:v("tools.photoEditor.opacity"),value:Math.round(100*F.opacity),min:10,max:100,display:"".concat(Math.round(100*F.opacity),"%"),onChange:t=>D(e=>({...e,opacity:t/100}))}),!rt&&t.jsxs("div",{className:"space-y-1.5",children:[st?t.jsx("div",{className:"flex gap-1.5",children:["fill","stroke"].map(e=>t.jsxs("button",{onClick:()=>q(e),className:"flex items-center gap-1 px-2.5 py-1 rounded-lg border text-[11px] transition-all active:scale-95",style:{borderColor:T===e?"#8B5CF6":"var(--color-border)",backgroundColor:T===e?"rgba(139,92,246,0.15)":"transparent",color:T===e?"#8B5CF6":"var(--color-text-muted)"},children:[t.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-white/20",style:{backgroundColor:"fill"===e?F.color:F.strokeColor}}),v("fill"===e?"tools.photoEditor.fillColor":"tools.photoEditor.strokeColor")]},e))}):t.jsx("span",{className:"text-[11px]",style:{color:"var(--color-text-muted)"},children:v("tools.photoEditor.color")}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:n.map(e=>{const s=(st&&"stroke"===T?F.strokeColor:F.color)===e;return t.jsx("button",{onClick:()=>{D(st&&"stroke"===T?t=>({...t,strokeColor:e}):t=>({...t,color:e}))},className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full border-2 transition-all active:scale-90",style:{backgroundColor:e,borderColor:s?"#8B5CF6":"rgba(255,255,255,0.12)",boxShadow:s?"0 0 8px ".concat(e,"80"):"none",transform:s?"scale(1.1)":"scale(1)"}},e)})})]})]}),"sticker"===W&&t.jsxs("div",{className:"border-t px-3 sm:px-4 py-2.5 max-h-[45vh] sm:max-h-60 overflow-y-auto",style:{borderColor:"var(--color-border)"},children:[t.jsx("p",{className:"text-xs font-medium mb-2 text-center",style:{color:"var(--color-text-muted)"},children:v("tools.photoEditor.stickerHint")}),t.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-1.5",children:l.map(({path:e,url:s,filename:r})=>t.jsx("button",{onClick:()=>yt(r),className:"aspect-square rounded-lg border p-1 hover:border-purple-500/50 active:scale-90 transition-all",style:{borderColor:"var(--color-border)",backgroundColor:"var(--glass-bg)"},children:t.jsx("img",{src:s,alt:"",className:"w-full h-full object-contain",loading:"lazy"})},e))})]})]})]}):t.jsxs("div",{className:"min-h-screen flex flex-col",style:{backgroundColor:"var(--color-background)"},children:[t.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-xl border-b",style:{backgroundColor:"var(--glass-dark-bg)",borderColor:"var(--color-border)"},children:t.jsxs("div",{className:"max-w-4xl mx-auto px-4 h-14 flex items-center",children:[t.jsx(r,{to:"/tools",className:"hover:opacity-80 transition-opacity mr-3",style:{color:"var(--color-text-muted)"},children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),t.jsx("h1",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:v("tools.photoEditor.title")})]})}),t.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:t.jsxs("div",{className:"text-center max-w-sm",children:[t.jsx("div",{className:"text-7xl mb-4",children:"ðŸŽ¨"}),t.jsx("p",{className:"text-lg mb-2 font-medium",style:{color:"var(--color-text)"},children:v("tools.photoEditor.editorTitle")}),t.jsx("p",{className:"text-sm mb-8",style:{color:"var(--color-text-muted)"},children:v("tools.photoEditor.editorDesc")}),t.jsx("button",{onClick:()=>{var t;return null==(t=j.current)?void 0:t.click()},className:"w-full py-3.5 rounded-2xl font-semibold text-white text-base transition-all active:scale-95 hover:shadow-lg hover:shadow-purple-500/20",style:{background:"linear-gradient(135deg, #8B5CF6, #6366F1)"},children:v("tools.photoEditor.selectImage")}),t.jsx("p",{className:"text-xs mt-3",style:{color:"var(--color-text-muted)"},children:v("tools.photoEditor.formatHint")}),t.jsx("input",{ref:j,type:"file",accept:"image/*",className:"hidden",onChange:it})]})})]})}function m({icon:e,label:s,active:r,onClick:o}){return t.jsxs("button",{onClick:o,className:"flex flex-col items-center gap-0.5 px-3 sm:px-5 py-0.5 rounded-lg transition-all active:scale-90",style:{color:r?"#8B5CF6":"var(--color-text-muted)"},children:[t.jsx("span",{className:"text-lg leading-none",children:e}),t.jsx("span",{className:"text-[10px] leading-none",children:s})]})}function g({label:e,value:s,min:r,max:o,display:n,preview:i,onChange:l}){return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-[11px] w-6 flex-shrink-0",style:{color:"var(--color-text-muted)"},children:e}),i,t.jsx("input",{type:"range",min:r,max:o,value:s,onChange:t=>l(+t.target.value),className:"flex-1 h-1 accent-purple-500 cursor-pointer"}),t.jsx("span",{className:"text-[11px] w-8 text-right flex-shrink-0",style:{color:"var(--color-text-muted)"},children:n})]})}export{u as default};
