import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{u as r,k as s,b as o}from"./index-D0yqgRjz.js";import{L as l}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";const a={anime_portrait:"from-pink-500/30 to-blue-500/30",ghibli:"from-green-500/30 to-yellow-500/30",chibi:"from-pink-400/30 to-purple-400/30",oil_painting:"from-amber-600/30 to-orange-500/30",watercolor:"from-cyan-400/30 to-blue-300/30",pixel_art:"from-green-400/30 to-emerald-500/30",cyberpunk:"from-purple-600/30 to-cyan-500/30",vintage_film:"from-amber-500/30 to-orange-400/30",noir:"from-gray-600/30 to-gray-400/30",fantasy:"from-violet-500/30 to-indigo-500/30",steampunk:"from-amber-700/30 to-yellow-600/30",pop_art:"from-red-500/30 to-yellow-400/30",cny_lantern:"from-red-600/30 to-amber-500/30",cny_dragon:"from-red-500/30 to-yellow-500/30",cny_fireworks:"from-blue-600/30 to-pink-500/30",cny_hanfu:"from-red-400/30 to-pink-400/30"};function i(){const{user:i}=r(),{t:c}=s(),d=t.useRef(null),[m,x]=t.useState([]),[u,p]=t.useState([]),[g,h]=t.useState([]),[v,f]=t.useState("festival"),[b,j]=t.useState(""),[y,k]=t.useState("original"),[N,w]=t.useState(null),[G,C]=t.useState(null),[L,S]=t.useState(null),[z,M]=t.useState("idle"),[W,_]=t.useState(""),[B,H]=t.useState(null),[R,U]=t.useState(""),[V,A]=t.useState(!1),[E,F]=t.useState(!1),[P,T]=t.useState(!1);t.useEffect(()=>{o.get("/imagegen/themes").then(e=>{var t;x(e.data.themes||[]),p(e.data.categories||[]),h(e.data.aspectRatios||[]);const r=(e.data.themes||[]).filter(e=>"festival"===e.category);r.length>0?j(r[0].id):(null==(t=e.data.themes)?void 0:t.length)>0&&j(e.data.themes[0].id)}).catch(()=>{})},[]),t.useEffect(()=>{i&&o.get("/imagegen/usage").then(e=>H(e.data)).catch(()=>{})},[i]);const D=t.useCallback(e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];if(!r)return;if(r.size>20971520)return void _(c("tools.imageGen.errSize"));if(!r.type.startsWith("image/"))return void _(c("tools.imageGen.errType"));C(r),_(""),S(null),T(!1);const s=new FileReader;s.onload=e=>{var t;return w(null==(t=e.target)?void 0:t.result)},s.readAsDataURL(r)},[]);t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("theme");if(e&&m.length>0){const t=m.find(t=>t.id===e);t&&(j(e),f(t.category),A(!1))}},[m]);const I=m.filter(e=>e.category===v),q="uploading"===z||"generating"===z;return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--color-background)"},children:[e.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-xl border-b",style:{backgroundColor:"var(--glass-dark-bg)",borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{to:"/tools",className:"hover:opacity-80 transition-opacity mr-3",style:{color:"var(--color-text-muted)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:c("tools.imageGen.title")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(l,{to:"/tools/image-gallery",className:"text-sm text-purple-400 hover:text-purple-300 transition-colors flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),e.jsx("span",{className:"hidden sm:inline",children:c("tools.imageGen.gallery")})]}),B&&e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"text-purple-400 font-medium",children:B.remaining}),"/",B.limit]})]})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto px-4 py-4 sm:py-6",children:[!i&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl bg-yellow-500/10 border border-yellow-500/20 text-yellow-300 text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:[c("tools.imageGen.loginFirst")," ",e.jsx(l,{to:"/login",className:"text-yellow-200 underline",children:c("tools.imageGen.loginLink")})," ",c("tools.imageGen.loginAfter")]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:c("tools.imageGen.uploadPhoto")}),e.jsxs("div",{onClick:()=>{var e;return null==(e=d.current)?void 0:e.click()},className:"relative rounded-2xl border-2 border-dashed transition-all cursor-pointer overflow-hidden ".concat(N?"border-purple-500/50":"hover:border-purple-500/30"),style:{minHeight:N?"auto":"180px",borderColor:N?void 0:"var(--color-border)",backgroundColor:N?"rgba(0,0,0,0.1)":"var(--glass-bg)"},children:[N?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N,alt:c("tools.imageGen.uploadedAlt"),className:"w-full max-h-[300px] object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm bg-black/60 px-4 py-2 rounded-full",children:c("tools.imageGen.clickChange")})})]}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",style:{color:"var(--color-text-muted)"},children:[e.jsx("svg",{className:"w-10 h-10 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-sm",children:c("tools.imageGen.clickUpload")}),e.jsx("p",{className:"text-xs mt-1",style:{opacity:.5},children:c("tools.imageGen.uploadHint")})]}),e.jsx("input",{ref:d,type:"file",accept:"image/jpeg,image/png,image/webp",onChange:D,className:"hidden"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:c("tools.imageGen.selectStyle")}),e.jsx("button",{onClick:()=>A(!V),className:"text-xs px-3 py-1 rounded-full transition-colors ".concat(V?"bg-purple-500/20 text-purple-300 border border-purple-500/30":""),style:V?void 0:{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"},children:c(V?"tools.imageGen.presetStyle":"tools.imageGen.custom")})]}),V?e.jsx("textarea",{value:R,onChange:e=>U(e.target.value),placeholder:c("tools.imageGen.customPlaceholder"),className:"w-full h-28 rounded-xl px-4 py-3 text-sm resize-none focus:outline-none focus:border-purple-500/50 transition-colors",style:{backgroundColor:"var(--input-bg)",border:"1px solid var(--color-border)",color:"var(--color-text)"},maxLength:500}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-1 scrollbar-hide flex-wrap",children:u.map(t=>e.jsxs("button",{onClick:()=>{f(t.id);const e=m.find(e=>e.category===t.id);e&&j(e.id)},className:"shrink-0 px-3 py-1.5 rounded-full text-xs sm:text-sm transition-all ".concat(v===t.id?"bg-purple-500/20 text-purple-300 border border-purple-500/30":"border border-transparent"),style:v!==t.id?{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"}:void 0,children:[t.icon," ",t.name]},t.id))}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide sm:grid sm:grid-cols-2 sm:overflow-visible sm:pb-0",children:I.map(t=>e.jsxs("button",{onClick:()=>j(t.id),className:"shrink-0 w-[140px] sm:w-auto relative rounded-xl text-left transition-all overflow-hidden ".concat(b===t.id?"ring-2 ring-purple-500 shadow-lg shadow-purple-500/10":"hover:ring-1 hover:ring-purple-500/30"),style:{border:"1px solid var(--color-border)"},children:[e.jsx("div",{className:"h-20 sm:h-24 bg-gradient-to-br ".concat(a[t.id]||"from-purple-500/20 to-pink-500/20"," flex items-center justify-center"),children:e.jsx("span",{className:"text-3xl sm:text-4xl",children:t.icon})}),e.jsxs("div",{className:"p-2.5 sm:p-3",style:{backgroundColor:"var(--glass-bg)"},children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium truncate",style:{color:"var(--color-text)"},children:t.name}),e.jsx("div",{className:"text-[10px] sm:text-xs mt-0.5 line-clamp-1",style:{color:"var(--color-text-muted)"},children:t.description})]}),b===t.id&&e.jsx("div",{className:"absolute top-1.5 right-1.5 w-5 h-5 bg-purple-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},t.id))})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:c("tools.imageGen.aspectRatio")}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide",children:g.map(t=>e.jsxs("button",{onClick:()=>k(t.id),className:"shrink-0 px-3 py-2 rounded-lg text-xs sm:text-sm transition-all flex items-center gap-1.5 ".concat(y===t.id?"bg-purple-500/20 text-purple-300 ring-1 ring-purple-500/50":""),style:y!==t.id?{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"}:void 0,children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.name})]},t.id))})]}),e.jsx("button",{onClick:async()=>{var e,t,r,s;if(G&&(b||V))if(i)if(B&&B.remaining<=0)_(c("tools.imageGen.errQuota"));else{M("uploading"),_(""),S(null),T(!1);try{const e=await(async e=>{const t=new FormData;return t.append("file",e),(await o.post("/oss/upload/user",t,{headers:{"Content-Type":"multipart/form-data"}})).data.url})(G);M("generating");const t={imageUrl:e,aspectRatio:y};V&&R.trim()?t.customPrompt=R.trim():t.themeId=b;const r=await o.post("/imagegen/generate",t,{timeout:15e4});if(!r.data.success||!r.data.resultUrl)throw new Error(r.data.error||c("tools.imageGen.errGenerate"));S(r.data.resultUrl),M("done"),void 0!==r.data.remaining&&H(e=>e?{...e,remaining:r.data.remaining,used:e.limit-r.data.remaining}:e)}catch(l){M("error"),_((null==(t=null==(e=l.response)?void 0:e.data)?void 0:t.error)||l.message||c("tools.imageGen.errGenerate")),void 0!==(null==(s=null==(r=l.response)?void 0:r.data)?void 0:s.remaining)&&H(e=>e?{...e,remaining:l.response.data.remaining}:e)}}else _(c("tools.imageGen.errLogin"))},disabled:!N||!b&&!V||q||!i,className:"w-full py-3.5 rounded-xl font-medium text-white transition-all disabled:opacity-40 disabled:cursor-not-allowed bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 active:scale-[0.98] shadow-lg shadow-purple-500/20",children:"uploading"===z?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{})," ",c("tools.imageGen.uploading")]}):"generating"===z?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{})," ",c("tools.imageGen.generating")]}):c("tools.imageGen.startGenerate")}),W&&e.jsx("div",{className:"p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-red-300 text-sm",children:W})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:c("tools.imageGen.result")}),e.jsx("div",{className:"rounded-2xl overflow-hidden",style:{minHeight:"360px",border:"1px solid var(--color-border)",backgroundColor:"var(--glass-bg)"},children:L?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:L,alt:c("tools.imageGen.resultAlt"),className:"w-full object-contain"}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>{if(!L)return;const e=document.createElement("a");e.href=L,e.download="kigurumi-creative-".concat(Date.now(),".png"),e.click()},className:"flex-1 py-2 rounded-xl bg-black/60 backdrop-blur-sm text-white text-xs sm:text-sm font-medium hover:bg-black/80 transition-colors flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),c("tools.imageGen.save")]}),e.jsx("button",{onClick:async()=>{if(L&&!E&&!P){F(!0);try{await o.post("/imagegen/share",{themeId:V?"custom":b,resultUrl:L}),T(!0)}catch(e){_(c("tools.imageGen.errShare"))}finally{F(!1)}}},disabled:E||P,className:"flex-1 py-2 rounded-xl backdrop-blur-sm text-xs sm:text-sm font-medium transition-colors flex items-center justify-center gap-1 ".concat(P?"bg-green-500/20 text-green-300":"bg-pink-500/20 text-pink-300 hover:bg-pink-500/30"),children:c(P?"tools.imageGen.shared":E?"tools.imageGen.sharing":"tools.imageGen.shareToGallery")}),e.jsx("button",{onClick:()=>{S(null),M("idle"),_(""),T(!1)},className:"flex-1 py-2 rounded-xl bg-purple-500/20 backdrop-blur-sm text-purple-300 text-xs sm:text-sm font-medium hover:bg-purple-500/30 transition-colors flex items-center justify-center gap-1",children:c("tools.imageGen.tryAgain")})]})]}):q?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[360px]",style:{color:"var(--color-text-muted)"},children:[e.jsxs("div",{className:"relative mb-5",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-purple-500/30 border-t-purple-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-xl",children:"âœ¨"})]}),e.jsx("p",{className:"text-sm",children:c("uploading"===z?"tools.imageGen.uploadingImg":"tools.imageGen.aiCreating")}),e.jsx("p",{className:"text-xs mt-2",style:{opacity:.5},children:c("tools.imageGen.waitTime")})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[360px]",style:{color:"var(--color-text-muted)"},children:[e.jsx("svg",{className:"w-14 h-14 mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-sm",children:c("tools.imageGen.emptyHint")})]})}),e.jsx("div",{className:"mt-4 p-3 rounded-xl text-xs",style:{backgroundColor:"var(--glass-bg)",border:"1px solid var(--color-border)",color:"var(--color-text-muted)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400",children:"ðŸ’¡"}),c("tools.imageGen.tip",{limit:String((null==B?void 0:B.limit)||10)})]})})]})]})]})]})}function n(){return e.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}export{i as default};
