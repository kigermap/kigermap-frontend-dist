!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var r,n,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.toStringTag||"@@toStringTag";function l(e,i,a,o){var l=i&&i.prototype instanceof c?i:c,u=Object.create(l.prototype);return t(u,"_invoke",function(e,t,i){var a,o,l,c=0,u=i||[],d=!1,f={p:0,n:0,v:r,a:h,f:h.bind(r,4),d:function(e,t){return a=e,o=0,l=r,f.n=t,s}};function h(e,t){for(o=e,l=t,n=0;!d&&c&&!i&&n<u.length;n++){var i,a=u[n],h=f.p,m=a[2];e>3?(i=m===t)&&(l=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=r):a[0]<=h&&((i=e<2&&h<a[1])?(o=0,f.v=t,f.n=a[1]):h<m&&(i=e<3||a[0]>t||t>m)&&(a[4]=e,a[5]=t,f.n=m,o=0))}if(i||e>1)return s;throw d=!0,t}return function(i,u,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,m),o=u,l=m;(n=o<2?r:l)||!d;){a||(o?o<3?(o>1&&(f.n=-1),h(o,l)):f.n=l:f.v=l);try{if(c=2,a){if(o||(i="next"),n=a[i]){if(!(n=n.call(a,l)))throw TypeError("iterator result is not an object");if(!n.done)return n;l=n.value,o<2&&(o=0)}else 1===o&&(n=a.return)&&n.call(a),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=r}else if((n=(d=f.n<0)?l:e.call(t,f))!==s)break}catch(n){a=r,o=1,l=n}finally{c=1}}return{value:n,done:d}}}(e,a,o),!0),u}var s={};function c(){}function u(){}function d(){}n=Object.getPrototypeOf;var f=[][a]?n(n([][a]())):(t(n={},a,function(){return this}),n),h=d.prototype=c.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=d,t(h,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,o,"GeneratorFunction"),t(h),t(h,o,"Generator"),t(h,a,function(){return this}),t(h,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:m}})()}function t(e,r,n,i){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,r,n,i){function o(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?a?a(e,r,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},t(e,r,n,i)}function r(e,t,r,n,i,a,o){try{var l=e[a](o),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,i)}function n(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function l(e){r(o,i,a,l,s,"next",e)}function s(e){r(o,i,a,l,s,"throw",e)}l(void 0)})}}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,l=[],s=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}System.register(["./query-legacy-CLxXWLnl.js","./sentry-legacy-CTr2CudU.js","./index-legacy-DVoFAd51.js","./AliyunCaptcha-legacy-DY0FTlyp.js","./router-legacy-9xrJEksD.js","./store-legacy-Bt3CCSnU.js"],function(t,r){"use strict";var a,o,l,s,c,u,d,f,h,m,x,p;return{setters:[function(e){a=e.j},function(e){o=e.a},function(e){l=e.u,s=e.a,c=e.L,u=e.l,d=e.b},function(e){f=e.A},function(e){h=e.c,m=e.a,x=e.u,p=e.L},null],execute:function(){t("default",function(){var t,r=i(h(),1)[0],g="phone"===r.get("mode")?"phone":"email",b="k"===r.get("_m"),v=i(o.useState(g),2),w=v[0],y=v[1],j=i(o.useState(""),2),N=j[0],S=j[1],k=i(o.useState(""),2),C=k[0],O=k[1],T=i(o.useState(""),2),_=T[0],L=T[1],I=i(o.useState(""),2),A=I[0],E=I[1],P=i(o.useState(0),2),R=P[0],q=P[1],z=o.useRef(null),B=l(),G=B.login,Q=B.phoneLogin,F=B.isLoading,M=B.error,W=B.clearError,D=m(),K=x(),V=s().t;o.useEffect(function(){var e=r.get("lang");e&&["zh-CN","zh-TW","en","ja","ko"].includes(e)&&s.getState().setLocale(e)},[r]);var J=(null===(t=K.state)||void 0===t||null===(t=t.from)||void 0===t?void 0:t.pathname)||"/";o.useEffect(function(){return function(){z.current&&clearInterval(z.current)}},[]);var $=function(){var t=n(e().m(function t(r){var n,i,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(!_||R>0||F)){e.n=1;break}return e.a(2,{captchaVerifyResult:!0,bizResult:!1});case 1:if(/^1[3-9]\d{9}$/.test(_)){e.n=2;break}return l.setState({error:"请输入正确的手机号"}),e.a(2,{captchaVerifyResult:!0,bizResult:!1});case 2:return W(),e.p=3,e.n=4,l.getState().sendPhoneCode(_,r,"login");case 4:return q(60),z.current&&clearInterval(z.current),z.current=setInterval(function(){q(function(e){return e<=1?(z.current&&(clearInterval(z.current),z.current=null),0):e-1})},1e3),e.a(2,{captchaVerifyResult:!0,bizResult:!0});case 5:throw e.p=5,a=e.v,(i=null==a||null===(n=a.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.retryAfter)&&i>0&&q(Math.min(i,60)),a;case 6:return e.a(2)}},t,null,[[3,5]])}));return function(e){return t.apply(this,arguments)}}(),H=function(){var t=n(e().m(function t(r){var n,i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r.preventDefault(),!F){e.n=1;break}return e.a(2);case 1:return W(),e.p=2,e.n=3,Q(_,A,"login");case 3:if(!b||!window.KigerBridge){e.n=4;break}return n=localStorage.getItem("token"),i=localStorage.getItem("user"),window.KigerBridge.postMessage(JSON.stringify({_t:"cb",_k:n,_u:i})),e.a(2);case 4:D(J,{replace:!0}),e.n=6;break;case 5:e.p=5,e.v;case 6:return e.a(2)}},t,null,[[2,5]])}));return function(e){return t.apply(this,arguments)}}(),U=i(o.useState(!1),2),X=U[0],Y=U[1],Z=function(){var t=n(e().m(function t(){var r,n,i,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return Y(!0),e.p=1,e.n=2,d.get("/auth/qq");case 2:n=e.v,null!==(r=n.data)&&void 0!==r&&r.url?window.location.href=n.data.url:(l.setState({error:"QQ 登录服务暂不可用"}),Y(!1)),e.n=4;break;case 3:e.p=3,a=e.v,l.setState({error:(null===(i=a.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.error)||"QQ 登录请求失败，请稍后重试"}),Y(!1);case 4:return e.a(2)}},t,null,[[1,3]])}));return function(){return t.apply(this,arguments)}}();return a.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[a.jsx("div",{className:"bg-animated"}),a.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md",children:[!b&&a.jsx("div",{className:"flex justify-end mb-4",children:a.jsx(c,{})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsxs("div",{className:"inline-flex items-center gap-3 cursor-pointer select-none",onClick:function(e){e.currentTarget.classList.remove("animate-seesaw"),e.currentTarget.offsetWidth,e.currentTarget.classList.add("animate-seesaw"),setTimeout(function(){return e.currentTarget.classList.remove("animate-seesaw")},600)},children:[a.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:a.jsx("img",{src:u,alt:"Logo",className:"w-10 h-10"})}),a.jsx("span",{className:"text-2xl font-bold text-gradient",children:V("app.name")})]}),a.jsx("p",{className:"text-white/50 mt-2",children:V("login.title")})]}),!b&&a.jsxs("div",{className:"flex gap-1 p-1 bg-white/[0.03] border border-white/[0.06] rounded-xl mb-6",children:[a.jsx("button",{onClick:function(){y("email"),W()},className:"flex-1 py-2 rounded-lg text-sm font-medium transition-all ".concat("email"===w?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:"邮箱登录"}),a.jsx("button",{onClick:function(){y("phone"),W()},className:"flex-1 py-2 rounded-lg text-sm font-medium transition-all ".concat("phone"===w?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:"手机号登录"})]}),"email"===w&&a.jsxs("form",{onSubmit:function(e){if(e.preventDefault(),!F)return W(),G(N,C).then(function(){if(b&&window.KigerBridge){var e=localStorage.getItem("token"),t=localStorage.getItem("user");window.KigerBridge.postMessage(JSON.stringify({_t:"cb",_k:e,_u:t}))}else D(J,{replace:!0})}).catch(function(){}),!1},className:"space-y-5",children:[M&&a.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:M}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:V("login.email")}),a.jsx("input",{type:"email",value:N,onChange:function(e){return S(e.target.value)},placeholder:V("login.email.placeholder"),required:!0,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:"block text-sm font-medium text-white/80",children:V("login.password")}),a.jsx(p,{to:"/reset-password",className:"text-sm text-primary hover:text-primary/80 transition",children:V("login.forgotPassword")})]}),a.jsx("input",{type:"password",value:C,onChange:function(e){return O(e.target.value)},placeholder:V("login.password.placeholder"),required:!0,minLength:6,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),a.jsx("button",{type:"submit",disabled:F,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:V(F?"login.submitting":"login.submit")})]}),"phone"===w&&a.jsxs("form",{onSubmit:H,className:"space-y-5",children:[M&&a.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:M}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"手机号"}),a.jsx("input",{type:"tel",value:_,onChange:function(e){return L(e.target.value.replace(/\D/g,"").slice(0,11))},placeholder:"请输入手机号",required:!0,maxLength:11,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"验证码"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("input",{type:"text",value:A,onChange:function(e){return E(e.target.value.replace(/\D/g,"").slice(0,6))},placeholder:"请输入验证码",required:!0,maxLength:6,className:"flex-1 min-w-0 px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border"}),a.jsx(f,{onSuccess:$,onError:function(e){return l.setState({error:e})},buttonText:R>0?"".concat(R,"s"):"发送验证码",buttonClassName:"px-4 py-3.5 btn-gradient rounded-xl font-medium text-white transition whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",disabled:R>0||F||!_})]})]}),a.jsx("button",{type:"submit",disabled:F||!A,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:F?"登录中...":"登录"})]}),!b&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-3 my-6",children:[a.jsx("div",{className:"flex-1 h-px bg-white/10"}),a.jsx("span",{className:"text-white/30 text-xs",children:"其他登录方式"}),a.jsx("div",{className:"flex-1 h-px bg-white/10"})]}),a.jsxs("button",{type:"button",onClick:Z,disabled:X,className:"w-full py-3 rounded-xl font-medium text-white transition flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-60",style:{backgroundColor:"#12B7F5"},children:[X?a.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):a.jsx("svg",{viewBox:"0 0 48 48",width:"22",height:"22",fill:"white",children:a.jsx("path",{d:"M24 4C16.268 4 10 10.268 10 18c0 2.167.487 4.217 1.357 6.055C8.97 28.326 7 33.392 7 36c0 1.657 1.343 2 3 2 .852 0 1.86-.282 2.87-.746C14.87 40.29 19.09 43 24 43s9.13-2.71 11.13-5.746C36.14 37.718 37.148 38 38 38c1.657 0 3-.343 3-2 0-2.608-1.97-7.674-4.357-11.945A15.89 15.89 0 0038 18c0-7.732-6.268-14-14-14z"})}),X?"跳转中...":"QQ 登录"]})]}),!b&&a.jsx("div",{className:"mt-6 text-center",children:a.jsx(p,{to:"/register",className:"text-white/60 hover:text-white transition text-sm",children:V("login.switchToRegister")})}),!b&&a.jsx("div",{className:"mt-6 pt-6 border-t border-white/10 text-center",children:a.jsx(p,{to:"https://kighub.cn/",className:"text-white/50 hover:text-white transition text-sm",children:V("login.backHome")})})]})]})})}}})}();
