import{j as a}from"./query-DSsWWIdM.js";import{a as e}from"./sentry-DvvTOdwe.js";import{u as t,k as s,b as l}from"./index-D0yqgRjz.js";import{L as c}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function o(){const{isAuthenticated:o}=t(),{t:i}=s(),[r,n]=e.useState("idle"),[d,f]=e.useState(null),[h,m]=e.useState(""),[j,x]=e.useState(""),[g,u]=e.useState(0),N=e.useRef(null),v=[i("tools.fateMatch.loading1"),i("tools.fateMatch.loading2"),i("tools.fateMatch.loading3"),i("tools.fateMatch.loading4"),i("tools.fateMatch.loading5"),i("tools.fateMatch.loading6"),i("tools.fateMatch.loading7"),i("tools.fateMatch.loading8"),i("tools.fateMatch.loading9"),i("tools.fateMatch.loading10")];e.useEffect(()=>(document.title=i("tools.fateMatch.pageTitle"),()=>{document.title="KigerMap"}),[]),e.useEffect(()=>{if("matching"!==r)return;let a=0;m(v[0]);const e=setInterval(()=>{a=(a+1)%v.length,m(v[a])},1200);return()=>clearInterval(e)},[r]);const p=d?function(a,e){return a>=90?{color:"#ff2d55",bg:"from-pink-500 to-red-500",label:e("tools.fateMatch.scoreExcellent"),glow:"shadow-pink-500/50"}:a>=70?{color:"#ff9500",bg:"from-orange-400 to-amber-500",label:e("tools.fateMatch.scoreGood"),glow:"shadow-orange-500/50"}:a>=50?{color:"#5856d6",bg:"from-violet-500 to-purple-500",label:e("tools.fateMatch.scoreOk"),glow:"shadow-violet-500/50"}:a>=30?{color:"#007aff",bg:"from-blue-500 to-cyan-500",label:e("tools.fateMatch.scoreLow"),glow:"shadow-blue-500/50"}:{color:"#34c759",bg:"from-green-500 to-emerald-500",label:e("tools.fateMatch.scoreBad"),glow:"shadow-green-500/50"}}(d.fate.score,i):null;return a.jsxs("div",{className:"fate-match-page",children:[a.jsx("div",{className:"fate-bg",children:Array.from({length:20}).map((e,t)=>a.jsx("div",{className:"fate-particle",style:{left:"".concat(100*Math.random(),"%"),animationDelay:"".concat(5*Math.random(),"s"),animationDuration:"".concat(3+4*Math.random(),"s")}},t))}),a.jsxs("div",{className:"fate-content",children:[a.jsxs("div",{className:"fate-header",children:[a.jsxs("h1",{className:"fate-title",children:[a.jsx("span",{className:"fate-title-emoji",children:"ðŸ”®"}),i("tools.fateMatch.title"),a.jsx("span",{className:"fate-title-emoji",children:"ðŸŽ­"})]}),a.jsx("p",{className:"fate-subtitle",children:i("tools.fateMatch.subtitle",{prefix:i(g>0?"tools.fateMatch.subtitleMany":"tools.fateMatch.subtitleFirst")})}),g>0&&a.jsx("p",{className:"fate-match-count",children:i("tools.fateMatch.matchCount",{count:g})})]}),a.jsxs("div",{className:"fate-stage",children:["idle"===r&&a.jsxs("div",{className:"fate-idle",children:[a.jsxs("div",{className:"fate-crystal-ball",children:[a.jsx("div",{className:"fate-crystal-inner",children:"ðŸ”®"}),a.jsx("div",{className:"fate-crystal-glow"})]}),a.jsx("p",{className:"fate-idle-text",children:i("tools.fateMatch.idleText")}),!o&&a.jsx("p",{className:"fate-login-hint",children:(()=>{const e=i("tools.fateMatch.loginHint",{loginLink:"{{LINK}}"}).split("{{LINK}}");return a.jsxs(a.Fragment,{children:[e[0],a.jsx(c,{to:"/login",className:"fate-link",children:i("tools.fateMatch.loginText")}),e[1]]})})()})]}),"matching"===r&&a.jsxs("div",{className:"fate-matching",children:[a.jsxs("div",{className:"fate-spinner",children:[a.jsx("div",{className:"fate-spinner-ring"}),a.jsx("div",{className:"fate-spinner-ring delay-1"}),a.jsx("div",{className:"fate-spinner-ring delay-2"}),a.jsx("span",{className:"fate-spinner-emoji",children:"ðŸŽ°"})]}),a.jsx("p",{className:"fate-loading-text",children:h})]}),("reveal"===r||"result"===r)&&d&&p&&a.jsx("div",{className:"fate-result-card ".concat("result"===r?"revealed":"revealing"),ref:N,children:a.jsx("div",{className:"fate-card-front",children:a.jsx("div",{className:"fate-card-border bg-gradient-to-br ".concat(p.bg),children:a.jsxs("div",{className:"fate-card-inner",children:[a.jsxs("div",{className:"fate-relationship-badge",children:[a.jsx("span",{className:"fate-rel-emoji",children:d.fate.emoji}),a.jsx("span",{className:"fate-rel-text",children:d.fate.relationship})]}),a.jsx("div",{className:"fate-avatar-wrap",children:d.user.avatar?a.jsx("img",{src:d.user.avatar,alt:"",className:"fate-avatar"}):a.jsx("div",{className:"fate-avatar-placeholder",children:"ðŸŽ­"})}),a.jsx("h2",{className:"fate-user-name",children:d.user.cnName}),(d.user.province||d.user.city)&&a.jsxs("p",{className:"fate-user-location",children:["ðŸ“ ",d.user.province,d.user.city?" Â· ".concat(d.user.city):""]}),a.jsxs("div",{className:"fate-score-section",children:[a.jsx("div",{className:"fate-score-label",children:i("tools.fateMatch.fateIndex")}),a.jsx("div",{className:"fate-score-number ".concat(p.glow),style:{color:p.color},children:d.fate.score}),a.jsx("div",{className:"fate-score-bar-bg",children:a.jsx("div",{className:"fate-score-bar bg-gradient-to-r ".concat(p.bg),style:{width:"result"===r?"".concat(d.fate.score,"%"):"0%"}})}),a.jsx("div",{className:"fate-score-verdict",style:{color:p.color},children:p.label})]}),"result"===r&&a.jsxs("div",{className:"fate-analysis",children:[a.jsx("h3",{className:"fate-analysis-title",children:d.fate.title}),a.jsx("p",{className:"fate-analysis-desc",children:d.fate.description}),a.jsxs("div",{className:"fate-advice",children:[a.jsx("span",{className:"fate-advice-icon",children:"ðŸ’¡"}),a.jsx("span",{children:d.fate.advice})]})]}),"result"===r&&d.user.shareCode&&a.jsx(c,{to:"/u/".concat(d.user.shareCode),className:"fate-view-profile",children:i("tools.fateMatch.viewProfile")})]})})})})]}),a.jsxs("div",{className:"fate-actions",children:[j&&a.jsx("p",{className:"fate-error",children:j}),a.jsx("button",{onClick:async()=>{n("matching"),x(""),f(null);try{const a=await l.get("/fate/match");f(a.data),setTimeout(()=>n("reveal"),800),setTimeout(()=>n("result"),2e3),u(a=>a+1)}catch(a){x(i("tools.fateMatch.error")),n("idle")}},disabled:"matching"===r,className:"fate-match-btn ".concat("matching"===r?"loading":""),children:i("matching"===r?"tools.fateMatch.matching":"result"===r?"tools.fateMatch.again":"tools.fateMatch.start")})]}),a.jsx("p",{className:"fate-disclaimer",children:i("tools.fateMatch.disclaimer")})]})]})}export{o as default};
