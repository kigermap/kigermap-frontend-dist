import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{u as r,a,b as n,L as l,l as s}from"./index-D0yqgRjz.js";import{A as i}from"./AliyunCaptcha-Drnlehh6.js";import{a as o,c,L as d}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function u(){const[u,m]=t.useState("email"),[x,h]=t.useState(""),[p,g]=t.useState(""),[b,w]=t.useState(""),[f,v]=t.useState(""),[j,y]=t.useState(0),[N,S]=t.useState(0),[I,k]=t.useState(""),[C,L]=t.useState(""),[R,_]=t.useState(0),[T,q]=t.useState(""),[D,E]=t.useState(!1),[A,M]=t.useState(""),z=t.useRef(null),O=t.useRef(null),V=t.useRef(null),{register:W,phoneLogin:B,sendCode:K,sendPhoneCode:F,isLoading:P,error:$,clearError:J}=r(),H=o(),[G]=c(),{t:Q}=a(),U="k"===G.get("_m");t.useEffect(()=>{const e=G.get("invite");if(e&&/^[A-Fa-f0-9]{8}$/i.test(e))q(e),localStorage.setItem("inviteCode",e),n.post("/invite/visit/".concat(e)).catch(()=>{});else{const e=localStorage.getItem("inviteCode");e&&/^[A-F0-9]{8}$/i.test(e)&&q(e)}},[G]),t.useEffect(()=>(j>0&&!z.current&&(z.current=setInterval(()=>{y(e=>e<=1?(z.current&&(clearInterval(z.current),z.current=null),0):e-1)},1e3)),()=>{z.current&&0===j&&(clearInterval(z.current),z.current=null)}),[j>0]),t.useEffect(()=>(N>0&&!O.current&&(O.current=setInterval(()=>{S(e=>e<=1?(O.current&&(clearInterval(O.current),O.current=null),0):e-1)},1e3)),()=>{O.current&&0===N&&(clearInterval(O.current),O.current=null)}),[N>0]),t.useEffect(()=>()=>{z.current&&clearInterval(z.current),O.current&&clearInterval(O.current),V.current&&clearInterval(V.current)},[]);const X=e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"agree-terms",checked:D,onChange:e=>E(e.target.checked),className:"mt-1 w-4 h-4 rounded border-white/30 bg-white/10 text-primary focus:ring-primary/50"}),e.jsxs("label",{htmlFor:"agree-terms",className:"text-sm text-white/60 leading-relaxed",children:["我已阅读并同意"," ",e.jsx(d,{to:"/terms",target:"_blank",className:"text-primary hover:underline",children:"《服务条款》"}),"、",e.jsx(d,{to:"/privacy",target:"_blank",className:"text-primary hover:underline",children:"《隐私政策》"})," ","和"," ",e.jsx(d,{to:"/agreement",target:"_blank",className:"text-primary hover:underline",children:"《用户协议》"})]})]});return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx("div",{className:"bg-animated"}),e.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(l,{})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 cursor-pointer select-none",onClick:e=>{e.currentTarget.classList.remove("animate-seesaw"),e.currentTarget.offsetWidth,e.currentTarget.classList.add("animate-seesaw"),setTimeout(()=>e.currentTarget.classList.remove("animate-seesaw"),600)},children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:e.jsx("img",{src:s,alt:"Logo",className:"w-10 h-10"})}),e.jsx("span",{className:"text-2xl font-bold text-gradient",children:Q("app.name")})]}),e.jsx("p",{className:"text-white/50 mt-2",children:Q("login.register.title")})]}),e.jsxs("div",{className:"flex gap-1 p-1 bg-white/[0.03] border border-white/[0.06] rounded-xl mb-6",children:[e.jsx("button",{onClick:()=>{m("email"),J(),M("")},className:"flex-1 py-2 rounded-lg text-sm font-medium transition-all ".concat("email"===u?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:"邮箱注册"}),e.jsx("button",{onClick:()=>{m("phone"),J(),M("")},className:"flex-1 py-2 rounded-lg text-sm font-medium transition-all ".concat("phone"===u?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:"手机号注册"})]}),"email"===u&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),J(),M(""),p===b)try{const e=(new Date).toISOString();if(await W(x,p,f,T||void 0,e),localStorage.removeItem("inviteCode"),U&&window.KigerBridge){const e=localStorage.getItem("token"),t=localStorage.getItem("user");return void window.KigerBridge.postMessage(JSON.stringify({_t:"cb",_k:e,_u:t}))}H("/",{replace:!0})}catch(t){}else M("两次输入的密码不一致")},className:"space-y-5",children:[($||A)&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:$||A}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:Q("login.email")}),e.jsx("input",{type:"email",value:x,onChange:e=>h(e.target.value),placeholder:Q("login.email.placeholder"),required:!0,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:[Q("login.verificationCode"),N>0&&e.jsxs("span",{className:"ml-2 text-xs text-primary",children:[Q("login.verificationCode.expires")," ",Math.floor(N/60),":",(N%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:f,onChange:e=>v(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:Q("login.verificationCode.placeholder"),required:!0,maxLength:6,className:"flex-1 min-w-0 px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border"}),e.jsx(i,{onSuccess:async e=>{var t,r;if(!x||j>0)return{captchaVerifyResult:!0,bizResult:!1};J();try{return await K(x,e,"register"),z.current&&(clearInterval(z.current),z.current=null),O.current&&(clearInterval(O.current),O.current=null),y(60),S(600),{captchaVerifyResult:!0,bizResult:!0}}catch(a){const e=null==(r=null==(t=null==a?void 0:a.response)?void 0:t.data)?void 0:r.retryAfter;throw e&&e>0&&(z.current&&(clearInterval(z.current),z.current=null),y(Math.min(e,600))),a}},onError:e=>r.setState({error:e}),buttonText:P?Q("login.sending"):j>0?j>=60?"".concat(Math.floor(j/60),":").concat((j%60).toString().padStart(2,"0")):"".concat(j,"s"):Q("login.sendCode"),buttonClassName:"px-4 py-3.5 btn-gradient rounded-xl font-medium text-white transition whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",disabled:P||j>0||!x})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:Q("login.password")}),e.jsx("input",{type:"password",value:p,onChange:e=>g(e.target.value),placeholder:Q("login.password.placeholder"),required:!0,minLength:6,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:Q("login.confirmPassword")}),e.jsx("input",{type:"password",value:b,onChange:e=>w(e.target.value),placeholder:Q("login.confirmPassword.placeholder"),required:!0,minLength:6,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),X,e.jsx("button",{type:"submit",disabled:P||!f||!D,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:Q(P?"login.submitting":"login.register.submit")})]}),"phone"===u&&e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),J();try{const e=(new Date).toISOString();if(await B(I,C,"register",e,T||void 0),localStorage.removeItem("inviteCode"),U&&window.KigerBridge){const e=localStorage.getItem("token"),t=localStorage.getItem("user");return void window.KigerBridge.postMessage(JSON.stringify({_t:"cb",_k:e,_u:t}))}H("/",{replace:!0})}catch(t){}},className:"space-y-5",children:[$&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:$}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"手机号"}),e.jsx("input",{type:"tel",value:I,onChange:e=>k(e.target.value.replace(/\D/g,"").slice(0,11)),placeholder:"请输入手机号",required:!0,maxLength:11,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"验证码"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:C,onChange:e=>L(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"请输入验证码",required:!0,maxLength:6,className:"flex-1 min-w-0 px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border"}),e.jsx(i,{onSuccess:async e=>{var t,a;if(!I||R>0||P)return{captchaVerifyResult:!0,bizResult:!1};if(!/^1[3-9]\d{9}$/.test(I))return r.setState({error:"请输入正确的手机号"}),{captchaVerifyResult:!0,bizResult:!1};J();try{return await F(I,e,"register"),_(60),V.current&&clearInterval(V.current),V.current=setInterval(()=>{_(e=>e<=1?(V.current&&(clearInterval(V.current),V.current=null),0):e-1)},1e3),{captchaVerifyResult:!0,bizResult:!0}}catch(n){const e=null==(a=null==(t=null==n?void 0:n.response)?void 0:t.data)?void 0:a.retryAfter;throw e&&e>0&&_(Math.min(e,60)),n}},onError:e=>r.setState({error:e}),buttonText:R>0?"".concat(R,"s"):"发送验证码",buttonClassName:"px-4 py-3.5 btn-gradient rounded-xl font-medium text-white transition whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",disabled:R>0||P||!I})]})]}),X,e.jsx("button",{type:"submit",disabled:P||!C||!D,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:P?"注册中...":"注册"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(d,{to:"/login",className:"text-white/60 hover:text-white transition text-sm",children:Q("login.switchToLogin")})}),e.jsx("div",{className:"mt-6 pt-6 border-t border-white/10 text-center",children:e.jsx(d,{to:"https://kighub.cn/",className:"text-white/50 hover:text-white transition text-sm",children:Q("login.backHome")})})]})]})}export{u as default};
