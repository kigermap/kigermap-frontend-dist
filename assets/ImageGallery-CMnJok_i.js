import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{u as r,k as s,b as o}from"./index-D0yqgRjz.js";import{L as l}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function a(){const{user:a}=r(),{t:n}=s(),[i,c]=t.useState([]),[d,m]=t.useState([]),[x,u]=t.useState(""),[p,h]=t.useState(1),[g,v]=t.useState(0),[j,f]=t.useState(!0),[y,k]=t.useState(null);t.useEffect(()=>{o.get("/imagegen/themes").then(e=>{m([{id:"",name:n("tools.gallery.all"),icon:"ðŸŽ¨"},...e.data.categories||[]])}).catch(()=>{})},[]);const b=t.useCallback(async(e,t)=>{f(!0);try{const r={page:e,limit:20};t&&(r.themeId=t);const s=await o.get("/imagegen/gallery",{params:r});c(1===e?s.data.creations||[]:e=>[...e,...s.data.creations||[]]),v(s.data.total||0)}catch(r){}finally{f(!1)}},[]);t.useEffect(()=>{h(1),b(1,x)},[x,b]);const N=e=>{const t=Date.now()-new Date(e).getTime(),r=Math.floor(t/6e4);if(r<1)return n("tools.gallery.justNow");if(r<60)return n("tools.gallery.minutesAgo",{n:r});const s=Math.floor(r/60);if(s<24)return n("tools.gallery.hoursAgo",{n:s});const o=Math.floor(s/24);return o<30?n("tools.gallery.daysAgo",{n:o}):new Date(e).toLocaleDateString()},w=i.length<g;return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--color-background)"},children:[e.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-xl border-b",style:{backgroundColor:"var(--glass-dark-bg)",borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{to:"/tools",className:"hover:opacity-80 transition-opacity mr-3",style:{color:"var(--color-text-muted)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:n("tools.gallery.title")}),g>0&&e.jsxs("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"},children:[g," ",n("tools.gallery.works")]})]}),e.jsx(l,{to:"/tools/image-generator",className:"px-4 py-2 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 text-white text-sm font-medium hover:from-purple-500 hover:to-pink-500 transition-all",children:n("tools.gallery.goCreate")})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[e.jsx("div",{className:"flex gap-2 mb-5 overflow-x-auto pb-1 scrollbar-hide flex-wrap",children:d.map(t=>e.jsxs("button",{onClick:()=>u(t.id),className:"shrink-0 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-xs sm:text-sm transition-all ".concat(x===t.id?"bg-purple-500/20 text-purple-300 border border-purple-500/30":"border border-transparent"),style:x!==t.id?{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"}:void 0,children:[t.icon," ",t.name]},t.id))}),0!==i.length||j?e.jsx("div",{className:"columns-2 md:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4",children:i.map(t=>{var r,s;return e.jsxs("div",{className:"break-inside-avoid mb-3 sm:mb-4 group relative rounded-xl sm:rounded-2xl overflow-hidden transition-all hover:shadow-lg hover:shadow-purple-500/5",style:{backgroundColor:"var(--glass-bg)",border:"1px solid var(--color-border)"},children:[e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>k(t.resultUrl),children:[e.jsx("img",{src:t.resultUrl,alt:t.themeName,className:"w-full block",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200 hidden sm:flex flex-col justify-end p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.userAvatar?e.jsx("img",{src:t.userAvatar,alt:"",className:"w-6 h-6 rounded-full object-cover ring-1 ring-white/20"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center text-[10px] text-white",children:(null==(r=t.userName)?void 0:r[0])||"?"}),e.jsx("span",{className:"text-xs text-white/90 truncate flex-1",children:t.userCode?e.jsx(l,{to:"/u/".concat(t.userCode),className:"hover:underline",onClick:e=>e.stopPropagation(),children:t.userName}):t.userName}),e.jsx("span",{className:"text-[10px] text-white/50 shrink-0",children:N(t.createdAt)})]})})]}),e.jsxs("div",{className:"px-2.5 py-2 sm:px-3 sm:py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 sm:hidden",children:[t.userAvatar?e.jsx("img",{src:t.userAvatar,alt:"",className:"w-5 h-5 rounded-full object-cover"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-500/20 flex items-center justify-center text-[10px]",style:{color:"var(--color-text-muted)"},children:(null==(s=t.userName)?void 0:s[0])||"?"}),e.jsx("span",{className:"text-[11px] truncate flex-1",style:{color:"var(--color-text-muted)"},children:t.userCode?e.jsx(l,{to:"/u/".concat(t.userCode),className:"hover:text-purple-400 transition-colors",children:t.userName}):t.userName}),e.jsx("span",{className:"text-[10px] shrink-0",style:{color:"var(--color-text-muted)",opacity:.5},children:N(t.createdAt)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 rounded-full truncate max-w-[60%]",style:{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"},children:[t.themeIcon," ",t.themeName]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>(async e=>{if(!a)return;const t=i.findIndex(t=>t.id===e.id);if(-1===t)return;const r=e.liked;c(e=>e.map((e,s)=>s===t?{...e,liked:!r,likeCount:e.likeCount+(r?-1:1)}:e));try{r?await o.delete("/imagegen/gallery/".concat(e.id,"/like")):await o.post("/imagegen/gallery/".concat(e.id,"/like"))}catch(s){c(e=>e.map((e,s)=>s===t?{...e,liked:r,likeCount:e.likeCount+(r?1:-1)}:e))}})(t),className:"flex items-center gap-0.5 text-xs transition-colors ".concat(t.liked?"text-pink-400":"hover:text-pink-400"),style:t.liked?void 0:{color:"var(--color-text-muted)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:t.liked?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),t.likeCount>0&&e.jsx("span",{className:"text-[10px]",children:t.likeCount})]}),e.jsx(l,{to:"/tools/image-generator?theme=".concat(t.themeId),className:"hover:text-purple-300 transition-colors",style:{color:"var(--color-text-muted)"},title:n("tools.gallery.useSame"),children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),a&&t.userId===a.id&&e.jsx("button",{onClick:()=>(async e=>{if(confirm(n("tools.gallery.confirmDelete")))try{await o.delete("/imagegen/gallery/".concat(e)),c(t=>t.filter(t=>t.id!==e)),v(e=>e-1)}catch(t){}})(t.id),className:"hover:text-red-400 transition-colors",style:{color:"var(--color-text-muted)"},children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]},t.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",style:{color:"var(--color-text-muted)"},children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-sm",children:n("tools.gallery.emptyText")}),e.jsx(l,{to:"/tools/image-generator",className:"mt-4 text-purple-400 text-sm hover:text-purple-300",children:n("tools.gallery.goCreateFirst")})]}),w&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("button",{onClick:()=>{const e=p+1;h(e),b(e,x)},disabled:j,className:"px-8 py-3 rounded-xl transition-colors text-sm disabled:opacity-40",style:{backgroundColor:"var(--input-bg)",color:"var(--color-text-muted)"},children:n(j?"tools.gallery.loading":"tools.gallery.loadMore")})}),j&&0===i.length&&e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"w-10 h-10 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})})]}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",onClick:()=>k(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white/60 hover:text-white transition-colors z-10",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("img",{src:y,alt:n("tools.gallery.preview"),className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()})]})]})}export{a as default};
