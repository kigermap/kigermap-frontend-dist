import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{u as a,b as s}from"./index-D0yqgRjz.js";import{c as l,a as r}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function n(){const[n]=l(),i=r(),d=a(e=>e.fetchUser),[c,o]=t.useState(""),[m,x]=t.useState(!0),[u,h]=t.useState(null),[p,b]=t.useState(""),[v,j]=t.useState(""),[w,f]=t.useState(!1),[N,q]=t.useState("");t.useEffect(()=>{const e=n.get("code");if(!e)return o("æŽˆæƒå¤±è´¥ï¼Œç¼ºå°‘æŽˆæƒç "),void x(!1);s.get("/auth/qq/callback",{params:{code:e,state:n.get("state")||""}}).then(async e=>{var t;(null==(t=e.data)?void 0:t.needBind)?(h({bindToken:e.data.bindToken,qqNickname:e.data.qqNickname||"",qqAvatar:e.data.qqAvatar||""}),x(!1)):(await d(),i("/",{replace:!0}))}).catch(e=>{var t,a;o((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.error)||"QQ ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•"),x(!1)})},[n,i,d]);const g=async e=>{var t,a;if(e.preventDefault(),u){f(!0),q("");try{await s.post("/auth/qq/bind",{bindToken:u.bindToken,email:p,password:v}),await d(),i("/",{replace:!0})}catch(l){q((null==(a=null==(t=l.response)?void 0:t.data)?void 0:a.error)||"ç»‘å®šå¤±è´¥"),f(!1)}}},y=async()=>{var e,t;if(u){f(!0),q("");try{await s.post("/auth/qq/bind-new",{bindToken:u.bindToken}),await d(),i("/",{replace:!0})}catch(a){q((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)||"åˆ›å»ºå¤±è´¥"),f(!1)}}};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"æ­£åœ¨é€šè¿‡ QQ ç™»å½•..."})]})}):c?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ˜¢"}),e.jsx("p",{className:"text-red-400 mb-4",children:c}),e.jsx("button",{onClick:()=>i("/login",{replace:!0}),className:"px-6 py-2 btn-gradient rounded-xl text-white",children:"è¿”å›žç™»å½•"})]})}):u?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx("div",{className:"bg-animated"}),e.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[u.qqAvatar&&e.jsx("img",{src:u.qqAvatar,alt:"QQå¤´åƒ",className:"w-16 h-16 rounded-full mx-auto mb-3"}),e.jsx("p",{className:"text-white text-lg",children:u.qqNickname||"QQ ç”¨æˆ·"}),e.jsx("p",{className:"text-white/50 text-sm mt-1",children:"é¦–æ¬¡ä½¿ç”¨ QQ ç™»å½•ï¼Œè¯·é€‰æ‹©æ“ä½œ"})]}),N&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm mb-4",children:N}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-white/70 text-sm mb-3",children:"å·²æœ‰è´¦æˆ·ï¼Ÿè¾“å…¥é‚®ç®±å¯†ç ç»‘å®š QQï¼š"}),e.jsxs("form",{onSubmit:g,className:"space-y-3",children:[e.jsx("input",{type:"email",value:p,onChange:e=>b(e.target.value),placeholder:"é‚®ç®±",required:!0,className:"w-full px-4 py-3 input-modern rounded-xl text-white placeholder-white/30 outline-none"}),e.jsx("input",{type:"password",value:v,onChange:e=>j(e.target.value),placeholder:"å¯†ç ",required:!0,minLength:6,className:"w-full px-4 py-3 input-modern rounded-xl text-white placeholder-white/30 outline-none"}),e.jsx("button",{type:"submit",disabled:w,className:"w-full py-3 btn-gradient rounded-xl font-medium text-white disabled:opacity-50",children:w?"ç»‘å®šä¸­...":"ç»‘å®šå·²æœ‰è´¦æˆ·"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"flex-1 h-px bg-white/10"}),e.jsx("span",{className:"text-white/30 text-xs",children:"æˆ–è€…"}),e.jsx("div",{className:"flex-1 h-px bg-white/10"})]}),e.jsx("button",{onClick:y,disabled:w,className:"w-full py-3 rounded-xl font-medium text-white/80 border border-white/20 hover:border-white/40 transition disabled:opacity-50",children:w?"åˆ›å»ºä¸­...":"ç›´æŽ¥åˆ›å»ºæ–°è´¦æˆ·"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>i("/login",{replace:!0}),className:"text-white/40 hover:text-white/60 text-sm transition",children:"è¿”å›žç™»å½•"})})]})]}):null}export{n as default};
