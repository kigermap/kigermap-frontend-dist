import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{a as r,u as s,L as a,l as n}from"./index-D0yqgRjz.js";import{A as l}from"./AliyunCaptcha-Drnlehh6.js";import{a as i,L as o}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";const c=()=>{const c=i(),{t:d}=r(),{sendCode:u,resetPassword:m,isLoading:x,error:h,clearError:p}=s(),[g,f]=t.useState(""),[w,b]=t.useState(""),[v,j]=t.useState(""),[y,N]=t.useState(""),[S,C]=t.useState(""),[I,L]=t.useState(0),[T,k]=t.useState(0),[P,R]=t.useState(""),q=t.useRef(null),E=t.useRef(null);t.useEffect(()=>(I>0&&!q.current&&(q.current=setInterval(()=>{L(e=>e<=1?(q.current&&(clearInterval(q.current),q.current=null),0):e-1)},1e3)),()=>{q.current&&0===I&&(clearInterval(q.current),q.current=null)}),[I>0]),t.useEffect(()=>(T>0&&!E.current&&(E.current=setInterval(()=>{k(e=>e<=1?(E.current&&(clearInterval(E.current),E.current=null),0):e-1)},1e3)),()=>{E.current&&0===T&&(clearInterval(E.current),E.current=null)}),[T>0]),t.useEffect(()=>()=>{q.current&&clearInterval(q.current),E.current&&clearInterval(E.current)},[]);return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx("div",{className:"bg-animated"}),e.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(a,{})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 cursor-pointer select-none",onClick:e=>{e.currentTarget.classList.remove("animate-seesaw"),e.currentTarget.offsetWidth,e.currentTarget.classList.add("animate-seesaw"),setTimeout(()=>{e.currentTarget.classList.remove("animate-seesaw")},600)},children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:e.jsx("img",{src:n,alt:"Logo",className:"w-10 h-10"})}),e.jsx("span",{className:"text-2xl font-bold text-gradient",children:d("app.name")})]}),e.jsx("p",{className:"text-white/50 mt-2",children:d("resetPassword.title")})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),p(),C(""),R(""),v===y)try{await m(g,v,w),R(d("resetPassword.success")),setTimeout(()=>{c("/login")},2e3)}catch(t){}else C(d("resetPassword.error.passwordMismatch"))},className:"space-y-5",children:[(h||S)&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:h||S}),P&&e.jsx("div",{className:"p-3 bg-green-500/20 border border-green-500/30 rounded-xl text-green-300 text-sm",children:P}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:d("login.email")}),e.jsx("input",{type:"email",value:g,onChange:e=>f(e.target.value),placeholder:d("login.email.placeholder"),required:!0,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0},disabled:I>0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:[d("login.verificationCode"),T>0&&e.jsxs("span",{className:"ml-2 text-xs text-primary",children:[d("login.verificationCode.expires")," ",Math.floor(T/60),":",(T%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:w,onChange:e=>b(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:d("login.verificationCode.placeholder"),required:!0,maxLength:6,className:"flex-1 min-w-0 px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border"}),e.jsx(l,{onSuccess:async e=>{var t,r;if(!g||I>0)return{captchaVerifyResult:!0,bizResult:!1};p(),C("");try{return await u(g,e,"reset"),q.current&&(clearInterval(q.current),q.current=null),E.current&&(clearInterval(E.current),E.current=null),L(60),k(600),R(d("auth.codeSent")),setTimeout(()=>R(""),3e3),{captchaVerifyResult:!0,bizResult:!0}}catch(s){const e=null==(r=null==(t=null==s?void 0:s.response)?void 0:t.data)?void 0:r.retryAfter;throw e&&e>0&&(q.current&&(clearInterval(q.current),q.current=null),L(Math.min(e,600))),s}},onError:e=>s.setState({error:e}),buttonText:x?d("login.sending"):I>0?I>=60?"".concat(Math.floor(I/60),":").concat((I%60).toString().padStart(2,"0")):"".concat(I,"s"):d("login.sendCode"),buttonClassName:"px-4 py-3.5 btn-gradient rounded-xl font-medium text-white transition whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",disabled:x||I>0||!g})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:d("login.password")}),e.jsx("input",{type:"password",value:v,onChange:e=>j(e.target.value),placeholder:d("login.password.placeholder"),required:!0,minLength:6,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:d("login.confirmPassword")}),e.jsx("input",{type:"password",value:y,onChange:e=>N(e.target.value),placeholder:d("login.confirmPassword.placeholder"),required:!0,minLength:6,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsx("button",{type:"submit",disabled:x||!w,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:d(x?"login.submitting":"resetPassword.submit")})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(o,{to:"/login",className:"text-white/60 hover:text-white transition text-sm",children:d("login.switchToLogin")})}),e.jsx("div",{className:"mt-6 pt-6 border-t border-white/10 text-center",children:e.jsx(o,{to:"https://kighub.cn/",className:"text-white/50 hover:text-white transition text-sm",children:d("login.backHome")})})]})]})};export{c as default};
