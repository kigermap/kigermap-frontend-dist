const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BMFlCmAp.js","assets/sentry-DvvTOdwe.js","assets/map-D7BZrtNE.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./index-D0yqgRjz.js";import{j as t}from"./query-DSsWWIdM.js";import{a as r}from"./sentry-DvvTOdwe.js";const s={BASE_URL:"https://cdn-frontend-static.kigermap.com/",DEV:!1,LEGACY:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ALIYUN_CAPTCHA_IDENTITY:"esa-sti6ljl6z5",VITE_ALIYUN_CAPTCHA_PREFIX:"ut6aks",VITE_ALIYUN_CAPTCHA_REGION:"cn",VITE_ALIYUN_CAPTCHA_SCENE_ID:"1wu7t9tq",VITE_AMAP_KEY:"05a185cb1d11ced37ca7d8f96d1a3aec",VITE_AMAP_SECRET:"65bd040d9943b44c16d1870e23fd9de9",VITE_API_URL:"https://api.kigermap.com/v1",VITE_QQ_APP_ID:"102821653"},n=(e,t="")=>{try{if(void 0!==import.meta&&s)return s[e]||t}catch(r){}return t},o=()=>{const e=navigator.userAgent.toLowerCase();return e.includes("qq")||e.includes("mqqbrowser")||e.includes("qqbrowser")};function a({value:s,onChange:a,placeholder:i="点击地图选择位置"}){const c=r.useRef(null),l=r.useRef(null),d=r.useRef(null),u=r.useRef(null),m=r.useRef(null),[x,h]=r.useState(!1),[p,w]=r.useState(""),[f,g]=r.useState(!1),[b,y]=r.useState(!1),[j,v]=r.useState(!1),[k,A]=r.useState(""),[N,E]=r.useState(s);r.useEffect(()=>{E(s)},[s]);const C=r.useCallback((e,t)=>{l.current&&d.current&&(l.current.setZoomAndCenter(14,[e,t]),u.current?u.current.setPosition([e,t]):u.current=new d.current.Marker({position:[e,t],map:l.current}))},[]),_=r.useCallback((e,t)=>new Promise(r=>{const s=((e,t)=>e>=73&&e<=135&&t>=18&&t<=54?"中国":e>=129&&e<=146&&t>=30&&t<=46?"日本":e>=124&&e<=132&&t>=33&&t<=39?"韩国":e>=119&&e<=122&&t>=21&&t<=26?"中国台湾":e>=113.8&&e<=114.5&&t>=22.1&&t<=22.6?"中国香港":e>=113.5&&e<=113.6&&t>=22.1&&t<=22.2?"中国澳门":e>=95&&e<=141&&t>=-11&&t<=28?e>=100&&e<=105&&t>=5&&t<=21?"泰国":e>=103&&e<=104&&t>=1&&t<=2?"新加坡":e>=99&&e<=119&&t>=-8&&t<=6?"印度尼西亚":e>=116&&e<=127&&t>=5&&t<=21?"菲律宾":e>=100&&e<=109&&t>=1&&t<=7?"马来西亚":e>=102&&e<=108&&t>=8&&t<=24?"越南":"东南亚":e>=-125&&e<=-66&&t>=24&&t<=50?"美国":e>=-141&&e<=-52&&t>=41&&t<=84?"加拿大":e>=-10&&e<=40&&t>=35&&t<=72?"欧洲":e>=113&&e<=154&&t>=-44&&t<=-10?"澳大利亚":"海外")(e,t);"中国"===s?m.current?m.current.getAddress([e,t],(s,n)=>{if("complete"===s&&n.regeocode){const s=n.regeocode.addressComponent;r({lat:t,lng:e,country:s.country||"中国",province:s.province||"",city:s.city||s.district||"",address:n.regeocode.formattedAddress||""})}else r({lat:t,lng:e,country:"中国"})}):r({lat:t,lng:e,country:s}):r({lat:t,lng:e,country:s,province:"",city:"",address:""})}),[]),L=r.useCallback(async(e,t)=>{C(e,t);const r=await _(e,t);E(r),a(r)},[C,_,a]);r.useEffect(()=>{if(!x||!c.current||l.current)return;window._AMapSecurityConfig={securityJsCode:n("VITE_AMAP_SECRET")};return(async()=>{try{const t=(await e(async()=>{const{default:e}=await import("./index-BMFlCmAp.js").then(e=>e.i);return{default:e}},__vite__mapDeps([0,1,2]))).default,r=await t.load({key:n("VITE_AMAP_KEY"),version:"2.0",plugins:["AMap.Geocoder","AMap.PlaceSearch","AMap.Geolocation"]});d.current=r;const s=new r.Map(c.current,{zoom:N?12:4,center:N?[N.lng,N.lat]:[105,35],mapStyle:"amap://styles/3cb53faf98f9ff2733c29ffa1089a230"});l.current=s,m.current=new r.Geocoder,N&&(u.current=new r.Marker({position:[N.lng,N.lat],map:s})),s.on("click",e=>{const{lng:t,lat:r}=e.lnglat;L(t,r)}),y(!0)}catch(t){}})(),()=>{var e;null==(e=l.current)||e.destroy(),l.current=null,d.current=null,u.current=null,y(!1)}},[x]),r.useEffect(()=>{b&&N&&l.current&&C(N.lng,N.lat)},[b,N,C]);const P=e=>{if(e.code)switch(e.code){case 1:return o()?"请在QQ浏览器设置中允许位置权限，或手动选择位置":navigator.userAgent.toLowerCase().includes("micromessenger")?"请在微信设置中允许位置权限，或手动选择位置":"定位权限被拒绝，请在浏览器设置中允许位置权限";case 2:return"无法获取位置信息，请检查网络或GPS设置";case 3:return"定位超时，请检查网络连接后重试";default:return"定位失败，请手动选择位置"}return e.message||"定位失败，请手动选择位置"},I=async()=>{if(p.trim()&&l.current&&d.current){g(!0);try{new d.current.PlaceSearch({city:"全国",pageSize:1}).search(p,(e,t)=>{var r,s;if("complete"===e&&(null==(s=null==(r=t.poiList)?void 0:r.pois)?void 0:s.length)>0){const e=t.poiList.pois[0],{lng:r,lat:s}=e.location;L(r,s)}g(!1)})}catch(e){g(!1)}}},T=N?[N.country,N.province,N.city].filter(Boolean).join(" · "):i;return t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",onClick:()=>h(!0),className:"w-full px-4 py-3 text-left glass rounded-xl hover:bg-white/10 transition",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),t.jsx("span",{className:N?"text-white":"text-white/50",children:T})]})}),x&&t.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-end sm:items-center justify-center z-50 sm:p-4",children:t.jsxs("div",{className:"glass-dark rounded-t-2xl sm:rounded-2xl w-full sm:max-w-2xl max-h-[85vh] sm:max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-white/10 flex-shrink-0",children:[t.jsx("h3",{className:"font-semibold text-white text-sm sm:text-base",children:"选择位置"}),t.jsx("button",{onClick:()=>h(!1),className:"p-1.5 sm:p-2 hover:bg-white/10 rounded-full transition",children:t.jsx("svg",{className:"w-5 h-5 text-white/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:[t.jsxs("div",{className:"p-3 sm:p-4 border-b border-white/10",children:[t.jsx("button",{onClick:async()=>{v(!0),A("");try{let r,s;try{const e=await new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0}):t(new Error("您的浏览器不支持定位功能"))});r=e.coords.longitude,s=e.coords.latitude}catch(e){if(!b||!d.current)throw new Error(P(e));try{const e=await new Promise((e,t)=>{d.current?new d.current.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",zoomToAccuracy:!0,GeoLocationFirst:!0}).getCurrentPosition((r,s)=>{"complete"===r?e({lng:s.position.lng,lat:s.position.lat}):t(new Error(s.message||"定位失败"))}):t(new Error("地图未初始化"))});r=e.lng,s=e.lat}catch(t){throw new Error(P(e))}}await L(r,s)}catch(r){A(r.message||"定位失败，请手动选择位置")}finally{v(!1)}},disabled:j,className:"w-full flex items-center justify-center gap-2 px-3 sm:px-4 py-2.5 sm:py-3 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 disabled:opacity-50 rounded-xl text-white text-sm sm:text-base font-medium transition-all",children:j?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),t.jsx("span",{children:"正在定位..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})}),t.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})}),t.jsx("span",{children:"快速定位当前位置"})]})}),k&&t.jsx("p",{className:"mt-2 text-xs sm:text-sm text-red-400 text-center",children:k}),t.jsx("p",{className:"mt-1.5 sm:mt-2 text-[10px] sm:text-xs text-white/40 text-center",children:o()?"使用QQ浏览器定位，请确保已授权位置权限":"点击按钮自动获取当前位置"})]}),t.jsx("div",{className:"p-3 sm:p-4 border-b border-white/10",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:p,onChange:e=>w(e.target.value),onKeyDown:e=>"Enter"===e.key&&I(),placeholder:"或搜索地点名称...",className:"flex-1 px-3 sm:px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-white text-sm placeholder-white/40 outline-none focus:border-primary/50"}),t.jsx("button",{onClick:I,disabled:f||!b,className:"px-3 sm:px-4 py-2 btn-gradient rounded-xl text-white text-sm disabled:opacity-50",children:f?"...":"搜索"})]})}),t.jsx("div",{ref:c,className:"h-48 sm:h-80"}),N&&t.jsxs("div",{className:"p-3 sm:p-4 border-t border-white/10 bg-white/5",children:[t.jsxs("p",{className:"text-xs sm:text-sm text-white/80",children:["已选择: ",[N.country,N.province,N.city].filter(Boolean).join(" · ")]}),t.jsxs("p",{className:"text-[10px] sm:text-xs text-white/40 mt-1",children:["坐标: ",N.lat.toFixed(6),", ",N.lng.toFixed(6)]})]})]}),t.jsxs("div",{className:"p-3 sm:p-4 border-t border-white/10 flex justify-end gap-2 sm:gap-3 flex-shrink-0 bg-[#0a0a0f]/95",children:[t.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 glass rounded-xl text-white/70 hover:text-white hover:bg-white/10 transition text-sm",children:"取消"}),t.jsx("button",{onClick:()=>h(!1),disabled:!N,className:"px-4 py-2 btn-gradient rounded-xl text-white disabled:opacity-50 text-sm",children:"确认"})]})]})})]})}export{a as L};
