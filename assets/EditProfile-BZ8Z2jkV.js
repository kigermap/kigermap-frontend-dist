import{j as e,u as t,b as i}from"./query-DSsWWIdM.js";import{a as s}from"./sentry-DvvTOdwe.js";import{k as l,b as a,c as n,g as r,u as o,m as c,d,v as h}from"./index-D0yqgRjz.js";import{L as x}from"./LocationPicker-BaOIu6uD.js";import{a as u}from"./SocialLinks-6XJGczaC.js";import{a as m,L as p}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function b({value:t,onChange:i}){var a,n,r;const{t:o}=l(),[c,d]=s.useState(!1),[h,x]=s.useState(""),u=[{label:o("ai.presetLively"),value:"æ€§æ ¼æ´»æ³¼å¼€æœ—ï¼Œå–œæ¬¢å’ŒäººèŠå¤©ï¼Œè¯´è¯å……æ»¡æ´»åŠ›"},{label:o("ai.presetGentle"),value:"æ€§æ ¼æ¸©æŸ”å¯çˆ±ï¼Œè¯´è¯è½»å£°ç»†è¯­ï¼Œå¾ˆæœ‰è€å¿ƒ"},{label:o("ai.presetTsundere"),value:"è¡¨é¢å‚²å¨‡ä½†å†…å¿ƒæ¸©æŸ”ï¼Œå˜´ä¸Šè¯´ä¸è¦ä½†èº«ä½“å¾ˆè¯šå®ž"},{label:o("ai.presetEnergetic"),value:"å…ƒæ°”æ»¡æ»¡çš„ç±»åž‹ï¼Œæ€»æ˜¯å……æ»¡æ­£èƒ½é‡ï¼Œå–œæ¬¢é¼“åŠ±åˆ«äºº"},{label:o("ai.presetMysterious"),value:"æœ‰ç‚¹ç¥žç§˜é«˜å†·ï¼Œè¯ä¸å¤šä½†è¯´çš„éƒ½å¾ˆæœ‰æ·±åº¦"}],m=[{label:o("ai.toneCute"),value:'è¯´è¯å¯çˆ±ï¼Œå–œæ¬¢ç”¨"å‘¢"ã€"å“¦"ã€"å•¦"ç­‰è¯­æ°”è¯ï¼Œå¶å°”ç”¨é¢œæ–‡å­—'},{label:o("ai.toneEnergetic"),value:"è¯´è¯å……æ»¡æ´»åŠ›ï¼Œå–œæ¬¢ç”¨æ„Ÿå¹å·ï¼Œè¯­æ°”ç§¯æžå‘ä¸Š"},{label:o("ai.toneLiterary"),value:"è¯´è¯æ–‡è‰ºä¼˜é›…ï¼Œç”¨è¯è®²ç©¶ï¼Œå¶å°”å¼•ç”¨è¯—å¥"},{label:o("ai.toneJapanese"),value:"å¸¦æœ‰æ—¥ç³»äºŒæ¬¡å…ƒé£Žæ ¼ï¼Œå¶å°”ç”¨æ—¥è¯­è¯æ±‡å’Œè¡¨æƒ…"},{label:o("ai.toneNatural"),value:"è¯´è¯è‡ªç„¶éšå’Œï¼Œåƒæœ‹å‹ä¸€æ ·èŠå¤©"}],p=["Cosplay","Kigurumi",o("ai.interestAnime"),o("ai.interestGaming"),o("ai.interestDrawing"),o("ai.interestPhotography"),o("ai.interestMusic"),o("ai.interestDance"),o("ai.interestHandcraft"),o("ai.interestTravel"),o("ai.interestFood"),o("ai.interestSubculture")],b={extroversion:{label:o("ai.traitExtroversion"),low:o("ai.traitExtroversionLow"),high:o("ai.traitExtroversionHigh")},friendliness:{label:o("ai.traitFriendliness"),low:o("ai.traitFriendlinessLow"),high:o("ai.traitFriendlinessHigh")},creativity:{label:o("ai.traitCreativity"),low:o("ai.traitCreativityLow"),high:o("ai.traitCreativityHigh")},humor:{label:o("ai.traitHumor"),low:o("ai.traitHumorLow"),high:o("ai.traitHumorHigh")},energy:{label:o("ai.traitEnergy"),low:o("ai.traitEnergyLow"),high:o("ai.traitEnergyHigh")}},g=t?{...t,interests:t.interests||[],traits:t.traits||{extroversion:50,friendliness:70,creativity:50,humor:50,energy:60},advanced:t.advanced||{speakingSpeed:"normal",emojiUsage:"normal",responseLength:"medium",catchphrase:"",tabooTopics:[]},mood:t.mood||{baseMode:"positive",traits:[],intensity:50}}:{enabled:!1,personality:"",tone:"",interests:[],customPrompt:"",traits:{extroversion:50,friendliness:70,creativity:50,humor:50,energy:60},advanced:{speakingSpeed:"normal",emojiUsage:"normal",responseLength:"medium",catchphrase:"",tabooTopics:[]},mood:{baseMode:"positive",traits:[],intensity:50}},v=e=>{i({...g,...e})},f=e=>{v({advanced:{...g.advanced,...e}})},w=e=>{v({mood:{...g.mood,...e}})},j=e=>{var t;const i=(null==(t=g.mood)?void 0:t.traits)||[],s=i.includes(e)?i.filter(t=>t!==e):[...i,e];w({traits:s})},N=e=>{const t=g.interests.includes(e)?g.interests.filter(t=>t!==e):[...g.interests,e];v({interests:t})},k=()=>{const e=h.trim();e&&!g.interests.includes(e)&&(v({interests:[...g.interests,e]}),x(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white",children:o("ai.enableChat")}),e.jsx("p",{className:"text-sm text-white/50",children:o("ai.enableChatDesc")})]}),e.jsx("button",{type:"button",onClick:()=>v({enabled:!g.enabled}),className:"relative w-14 h-8 rounded-full transition-colors ".concat(g.enabled?"bg-gradient-to-r from-purple-500 to-pink-500":"bg-white/20"),children:e.jsx("span",{className:"absolute top-1 w-6 h-6 bg-white rounded-full transition-transform ".concat(g.enabled?"left-7":"left-1")})})]}),g.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white/80",children:o("ai.personality")}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:u.map(t=>e.jsx("button",{type:"button",onClick:()=>v({personality:t.value}),className:"px-3 py-1.5 rounded-lg text-sm transition ".concat(g.personality===t.value?"bg-purple-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:t.label},t.label))}),e.jsx("textarea",{value:g.personality,onChange:e=>v({personality:e.target.value}),placeholder:o("ai.personalityPlaceholder"),rows:2,className:"w-full px-4 py-3 bg-white/10 rounded-xl text-white placeholder-white/30 outline-none resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white/80",children:o("ai.tone")}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:m.map(t=>e.jsx("button",{type:"button",onClick:()=>v({tone:t.value}),className:"px-3 py-1.5 rounded-lg text-sm transition ".concat(g.tone===t.value?"bg-pink-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:t.label},t.label))}),e.jsx("textarea",{value:g.tone,onChange:e=>v({tone:e.target.value}),placeholder:o("ai.tonePlaceholder"),rows:2,className:"w-full px-4 py-3 bg-white/10 rounded-xl text-white placeholder-white/30 outline-none resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white/80",children:o("ai.interests")}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[p.map(t=>e.jsx("button",{type:"button",onClick:()=>N(t),className:"px-3 py-1.5 rounded-lg text-sm transition ".concat(g.interests.includes(t)?"bg-cyan-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:t},t)),g.interests.filter(e=>!p.includes(e)).map(t=>e.jsxs("button",{type:"button",onClick:()=>N(t),className:"px-3 py-1.5 rounded-lg text-sm bg-emerald-500 text-white flex items-center gap-1",children:[t,e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},t))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),k()),placeholder:o("ai.customInterestPlaceholder"),maxLength:20,className:"flex-1 px-4 py-2 bg-white/10 rounded-xl text-white placeholder-white/30 outline-none text-sm"}),e.jsx("button",{type:"button",onClick:k,disabled:!h.trim(),className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-400 disabled:opacity-50 rounded-xl text-white text-sm transition",children:o("ai.addButton")})]})]}),e.jsxs("button",{type:"button",onClick:()=>d(!c),className:"flex items-center gap-2 text-sm text-white/50 hover:text-white/70 transition",children:[e.jsx("svg",{className:"w-4 h-4 transition-transform ".concat(c?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),o("ai.advancedSettings")]}),c&&e.jsxs("div",{className:"space-y-6 p-4 bg-white/5 rounded-xl",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h5",{className:"text-sm font-medium text-white/80 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"}),o("ai.traitIndex")]}),Object.keys(b).map(t=>{var i,s;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/60",children:[e.jsx("span",{children:b[t].low}),e.jsxs("span",{className:"text-white/80",children:[b[t].label,": ",(null==(i=g.traits)?void 0:i[t])||50]}),e.jsx("span",{children:b[t].high})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:(null==(s=g.traits)?void 0:s[t])||50,onChange:e=>((e,t)=>{v({traits:{...g.traits,[e]:t}})})(t,parseInt(e.target.value)),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-purple-500"})]},t)})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-white/80 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-cyan-500 to-blue-500 rounded-full"}),o("ai.dialogPreference")]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.speakingPace")}),e.jsx("div",{className:"flex gap-2",children:[{value:"slow",label:o("ai.paceSlow")},{value:"normal",label:o("ai.paceNormal")},{value:"fast",label:o("ai.paceFast")}].map(t=>{var i;return e.jsx("button",{type:"button",onClick:()=>f({speakingSpeed:t.value}),className:"flex-1 px-3 py-2 rounded-lg text-sm transition ".concat((null==(i=g.advanced)?void 0:i.speakingSpeed)===t.value?"bg-cyan-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:t.label},t.value)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.emojiUsage")}),e.jsx("div",{className:"flex gap-2",children:[{value:"none",label:o("ai.emojiNone")},{value:"å°‘é‡",label:o("ai.emojiRare")},{value:"normal",label:o("ai.emojiNormal")},{value:"frequent",label:o("ai.emojiFrequent")}].map(t=>{var i;return e.jsx("button",{type:"button",onClick:()=>f({emojiUsage:t.value}),className:"flex-1 px-3 py-2 rounded-lg text-sm transition ".concat((null==(i=g.advanced)?void 0:i.emojiUsage)===t.value?"bg-cyan-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:t.label},t.value)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.responseLength")}),e.jsx("div",{className:"flex gap-2",children:[{value:"short",label:o("ai.lengthShort")},{value:"medium",label:o("ai.lengthMedium")},{value:"long",label:o("ai.lengthLong")}].map(t=>{var i;return e.jsx("button",{type:"button",onClick:()=>f({responseLength:t.value}),className:"flex-1 px-3 py-2 rounded-lg text-sm transition ".concat((null==(i=g.advanced)?void 0:i.responseLength)===t.value?"bg-cyan-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:t.label},t.value)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.catchphrase")}),e.jsx("input",{type:"text",value:(null==(a=g.advanced)?void 0:a.catchphrase)||"",onChange:e=>f({catchphrase:e.target.value}),placeholder:o("ai.catchphrasePlaceholder"),maxLength:30,className:"w-full px-4 py-2 bg-white/10 rounded-xl text-white placeholder-white/30 outline-none text-sm"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h5",{className:"text-sm font-medium text-white/80 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-gradient-to-b from-amber-500 to-orange-500 rounded-full"}),o("ai.moodTendency")]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.baseMood")}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{value:"positive",label:o("ai.moodPositive"),color:"bg-green-500"},{value:"neutral",label:o("ai.moodNeutral"),color:"bg-gray-500"},{value:"negative",label:o("ai.moodNegative"),color:"bg-blue-500"},{value:"mixed",label:o("ai.moodMixed"),color:"bg-purple-500"}].map(t=>{var i;return e.jsx("button",{type:"button",onClick:()=>w({baseMode:t.value}),className:"px-2 py-2 rounded-lg text-xs transition ".concat((null==(i=g.mood)?void 0:i.baseMode)===t.value?"".concat(t.color," text-white"):"bg-white/10 text-white/70 hover:bg-white/20"),children:t.label},t.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.moodTraits")}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] text-green-400",children:o("ai.moodPositiveLabel")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o("ai.moodPositiveTraits").split(",").map(t=>{var i,s;return e.jsx("button",{type:"button",onClick:()=>j(t),className:"px-2 py-1 rounded text-xs transition ".concat((null==(s=null==(i=g.mood)?void 0:i.traits)?void 0:s.includes(t))?"bg-green-500 text-white":"bg-white/10 text-white/60 hover:bg-white/20"),children:t},t)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] text-blue-400",children:o("ai.moodNegativeLabel")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o("ai.moodNegativeTraits").split(",").map(t=>{var i,s;return e.jsx("button",{type:"button",onClick:()=>j(t),className:"px-2 py-1 rounded text-xs transition ".concat((null==(s=null==(i=g.mood)?void 0:i.traits)?void 0:s.includes(t))?"bg-blue-500 text-white":"bg-white/10 text-white/60 hover:bg-white/20"),children:t},t)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-[10px] text-purple-400",children:o("ai.moodSpecialLabel")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:o("ai.moodSpecialTraits").split(",").map(t=>{var i,s;return e.jsx("button",{type:"button",onClick:()=>j(t),className:"px-2 py-1 rounded text-xs transition ".concat((null==(s=null==(i=g.mood)?void 0:i.traits)?void 0:s.includes(t))?"bg-purple-500 text-white":"bg-white/10 text-white/60 hover:bg-white/20"),children:t},t)})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/60",children:[e.jsx("span",{children:o("ai.moodIntensityLow")}),e.jsx("span",{className:"text-white/80",children:o("ai.moodIntensity").replace("{n}",String((null==(n=g.mood)?void 0:n.intensity)||50))}),e.jsx("span",{children:o("ai.moodIntensityHigh")})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:(null==(r=g.mood)?void 0:r.intensity)||50,onChange:e=>w({intensity:parseInt(e.target.value)}),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-amber-500"}),e.jsx("p",{className:"text-[10px] text-white/40",children:o("ai.moodIntensityHint")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-white/60",children:o("ai.customPrompt")}),e.jsx("textarea",{value:g.customPrompt||"",onChange:e=>v({customPrompt:e.target.value}),placeholder:o("ai.customPromptPlaceholder"),rows:3,className:"w-full px-4 py-3 bg-white/10 rounded-xl text-white placeholder-white/30 outline-none resize-none text-sm"}),e.jsx("p",{className:"text-xs text-white/40",children:o("ai.customPromptHint")})]})]})]})]})}function g({profileId:t}){const[i,o]=s.useState([]),[c,d]=s.useState([]),[h,x]=s.useState(!0),[u,m]=s.useState(!1),[p,b]=s.useState(null),[g,v]=s.useState(!1),[f,w]=s.useState(""),{t:j}=l(),[N,k]=s.useState(""),[y,C]=s.useState(""),[L,P]=s.useState(null),[S,M]=s.useState(""),[E,W]=s.useState("shop"),[z,B]=s.useState(""),[R,D]=s.useState(""),[H,I]=s.useState(!0),[U,T]=s.useState(""),[F,A]=s.useState(""),[O,q]=s.useState(!1),K=s.useRef(null),V=s.useRef(null);s.useEffect(()=>{J(),Y()},[t]),s.useEffect(()=>{const e=e=>{V.current&&!V.current.contains(e.target)&&q(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const J=async()=>{try{const e=await a.get("/kigurumis?profileId=".concat(t));o(e.data.kigurumis||[])}catch(e){}finally{x(!1)}},Y=async()=>{try{const e=await a.get("/shops?limit=200");d(e.data.shops||[])}catch(e){}},Q=()=>{k(""),C(""),P(null),S&&!S.startsWith("http")&&URL.revokeObjectURL(S),M(""),W("shop"),B(""),D(""),I(!0),T(""),A(""),q(!1),b(null),w("")},G=c.filter(e=>e.name.toLowerCase().includes(F.toLowerCase())||e.nameEn&&e.nameEn.toLowerCase().includes(F.toLowerCase())),_=c.find(e=>e.id===z),X=e=>"shop"===e.makerType&&e.shop?e.shop.name:"handmade"===e.makerType?j("kigurumi.handmade"):e.customMaker||j("kigurumi.other");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:j("kigurumi.myKigurumi")}),e.jsx("p",{className:"text-sm text-white/40",children:j("kigurumi.manageDesc")})]}),e.jsx("button",{onClick:()=>{Q(),m(!0)},className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-sm font-medium hover:opacity-90 transition",children:j("kigurumi.addKigurumi")})]}),h?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-20 bg-white/5 rounded-xl animate-pulse"},t))}):0===i.length?e.jsxs("div",{className:"p-8 border-2 border-dashed border-white/10 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸŽ­"}),e.jsx("p",{className:"text-white/50 mb-2",children:j("kigurumi.empty")}),e.jsx("p",{className:"text-white/30 text-sm",children:j("kigurumi.emptyHint")})]}):e.jsx("div",{className:"space-y-3",children:i.map(t=>e.jsxs("div",{className:"group relative bg-gradient-to-br from-white/[0.08] to-white/[0.02] border border-white/10 rounded-xl overflow-hidden flex items-center gap-3 p-3",children:[t.image?e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 bg-white/5",children:e.jsx("img",{src:n(t.image)||r(t.image)||t.image,alt:t.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-16 h-16 rounded-lg flex-shrink-0 bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-white/10 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸŽ­"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-white truncate",children:t.name}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium flex-shrink-0 ".concat(t.isPublic?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"),children:t.isPublic?j("kigurumi.public"):j("kigurumi.private")})]}),e.jsx("p",{className:"text-xs text-white/50 truncate mt-0.5",children:"shop"===t.makerType&&t.shop?"ðŸª ".concat(t.shop.name):X(t)}),t.likeCount>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-pink-400",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),e.jsx("span",{children:t.likeCount})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0 opacity-0 group-hover:opacity-100 transition",children:[e.jsx("button",{onClick:()=>(e=>{b(e.id),k(e.name),C(e.image),M(e.image),W(e.makerType),B(e.shopId||""),D(e.customMaker||""),I(e.isPublic),T(e.description||""),m(!0)})(t),className:"w-8 h-8 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition",title:j("kigurumi.edit"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>(async e=>{try{await a.put("/kigurumis/".concat(e.id),{isPublic:!e.isPublic}),o(t=>t.map(t=>t.id===e.id?{...t,isPublic:!t.isPublic}:t))}catch(t){}})(t),className:"w-8 h-8 rounded-lg flex items-center justify-center transition ".concat(t.isPublic?"bg-green-500/20 hover:bg-green-500/30 text-green-400":"bg-white/10 hover:bg-white/20"),title:t.isPublic?j("kigurumi.setPrivate"):j("kigurumi.setPublic"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.isPublic?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm(j("kigurumi.deleteConfirm")))try{await a.delete("/kigurumis/".concat(e)),o(t=>t.filter(t=>t.id!==e))}catch(t){}})(t.id),className:"w-8 h-8 bg-red-500/20 hover:bg-red-500/30 rounded-lg flex items-center justify-center transition text-red-400",title:j("kigurumi.deleteBtn"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id))}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center sm:p-4",children:e.jsxs("div",{className:"bg-[#1a1a24] rounded-t-2xl sm:rounded-2xl w-full sm:max-w-lg max-h-[85vh] sm:max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b border-white/10 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg",children:j(p?"kigurumi.editTitle":"kigurumi.addTitle")}),e.jsx("button",{onClick:()=>{m(!1),Q()},className:"w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto overscroll-contain p-3 sm:p-4 space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("kigurumi.nameLabel")}),e.jsx("input",{type:"text",value:N,onChange:e=>k(e.target.value),placeholder:j("kigurumi.namePlaceholder"),className:"w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 outline-none focus:border-purple-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("kigurumi.sourceLabel")}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>W("shop"),className:"flex-1 py-2 rounded-lg text-sm transition ".concat("shop"===E?"bg-purple-500 text-white":"bg-white/5 text-white/70"),children:j("kigurumi.sourceShop")}),e.jsx("button",{type:"button",onClick:()=>W("handmade"),className:"flex-1 py-2 rounded-lg text-sm transition ".concat("handmade"===E?"bg-purple-500 text-white":"bg-white/5 text-white/70"),children:j("kigurumi.sourceHandmade")}),e.jsx("button",{type:"button",onClick:()=>W("other"),className:"flex-1 py-2 rounded-lg text-sm transition ".concat("other"===E?"bg-purple-500 text-white":"bg-white/5 text-white/70"),children:j("kigurumi.sourceOther")})]}),"shop"===E&&e.jsxs("div",{ref:V,className:"relative",children:[e.jsx("div",{className:"w-full px-3 py-2.5 bg-white/5 border rounded-xl text-sm cursor-pointer transition flex items-center gap-2 ".concat(O?"border-purple-500/50":"border-white/10"),onClick:()=>q(!O),children:_?e.jsxs(e.Fragment,{children:[_.logo&&e.jsx("img",{src:r(_.logo),alt:"",className:"w-5 h-5 rounded object-cover flex-shrink-0"}),e.jsx("span",{className:"flex-1 text-white truncate",children:_.name}),e.jsx("button",{onClick:e=>{e.stopPropagation(),B(""),A("")},className:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-white/30 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("span",{className:"text-white/30 flex-1",children:j("kigurumi.searchShop")}),e.jsx("svg",{className:"w-4 h-4 text-white/30 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),O&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-[#1e1e2e] border border-white/10 rounded-xl shadow-2xl z-10 overflow-hidden",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",value:F,onChange:e=>A(e.target.value),placeholder:j("kigurumi.searchShop"),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/30 outline-none text-sm",autoFocus:!0,onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:0===G.length?e.jsx("div",{className:"px-3 py-4 text-center text-white/30 text-sm",children:j("kigurumi.noShopFound")}):G.map(t=>e.jsxs("button",{type:"button",onClick:()=>{B(t.id),q(!1),A("")},className:"w-full flex items-center gap-2.5 px-3 py-2 text-left text-sm transition ".concat(z===t.id?"bg-purple-500/20 text-purple-300":"hover:bg-white/5 text-white/80"),children:[t.logo?e.jsx("img",{src:r(t.logo),alt:"",className:"w-6 h-6 rounded object-cover flex-shrink-0"}):e.jsx("div",{className:"w-6 h-6 rounded bg-white/10 flex items-center justify-center flex-shrink-0 text-xs",children:"ðŸª"}),e.jsx("span",{className:"flex-1 truncate",children:t.name}),z===t.id&&e.jsx("svg",{className:"w-4 h-4 text-purple-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},t.id))})]})]}),"other"===E&&e.jsx("input",{type:"text",value:R,onChange:e=>D(e.target.value),placeholder:j("kigurumi.sourcePlaceholder"),className:"w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("kigurumi.imageLabel")}),S?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:S.startsWith("blob:")?S:n(S)||r(S)||S,alt:"",className:"w-32 h-32 object-cover rounded-xl"}),e.jsx("button",{onClick:()=>{P(null),S&&!S.startsWith("http")&&URL.revokeObjectURL(S),M(""),C("")},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center transition shadow-lg",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("button",{onClick:()=>{var e;return null==(e=K.current)?void 0:e.click()},className:"flex items-center gap-2 px-4 py-2.5 bg-white/5 border border-dashed border-white/20 hover:border-purple-500/50 rounded-xl text-sm text-white/40 hover:text-white/60 transition",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),j("kigurumi.clickUpload")]}),e.jsx("input",{ref:K,type:"file",accept:"image/*",onChange:async e=>{var t;const i=null==(t=e.target.files)?void 0:t[0];i&&(i.type.startsWith("image/")?i.size>10485760?w(j("kigurumi.imageTooLarge")):(P(i),S&&!S.startsWith("http")&&URL.revokeObjectURL(S),M(URL.createObjectURL(i)),w("")):w(j("kigurumi.selectImage")))},className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-white/60 mb-2",children:j("kigurumi.descLabel")}),e.jsx("textarea",{value:U,onChange:e=>T(e.target.value),placeholder:j("kigurumi.descPlaceholder"),rows:2,className:"w-full px-4 py-2.5 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 outline-none resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:j("kigurumi.publicDisplay")}),e.jsx("div",{className:"text-xs text-white/50",children:j("kigurumi.publicDisplayDesc")})]}),e.jsx("button",{type:"button",onClick:()=>I(!H),className:"w-12 h-6 rounded-full transition-colors ".concat(H?"bg-green-500":"bg-white/20"),children:e.jsx("div",{className:"w-5 h-5 bg-white rounded-full shadow transition-transform ".concat(H?"translate-x-6":"translate-x-0.5")})})]}),f&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-sm text-red-300",children:f})]}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-white/10 flex-shrink-0 bg-[#1a1a24]",children:e.jsx("button",{onClick:async()=>{var e,t;if(N.trim())if("shop"!==E||z){v(!0),w("");try{let e=y;if(L){const t=new FormData;t.append("file",L);e=(await a.post("/oss/upload/user",t,{headers:{"Content-Type":"multipart/form-data"}})).data.url}const t={name:N,image:e||"",makerType:E,shopId:"shop"===E?z:null,customMaker:"shop"!==E?R:null,isPublic:H,description:U};p?await a.put("/kigurumis/".concat(p),t):await a.post("/kigurumis",t),await J(),m(!1),Q()}catch(i){w((null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.error)||i.message||j("kigurumi.saveFailed"))}finally{v(!1)}}else w(j("kigurumi.selectShop"));else w(j("kigurumi.enterName"))},disabled:g,className:"w-full py-2.5 sm:py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 disabled:opacity-50 rounded-xl font-medium transition text-sm sm:text-base",children:j(g?"kigurumi.saving":"kigurumi.save")})})]})})]})}function v({imageUrl:t,initialPosition:i={x:50,y:50},onSave:l,onCancel:a}){const[n,r]=s.useState(i),[o,c]=s.useState(!1),[d,h]=s.useState(0),[x,u]=s.useState(i.y),m=s.useRef(null),p=s.useCallback(e=>{c(!0),h(e),u(n.y)},[n.y]),b=s.useCallback(e=>{if(!o||!m.current)return;const t=m.current.clientHeight,i=(e-d)/t*100,s=Math.max(0,Math.min(100,x-i));r(e=>({...e,y:s}))},[o,d,x]),g=s.useCallback(()=>{c(!1)},[]);s.useEffect(()=>{const e=e=>b(e.clientY),t=e=>{e.touches.length>0&&b(e.touches[0].clientY)},i=()=>g();return o&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",i),window.addEventListener("touchmove",t,{passive:!0}),window.addEventListener("touchend",i)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",i),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",i)}},[o,b,g]);return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/95 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-black/50 backdrop-blur-sm border-b border-white/10",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-white/70 hover:text-white transition-colors",children:"å–æ¶ˆ"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-white font-medium",children:"è°ƒæ•´å°é¢ä½ç½®"}),e.jsx("p",{className:"text-white/50 text-xs mt-0.5",children:"ä¸Šä¸‹æ‹–åŠ¨å›¾ç‰‡è°ƒæ•´æ˜¾ç¤ºåŒºåŸŸ"})]}),e.jsx("button",{onClick:()=>l(n),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-medium hover:opacity-90 transition-opacity",children:"ä¿å­˜"})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 overflow-hidden",children:[e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsx("p",{className:"text-white/40 text-xs text-center mb-2",children:"é¢„è§ˆæ•ˆæžœ"}),e.jsxs("div",{ref:m,className:"relative w-full aspect-[16/9] md:aspect-[21/9] rounded-xl overflow-hidden cursor-grab active:cursor-grabbing select-none",onMouseDown:e=>{e.preventDefault(),p(e.clientY)},onTouchStart:e=>{p(e.touches[0].clientY)},children:[e.jsx("img",{src:t,alt:"å°é¢é¢„è§ˆ",className:"w-full h-full object-cover pointer-events-none",style:{objectPosition:"".concat(n.x,"% ").concat(n.y,"%")},draggable:!1}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center transition-opacity ".concat(o?"opacity-0":"opacity-100"),children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm px-4 py-2 rounded-full flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-white/70 animate-bounce",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),e.jsx("span",{className:"text-white/70 text-sm",children:"æ‹–åŠ¨è°ƒæ•´"})]})}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/3 left-0 right-0 border-t border-white/20 border-dashed"}),e.jsx("div",{className:"absolute top-2/3 left-0 right-0 border-t border-white/20 border-dashed"})]})]})]}),e.jsx("div",{className:"flex items-center gap-3 mt-6",children:[{label:"é¡¶éƒ¨",y:0},{label:"ä¸­é—´",y:50},{label:"åº•éƒ¨",y:100}].map(t=>e.jsx("button",{onClick:()=>r(e=>({...e,y:t.y})),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat(Math.abs(n.y-t.y)<5?"bg-purple-500 text-white":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"),children:t.label},t.label))}),e.jsxs("div",{className:"w-full max-w-md mt-6 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50 mb-2",children:[e.jsx("span",{children:"é¡¶éƒ¨"}),e.jsxs("span",{children:["åž‚ç›´ä½ç½®: ",Math.round(n.y),"%"]}),e.jsx("span",{children:"åº•éƒ¨"})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:n.y,onChange:e=>r(t=>({...t,y:Number(e.target.value)})),className:"w-full h-2 bg-white/10 rounded-full appearance-none cursor-pointer\n              [&::-webkit-slider-thumb]:appearance-none\n              [&::-webkit-slider-thumb]:w-5\n              [&::-webkit-slider-thumb]:h-5\n              [&::-webkit-slider-thumb]:rounded-full\n              [&::-webkit-slider-thumb]:bg-gradient-to-r\n              [&::-webkit-slider-thumb]:from-purple-500\n              [&::-webkit-slider-thumb]:to-pink-500\n              [&::-webkit-slider-thumb]:cursor-pointer\n              [&::-webkit-slider-thumb]:shadow-lg\n              [&::-webkit-slider-thumb]:shadow-purple-500/30\n              [&::-moz-range-thumb]:w-5\n              [&::-moz-range-thumb]:h-5\n              [&::-moz-range-thumb]:rounded-full\n              [&::-moz-range-thumb]:bg-gradient-to-r\n              [&::-moz-range-thumb]:from-purple-500\n              [&::-moz-range-thumb]:to-pink-500\n              [&::-moz-range-thumb]:cursor-pointer\n              [&::-moz-range-thumb]:border-0"})]})]}),e.jsx("div",{className:"px-4 py-3 bg-black/50 backdrop-blur-sm border-t border-white/10",children:e.jsx("p",{className:"text-white/40 text-xs text-center",children:"ðŸ’¡ æç¤ºï¼šè°ƒæ•´åŽçš„ä½ç½®å°†åº”ç”¨åˆ°ä½ çš„ä¸ªäººä¸»é¡µå°é¢"})})]})}function f({imageFile:t,onCrop:i,onCancel:l}){const a=s.useRef(null),n=s.useRef(null),[r,o]=s.useState(null),[c,d]=s.useState(1),[h,x]=s.useState(0),[u,m]=s.useState(0),[p,b]=s.useState(200),[g,v]=s.useState(!1),[f,w]=s.useState(!1),[j,N]=s.useState(0),[k,y]=s.useState(0),[C,L]=s.useState(0),[P,S]=s.useState(0),[M,E]=s.useState(0);s.useEffect(()=>{const e=new Image,i=URL.createObjectURL(t);return e.onload=()=>{o(e);const t=.9*Math.min(e.width,e.height);x((e.width-t)/2),m((e.height-t)/2),b(t)},e.src=i,()=>URL.revokeObjectURL(i)},[t]),s.useEffect(()=>{if(!r||!a.current||!n.current)return;const e=a.current,t=e.getContext("2d");if(!t)return;const i=n.current.clientWidth-32,s=Math.min(i/r.width,400/r.height,1);d(s),e.width=r.width*s,e.height=r.height*s,t.drawImage(r,0,0,e.width,e.height),t.fillStyle="rgba(0, 0, 0, 0.6)",t.fillRect(0,0,e.width,e.height);const l=h*s,o=u*s,c=p*s;t.save(),t.beginPath(),t.rect(l,o,c,c),t.clip(),t.drawImage(r,0,0,e.width,e.height),t.restore(),t.strokeStyle="#a855f7",t.lineWidth=2,t.strokeRect(l,o,c,c);t.fillStyle="#a855f7";[{x:l+c,y:o+c/2},{x:l+c/2,y:o+c},{x:l,y:o+c/2},{x:l+c/2,y:o}].forEach(e=>{t.beginPath(),t.arc(e.x,e.y,8,0,2*Math.PI),t.fill()})},[r,h,u,p]);const W=s.useCallback(e=>{if(!a.current)return{x:0,y:0};const t=a.current.getBoundingClientRect();return{x:(e.clientX-t.left)/c,y:(e.clientY-t.top)/c}},[c]),z=s.useCallback((e,t)=>{const i=20/c,s=h+p/2,l=u+p/2;return[{x:h+p,y:l},{x:s,y:u+p},{x:h,y:l},{x:s,y:u}].some(s=>Math.sqrt((e-s.x)**2+(t-s.y)**2)<i)},[h,u,p,c]),B=s.useCallback((e,t)=>e>=h&&e<=h+p&&t>=u&&t<=u+p,[h,u,p]),R=s.useCallback(e=>{e.preventDefault();const{x:t,y:i}=W(e);z(t,i)?(w(!0),N(t),y(i),E(p),L(h),S(u)):B(t,i)&&(v(!0),N(t),y(i),L(h),S(u))},[W,z,B,h,u,p]),D=s.useCallback(e=>{if(!r)return;const{x:t,y:i}=W(e);if(g){const e=t-j,s=i-k,l=Math.max(0,Math.min(r.width-p,C+e)),a=Math.max(0,Math.min(r.height-p,P+s));x(l),m(a)}else if(f){const e=C+M/2,s=P+M/2,l=Math.max(Math.abs(t-e),Math.abs(i-s)),a=Math.max(50,Math.min(2*l,Math.min(r.width,r.height))),n=Math.max(0,Math.min(r.width-a,e-a/2)),o=Math.max(0,Math.min(r.height-a,s-a/2));b(a),x(n),m(o)}},[r,g,f,j,k,C,P,M,p]),H=s.useCallback(()=>{v(!1),w(!1)},[]),I=s.useCallback(()=>{if(!r)return;const e=400,t=document.createElement("canvas");t.width=e,t.height=e;const s=t.getContext("2d");s&&(s.drawImage(r,h,u,p,p,0,0,e,e),t.toBlob(e=>{e&&i(e)},"image/jpeg",.9))},[r,h,u,p,i]);return r?e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1a1a24] rounded-2xl max-w-lg w-full overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"è£å‰ªå¤´åƒ"}),e.jsx("p",{className:"text-sm text-white/50 mt-1",children:"æ‹–åŠ¨è°ƒæ•´ä½ç½®ï¼Œæ‹–åŠ¨è¾¹ç¼˜åœ†ç‚¹è°ƒæ•´å¤§å°"})]}),e.jsx("div",{ref:n,className:"relative bg-black flex items-center justify-center p-4",children:e.jsx("canvas",{ref:a,className:"max-w-full cursor-move touch-none select-none",style:{maxHeight:400},onPointerDown:R,onPointerMove:D,onPointerUp:H,onPointerLeave:H})}),e.jsxs("div",{className:"px-6 py-4 border-t border-white/10 flex justify-end gap-3",children:[e.jsx("button",{onClick:l,className:"px-5 py-2.5 text-sm font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 rounded-xl transition",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:I,className:"px-5 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 rounded-xl transition",children:"ç¡®è®¤è£å‰ª"})]})]})}):e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})})}function w({src:t,isCover:i,isNew:l,onSetCover:a,onDelete:n,onMoveUp:r,onMoveDown:o}){const[c,d]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative aspect-square group rounded-xl overflow-hidden bg-white/5",children:[e.jsx("img",{src:t,className:"w-full h-full object-cover",alt:""}),i&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-0.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded text-[10px] font-medium",children:"å°é¢"}),l&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-0.5 bg-green-500/80 rounded text-[10px] font-medium",children:"æ–°"}),e.jsx("button",{onClick:()=>d(!0),className:"absolute top-2 right-2 w-7 h-7 bg-black/60 backdrop-blur-sm text-white rounded-full flex items-center justify-center md:hidden","aria-label":"ç¼–è¾‘",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition hidden md:flex items-center justify-center gap-2",children:[a&&e.jsx("button",{onClick:a,className:"w-8 h-8 rounded-full flex items-center justify-center transition ".concat(i?"bg-purple-500 text-white":"bg-white/20 hover:bg-purple-500 text-white"),title:"è®¾ä¸ºå°é¢",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),r&&e.jsx("button",{onClick:r,className:"w-8 h-8 bg-white/20 hover:bg-white/40 text-white rounded-full flex items-center justify-center transition",title:"å‰ç§»",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),o&&e.jsx("button",{onClick:o,className:"w-8 h-8 bg-white/20 hover:bg-white/40 text-white rounded-full flex items-center justify-center transition",title:"åŽç§»",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("button",{onClick:n,className:"w-8 h-8 bg-white/20 hover:bg-red-500 text-white rounded-full flex items-center justify-center transition",title:"åˆ é™¤",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c&&e.jsxs("div",{className:"fixed inset-0 z-[100] md:hidden",onClick:()=>d(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/60"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-[#1a1a24] rounded-t-2xl p-4 pb-8 animate-in slide-in-from-bottom duration-200",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-4 border-b border-white/10",children:[e.jsx("img",{src:t,className:"w-14 h-14 rounded-lg object-cover",alt:""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-white/80",children:"ç…§ç‰‡æ“ä½œ"}),i&&e.jsx("span",{className:"text-xs text-purple-400",children:"å½“å‰å°é¢"})]})]}),e.jsxs("div",{className:"space-y-2",children:[a&&!i&&e.jsxs("button",{onClick:()=>{a(),d(!1)},className:"w-full py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"è®¾ä¸ºå°é¢"]}),e.jsxs("div",{className:"flex gap-2",children:[r&&e.jsxs("button",{onClick:()=>{r(),d(!1)},className:"flex-1 py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"å‰ç§»"]}),o&&e.jsxs("button",{onClick:()=>{o(),d(!1)},className:"flex-1 py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition",children:["åŽç§»",e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("button",{onClick:()=>{n(),d(!1)},className:"w-full py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"åˆ é™¤ç…§ç‰‡"]})]}),e.jsx("button",{onClick:()=>d(!1),className:"w-full mt-3 py-3 bg-white/10 text-white/60 rounded-xl text-sm font-medium transition hover:bg-white/15",children:"å–æ¶ˆ"})]})]})]})}function j({existingPhotos:t,previews:i,coverImage:a,coverPosition:n,totalPhotos:o,onSetCover:c,onRemovePhoto:d,onReorderPhotos:h,onAddPhotos:x,onAdjustCoverPosition:u,fileInputRef:m,handlePhotoSelect:p}){const{t:b}=l(),[g,v]=s.useState(!1),[f,j]=s.useState(!1),[N,k]=s.useState(0);s.useEffect(()=>{const e=()=>j(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const y=[...t.map((e,t)=>({src:r(e)||e,isExisting:!0,index:t,originalSrc:e})),...i.map((e,t)=>({src:e,isExisting:!1,index:t,originalSrc:e}))],C=g||o<=12?y:y.slice(0,12),L=o>12,P=o-12;return e.jsxs("div",{className:"space-y-6",children:[a&&e.jsxs("div",{className:"p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:b("media.coverImage")}),e.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:b("media.coverHint")})]}),e.jsxs("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-purple-400 bg-purple-500/10 hover:bg-purple-500/20 rounded-lg transition-all flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),b("media.adjustPosition")]})]}),e.jsxs("div",{className:"relative w-full aspect-[21/9] rounded-xl overflow-hidden bg-white/5",children:[e.jsx("img",{src:r(a)||a,alt:b("media.coverPreview"),className:"w-full h-full object-cover",style:{objectPosition:"".concat(n.x,"% ").concat(n.y,"%")}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"}),e.jsx("div",{className:"absolute bottom-3 left-3 text-xs text-white/60",children:b("media.currentPosition").replace("{n}",String(Math.round(n.y)))})]})]}),e.jsxs("div",{className:"p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:b("media.photoWall")}),e.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:b("media.photoWallHint").replace("{max}",String(30))})]}),e.jsxs("span",{className:"text-sm text-white/40 bg-white/5 px-3 py-1 rounded-full",children:[o,"/",30]})]}),f&&o>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative aspect-square rounded-xl overflow-hidden bg-white/5",children:y[N]&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:y[N].src,className:"w-full h-full object-cover",alt:""}),y[N].isExisting&&a===y[N].originalSrc&&e.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded text-xs font-medium",children:b("media.cover")}),!y[N].isExisting&&e.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 bg-green-500/80 rounded text-xs font-medium",children:b("media.new")}),e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 flex justify-center gap-2",children:[y[N].isExisting&&e.jsx("button",{onClick:()=>c(y[N].originalSrc),className:"px-3 py-2 rounded-lg text-xs font-medium transition ".concat(a===y[N].originalSrc?"bg-purple-500 text-white":"bg-black/60 backdrop-blur-sm text-white hover:bg-purple-500"),children:b("media.setCover")}),e.jsx("button",{onClick:()=>{const e=y[N];e.isExisting&&a===e.originalSrc&&c(null),d(e.index,e.isExisting),N>=y.length-1&&N>0&&k(N-1)},className:"px-3 py-2 bg-red-500/80 backdrop-blur-sm text-white rounded-lg text-xs font-medium",children:b("media.delete")})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{k(e=>Math.max(0,e-1))},disabled:0===N,className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"text-sm text-white/60",children:[N+1," / ",y.length]}),e.jsx("button",{onClick:()=>{k(e=>Math.min(y.length-1,e+1))},disabled:N>=y.length-1,className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[y.map((t,i)=>e.jsx("button",{onClick:()=>k(i),className:"flex-shrink-0 w-14 h-14 rounded-lg overflow-hidden transition ".concat(i===N?"ring-2 ring-purple-500":"opacity-60 hover:opacity-100"),children:e.jsx("img",{src:t.src,className:"w-full h-full object-cover",alt:""})},"thumb-".concat(t.isExisting?"e":"n","-").concat(t.index))),o<30&&e.jsx("button",{onClick:x,className:"flex-shrink-0 w-14 h-14 border-2 border-dashed border-white/20 hover:border-purple-500/50 rounded-lg flex items-center justify-center text-white/40 hover:text-purple-400 transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3",children:[C.map(i=>e.jsx(w,{src:i.src,isCover:i.isExisting&&a===i.originalSrc,isNew:!i.isExisting,onSetCover:i.isExisting?()=>c(i.originalSrc):void 0,onDelete:()=>{i.isExisting&&a===i.originalSrc&&c(null),d(i.index,i.isExisting)},onMoveUp:i.isExisting&&i.index>0?()=>{const e=[...t];[e[i.index-1],e[i.index]]=[e[i.index],e[i.index-1]],h(e)}:void 0,onMoveDown:i.isExisting&&i.index<t.length-1?()=>{const e=[...t];[e[i.index],e[i.index+1]]=[e[i.index+1],e[i.index]],h(e)}:void 0},"".concat(i.isExisting?"e":"n","-").concat(i.index))),o<30&&(g||o<=12)&&e.jsxs("button",{onClick:x,className:"aspect-square border-2 border-dashed border-white/10 hover:border-purple-500/50 rounded-xl flex flex-col items-center justify-center text-white/30 hover:text-purple-400 transition-all hover:bg-purple-500/5",children:[e.jsx("svg",{className:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-xs",children:b("media.add")})]})]}),L&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>v(!g),className:"inline-flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 rounded-xl text-sm text-white/70 hover:text-white transition-all",children:g?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),b("media.collapsePhotos")]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),b("media.viewAll").replace("{n}",String(P))]})})})]}),e.jsx("input",{ref:m,type:"file",accept:"image/*",multiple:!0,onChange:p,className:"hidden"})]})]})}function N(){var a,n,w;const N=m(),k=t(),{isAuthenticated:y,fetchUser:C,user:L}=o(),{t:P}=l(),[S,M]=s.useState("profile"),[E,W]=s.useState(""),[z,B]=s.useState(null),[R,D]=s.useState(null),[H,I]=s.useState(null),[U,T]=s.useState(!1),[F,A]=s.useState(null),[O,q]=s.useState(null),[K,V]=s.useState({x:50,y:50}),[J,Y]=s.useState(!1),[Q,G]=s.useState(""),[_,X]=s.useState([]),[Z,$]=s.useState([]),[ee,te]=s.useState([]),[ie,se]=s.useState(void 0),[le,ae]=s.useState(!1),[ne,re]=s.useState(!1),[oe,ce]=s.useState(!1),[de,he]=s.useState(""),[xe,ue]=s.useState(""),[me,pe]=s.useState(!1),[be,ge]=s.useState(!1),[ve,fe]=s.useState({}),[we,je]=s.useState(null),[Ne,ke]=s.useState(""),[ye,Ce]=s.useState(null),Le=s.useRef(null),Pe=s.useRef(null),{data:Se,isLoading:Me}=i({queryKey:["profile"],queryFn:()=>d.getProfile().then(e=>e.data),enabled:y}),Ee=null==Se?void 0:Se.profile;s.useEffect(()=>{Ee&&(W(Ee.cnName||""),B(Ee.avatar||null),q(Ee.coverImage||null),V(Ee.coverPosition||{x:50,y:50}),G(Ee.introduction||""),te(Ee.photos||[]),Ee.location&&(Ee.location.lat||Ee.location.lng)&&se({lat:Ee.location.lat,lng:Ee.location.lng,country:Ee.location.country||"",province:Ee.location.province,city:Ee.location.city}),fe(Ee.socialLinks||{}),je(Ee.aiPersonality||null),ke(Ee.id||""),ae(Ee.hideLocation||!1),ge(!0),Ce({cnName:Ee.cnName||"",introduction:Ee.introduction||"",avatar:Ee.avatar||null,coverImage:Ee.coverImage||null,coverPosition:Ee.coverPosition||{x:50,y:50},photos:Ee.photos||[],location:Ee.location&&(Ee.location.lat||Ee.location.lng)?{lat:Ee.location.lat,lng:Ee.location.lng,country:Ee.location.country||"",province:Ee.location.province,city:Ee.location.city}:void 0,hideLocation:Ee.hideLocation||!1,socialLinks:Ee.socialLinks||{},aiPersonality:Ee.aiPersonality||null}))},[Ee]),s.useEffect(()=>{y||N("/login")},[y,N]);const We=H||z||ee[0],ze=ee.length+_.length,Be=s.useCallback(()=>!!ye&&(E!==ye.cnName||(Q!==ye.introduction||(null!==R||(_.length>0||(ee.length!==ye.photos.length||(!!ee.some((e,t)=>e!==ye.photos[t])||(O!==ye.coverImage||(K.x!==ye.coverPosition.x||K.y!==ye.coverPosition.y||(JSON.stringify(ie)!==JSON.stringify(ye.location)||(le!==ye.hideLocation||(JSON.stringify(ve)!==JSON.stringify(ye.socialLinks)||JSON.stringify(we)!==JSON.stringify(ye.aiPersonality)))))))))))),[E,Q,R,_,ee,O,K,ie,le,ve,we,ye]),[Re,De]=s.useState(!1),[He,Ie]=s.useState(null);s.useEffect(()=>{const e=e=>{if(Be())return e.preventDefault(),e.returnValue="",""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[Be]);const Ue=s.useCallback(e=>{e.preventDefault(),Be()?(Ie("/"),De(!0)):N("/")},[Be,N]),Te=s.useCallback(()=>{De(!1),He&&(N(He),Ie(null))},[N,He]),Fe=s.useCallback(async()=>{De(!1),Ie(null),await Oe()},[]),Ae=s.useCallback(()=>{De(!1),Ie(null)},[]),Oe=async()=>{var e,t,i,s,l;if(he(""),ue(""),!E.trim())return he(P("editProfile.errCnName")),void M("profile");if(!Q.trim())return he(P("editProfile.errIntro")),void M("profile");if(0===ze)return he(P("editProfile.errPhoto")),void M("media");if(!ie)return he(P("editProfile.errLocation")),void M("profile");re(!0);try{let s=[...ee],l=z;if(_.length>0||R){for(const e of _){const t=await c(e);s.push(t)}R&&(l=await c(R))}const a={cnName:E,introduction:Q,photos:s,avatar:l,coverImage:O,coverPosition:K,location:{lat:ie.lat,lng:ie.lng,country:ie.country,province:ie.province,city:ie.city},hideLocation:le,socialLinks:ve,aiPersonality:we},n=await d.updateProfile(a);ue(P("editProfile.saveSuccess")),await C(),await k.invalidateQueries({queryKey:["profile"]}),await k.invalidateQueries({queryKey:["users"]}),await k.invalidateQueries({queryKey:["stats"]}),localStorage.setItem("profile_updated_at",Date.now().toString());const r=(null==(t=null==(e=n.data)?void 0:e.profile)?void 0:t.shareCode)||(null==(i=n.data)?void 0:i.shareCode);setTimeout(()=>{N(r?"/u/".concat(r):"/")},1500)}catch(a){he((null==(l=null==(s=a.response)?void 0:s.data)?void 0:l.error)||a.message||P("editProfile.saveFailed"))}finally{re(!1)}},qe=[{id:"profile",label:P("editProfile.sectionProfile"),icon:"ðŸ‘¤",desc:P("editProfile.sectionProfileDesc")},{id:"media",label:P("editProfile.sectionMedia"),icon:"ðŸ“·",desc:P("editProfile.sectionMediaDesc")},{id:"social",label:P("editProfile.sectionSocial"),icon:"ðŸ”—",desc:P("editProfile.sectionSocialDesc")},{id:"ai",label:P("editProfile.sectionAI"),icon:"ðŸ¤–",desc:P("editProfile.sectionAIDesc")},...be?[{id:"kigurumi",label:P("editProfile.sectionKigurumi"),icon:"ðŸŽ­",desc:P("editProfile.sectionKigurumiDesc")}]:[],...(null==L?void 0:L.managedShops)&&L.managedShops.length>0?[{id:"shop",label:P("editProfile.sectionShop"),icon:"ðŸª",desc:P("editProfile.sectionShopDesc")}]:[],...be?[{id:"danger",label:P("editProfile.sectionDanger"),icon:"âš ï¸",desc:P("editProfile.sectionDangerDesc")}]:[]];return Me?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#0a0a0f]",children:e.jsx("div",{className:"w-10 h-10 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f]",children:[e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-purple-900/10 via-transparent to-cyan-900/10 pointer-events-none"}),e.jsx("header",{className:"sticky top-0 z-50 backdrop-blur-xl bg-[#0a0a0f]/80 border-b border-white/[0.06]",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:Ue,className:"flex items-center gap-2 text-white/60 hover:text-white transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline text-sm",children:P("editProfile.back")})]}),e.jsx("div",{className:"h-6 w-px bg-white/10 hidden sm:block"}),e.jsx("h1",{className:"text-lg font-semibold",children:P(be?"editProfile.title":"editProfile.createTitle")}),Be()&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs font-medium text-amber-400 bg-amber-500/20 rounded",children:P("editProfile.unsaved")})]}),e.jsx("button",{onClick:Oe,disabled:ne,className:"px-5 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 disabled:opacity-50 rounded-xl text-sm font-medium transition-all hover:shadow-lg hover:shadow-purple-500/25",children:P(ne?"editProfile.saving":"editProfile.save")})]})}),e.jsx("main",{className:"relative max-w-5xl mx-auto px-4 py-6 pb-32 md:pb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("aside",{className:"hidden md:block w-64 flex-shrink-0",children:e.jsx("div",{className:"sticky top-24 bg-white/[0.02] border border-white/[0.06] rounded-2xl p-2 space-y-1",children:qe.map(t=>e.jsxs("button",{onClick:()=>M(t.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all ".concat(S===t.id?"bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-white border border-purple-500/30":"text-white/60 hover:text-white hover:bg-white/[0.04]"),children:[e.jsx("span",{className:"text-lg",children:t.icon}),e.jsx("span",{className:"text-sm font-medium",children:t.label})]},t.id))})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{children:null==(a=qe.find(e=>e.id===S))?void 0:a.icon}),null==(n=qe.find(e=>e.id===S))?void 0:n.label]}),e.jsx("p",{className:"text-sm text-white/50 mt-1",children:null==(w=qe.find(e=>e.id===S))?void 0:w.desc})]}),"profile"===S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-6 p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl",children:[e.jsxs("button",{onClick:()=>{var e;return null==(e=Pe.current)?void 0:e.click()},className:"relative group flex-shrink-0",children:[e.jsx("div",{className:"w-24 h-24 rounded-2xl overflow-hidden bg-white/5 ring-2 ring-white/10 group-hover:ring-purple-500/50 transition-all",children:We?e.jsx("img",{src:We,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/20",children:e.jsx("svg",{className:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 rounded-2xl transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"})})})]}),e.jsx("input",{ref:Pe,type:"file",accept:"image/*",onChange:async e=>{var t;const i=null==(t=e.target.files)?void 0:t[0];if(!i)return;const s=h(i);s?he(s):(A(i),T(!0))},className:"hidden"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:P("editProfile.avatar")}),e.jsx("p",{className:"text-xs text-white/40",children:P("editProfile.avatarHint")}),e.jsx("button",{onClick:()=>{var e;return null==(e=Pe.current)?void 0:e.click()},className:"mt-3 px-4 py-2 text-sm text-purple-400 hover:text-purple-300 bg-purple-500/10 hover:bg-purple-500/20 rounded-lg transition",children:P("editProfile.changeAvatar")})]})]}),e.jsxs("div",{className:"p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:[P("editProfile.cnName")," ",e.jsx("span",{className:"text-pink-400",children:P("editProfile.required")})]}),e.jsx("input",{type:"text",value:E,onChange:e=>W(e.target.value),placeholder:P("editProfile.cnNamePlaceholder"),className:"w-full px-4 py-3 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white placeholder-white/30 outline-none focus:border-purple-500/50 focus:bg-white/[0.05] transition-all",maxLength:30}),e.jsx("p",{className:"text-xs text-white/30 mt-1.5",children:P("editProfile.cnNameHint")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:[P("editProfile.introduction")," ",e.jsx("span",{className:"text-pink-400",children:P("editProfile.required")})]}),e.jsx("textarea",{value:Q,onChange:e=>G(e.target.value),placeholder:P("editProfile.introPlaceholder"),rows:4,className:"w-full px-4 py-3 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white placeholder-white/30 outline-none focus:border-purple-500/50 focus:bg-white/[0.05] transition-all resize-none",maxLength:500}),e.jsxs("div",{className:"flex justify-between text-xs text-white/30 mt-1.5",children:[e.jsx("span",{children:P("editProfile.introHint")}),e.jsxs("span",{children:[Q.length,"/500"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-white/80 mb-2",children:[P("editProfile.location")," ",e.jsx("span",{className:"text-pink-400",children:P("editProfile.required")})]}),e.jsx(x,{value:ie,onChange:se}),e.jsx("p",{className:"text-xs text-white/30 mt-1.5",children:P("editProfile.locationHint")})]}),e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-white/80",children:P("editProfile.hideLocation")}),e.jsx("p",{className:"text-xs text-white/30 mt-1",children:P("editProfile.hideLocationHint")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":le,onClick:()=>ae(!le),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-[#0a0a0f] ".concat(le?"bg-purple-500":"bg-white/10"),children:e.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ".concat(le?"translate-x-5":"translate-x-0")})})]})]})]}),"media"===S&&e.jsx(j,{existingPhotos:ee,previews:Z,coverImage:O,coverPosition:K,totalPhotos:ze,onSetCover:q,onRemovePhoto:(e,t)=>{t?te(t=>t.filter((t,i)=>i!==e)):(URL.revokeObjectURL(Z[e]),X(t=>t.filter((t,i)=>i!==e)),$(t=>t.filter((t,i)=>i!==e)))},onReorderPhotos:te,onAddPhotos:()=>{var e;return null==(e=Le.current)?void 0:e.click()},onAdjustCoverPosition:()=>Y(!0),fileInputRef:Le,handlePhotoSelect:async e=>{const t=Array.from(e.target.files||[]);if(ze+t.length>30)he(P("editProfile.errPhotoMax"));else{he("");for(const e of t){const t=h(e);if(t)return void he(t);X(t=>[...t,e]),$(t=>[...t,URL.createObjectURL(e)])}}}}),"social"===S&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl",children:[e.jsxs("h3",{className:"text-sm font-medium text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full"}),P("editProfile.socialMediaTitle")]}),e.jsx(u,{value:ve,onChange:fe})]})}),"ai"===S&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl",children:[e.jsxs("h3",{className:"text-sm font-medium text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full"}),P("editProfile.aiTitle")]}),e.jsx("p",{className:"text-sm text-white/50 mb-4",children:P("editProfile.aiDesc")}),e.jsx(b,{value:we,onChange:je})]})}),"kigurumi"===S&&Ne&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"p-6 bg-white/[0.02] border border-white/[0.06] rounded-2xl",children:e.jsx(g,{profileId:Ne})})}),"shop"===S&&(null==L?void 0:L.managedShops)&&L.managedShops.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-white/50 mb-4",children:P("editProfile.shopManageDesc")}),L.managedShops.map(t=>e.jsx(p,{to:"/edit-shop/".concat(t.slug),className:"block p-6 bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20 rounded-2xl hover:border-purple-500/40 transition group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center flex-shrink-0 overflow-hidden",children:t.logo?e.jsx("img",{src:r(t.logo),alt:"",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-3xl",children:"ðŸª"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:t.name}),e.jsxs("p",{className:"text-sm text-white/50",children:["/",t.slug]})]}),e.jsx("svg",{className:"w-6 h-6 text-white/30 group-hover:text-white/60 group-hover:translate-x-1 transition-all",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},t.id))]}),"danger"===S&&e.jsx("div",{className:"p-6 bg-white/[0.02] border border-red-500/20 rounded-2xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-400",children:P("editProfile.deleteProfile")}),e.jsx("p",{className:"text-xs text-white/40 mt-1",children:P("editProfile.deleteProfileDesc")})]}),e.jsx("button",{onClick:()=>pe(!0),className:"px-5 py-2.5 text-sm font-medium text-red-400 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 hover:border-red-500/40 rounded-xl transition-all",children:P("editProfile.deleteProfile")})]})})]})]})}),e.jsx("nav",{className:"md:hidden fixed bottom-0 left-0 right-0 z-40 bg-[#0a0a0f]/95 backdrop-blur-xl border-t border-white/[0.06]",children:e.jsx("div",{className:"flex overflow-x-auto scrollbar-hide",children:qe.map(t=>e.jsxs("button",{onClick:()=>M(t.id),className:"flex-1 min-w-[60px] flex flex-col items-center gap-1 py-3 px-2 transition-all ".concat(S===t.id?"text-purple-400":"text-white/40"),children:[e.jsx("span",{className:"text-lg",children:t.icon}),e.jsx("span",{className:"text-[10px] font-medium truncate",children:t.label.split(" ")[0]})]},t.id))})}),(de||xe)&&e.jsx("div",{className:"fixed top-20 left-4 right-4 max-w-md mx-auto p-4 rounded-2xl shadow-2xl z-50 ".concat(de?"bg-red-500/20 border border-red-500/30 text-red-300":"bg-green-500/20 border border-green-500/30 text-green-300"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm",children:de||xe}),e.jsx("button",{onClick:()=>{he(""),ue("")},className:"ml-auto text-white/50 hover:text-white",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),me&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1a1a24] rounded-2xl p-6 max-w-sm w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:P("editProfile.deleteConfirmTitle")}),e.jsx("p",{className:"text-white/60 text-sm",children:P("editProfile.deleteConfirmDesc")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>pe(!1),className:"flex-1 py-3 bg-white/5 hover:bg-white/10 rounded-xl font-medium transition",children:P("editProfile.cancel")}),e.jsx("button",{onClick:async()=>{var e,t;ce(!0);try{await d.deleteProfile(),await C(),N("/")}catch(i){he((null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.error)||P("editProfile.deleteFailed")),pe(!1)}finally{ce(!1)}},disabled:oe,className:"flex-1 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl font-medium transition disabled:opacity-50",children:P(oe?"editProfile.deleting":"editProfile.confirmDelete")})]})]})}),J&&O&&e.jsx(v,{imageUrl:r(O)||O,initialPosition:K,onSave:e=>{V(e),Y(!1)},onCancel:()=>Y(!1)}),U&&F&&e.jsx(f,{imageFile:F,onCrop:async e=>{T(!1),A(null);const t=new File([e],"avatar.png",{type:"image/png"});D(t),I(URL.createObjectURL(e))},onCancel:()=>{T(!1),A(null),Pe.current&&(Pe.current.value="")}}),Re&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1a1a24] rounded-2xl p-6 max-w-sm w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-amber-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:P("editProfile.unsavedTitle")}),e.jsx("p",{className:"text-white/60 text-sm",children:P("editProfile.unsavedDesc")})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:Fe,className:"w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 text-white rounded-xl font-medium transition",children:P("editProfile.saveAndLeave")}),e.jsx("button",{onClick:Te,className:"w-full py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-xl font-medium transition",children:P("editProfile.dontSave")}),e.jsx("button",{onClick:Ae,className:"w-full py-3 bg-white/5 hover:bg-white/10 text-white/60 rounded-xl font-medium transition",children:P("editProfile.cancel")})]})]})})]})}export{N as default};
