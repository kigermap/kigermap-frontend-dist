import{j as e}from"./query-DSsWWIdM.js";import{a as t}from"./sentry-DvvTOdwe.js";import{u as s,a as r,L as a,l as i,b as l}from"./index-D0yqgRjz.js";import{A as n}from"./AliyunCaptcha-Drnlehh6.js";import{c as o,a as d,u as c,L as m}from"./router-jbVFofSC.js";import"./store-BXxpTH1V.js";function u(){var u,x;const[h]=o(),p="phone"===h.get("mode")?"phone":"email",g="k"===h.get("_m"),[w,b]=t.useState(p),[f,j]=t.useState(""),[v,y]=t.useState(""),[N,S]=t.useState(""),[k,C]=t.useState(""),[L,I]=t.useState(0),R=t.useRef(null),{login:T,phoneLogin:q,isLoading:_,error:z,clearError:B}=s(),Q=d(),W=c(),{t:A}=r();t.useEffect(()=>{const e=h.get("lang");e&&["zh-CN","zh-TW","en","ja","ko"].includes(e)&&r.getState().setLocale(e)},[h]);const D=(null==(x=null==(u=W.state)?void 0:u.from)?void 0:x.pathname)||"/";t.useEffect(()=>()=>{R.current&&clearInterval(R.current)},[]);const[E,K]=t.useState(!1);return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx("div",{className:"bg-animated"}),e.jsxs("div",{className:"glass-dark rounded-3xl p-8 w-full max-w-md",children:[!g&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(a,{})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-3 cursor-pointer select-none",onClick:e=>{e.currentTarget.classList.remove("animate-seesaw"),e.currentTarget.offsetWidth,e.currentTarget.classList.add("animate-seesaw"),setTimeout(()=>e.currentTarget.classList.remove("animate-seesaw"),600)},children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:e.jsx("img",{src:i,alt:"Logo",className:"w-10 h-10"})}),e.jsx("span",{className:"text-2xl font-bold text-gradient",children:A("app.name")})]}),e.jsx("p",{className:"text-white/50 mt-2",children:A("login.title")})]}),!g&&e.jsxs("div",{className:"flex gap-1 p-1 bg-white/[0.03] border border-white/[0.06] rounded-xl mb-6",children:[e.jsx("button",{onClick:()=>{b("email"),B()},className:"flex-1 py-2 rounded-lg text-sm font-medium transition-all ".concat("email"===w?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:"邮箱登录"}),e.jsx("button",{onClick:()=>{b("phone"),B()},className:"flex-1 py-2 rounded-lg text-sm font-medium transition-all ".concat("phone"===w?"bg-white/10 text-white":"text-white/50 hover:text-white/70"),children:"手机号登录"})]}),"email"===w&&e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!_)return B(),T(f,v).then(()=>{if(g&&window.KigerBridge){const e=localStorage.getItem("token"),t=localStorage.getItem("user");return void window.KigerBridge.postMessage(JSON.stringify({_t:"cb",_k:e,_u:t}))}Q(D,{replace:!0})}).catch(()=>{}),!1},className:"space-y-5",children:[z&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:z}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:A("login.email")}),e.jsx("input",{type:"email",value:f,onChange:e=>j(e.target.value),placeholder:A("login.email.placeholder"),required:!0,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white/80",children:A("login.password")}),e.jsx(m,{to:"/reset-password",className:"text-sm text-primary hover:text-primary/80 transition",children:A("login.forgotPassword")})]}),e.jsx("input",{type:"password",value:v,onChange:e=>y(e.target.value),placeholder:A("login.password.placeholder"),required:!0,minLength:6,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsx("button",{type:"submit",disabled:_,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:A(_?"login.submitting":"login.submit")})]}),"phone"===w&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!_){B();try{if(await q(N,k,"login"),g&&window.KigerBridge){const e=localStorage.getItem("token"),t=localStorage.getItem("user");return void window.KigerBridge.postMessage(JSON.stringify({_t:"cb",_k:e,_u:t}))}Q(D,{replace:!0})}catch(t){}}},className:"space-y-5",children:[z&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300 text-sm",children:z}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"手机号"}),e.jsx("input",{type:"tel",value:N,onChange:e=>S(e.target.value.replace(/\D/g,"").slice(0,11)),placeholder:"请输入手机号",required:!0,maxLength:11,className:"w-full max-w-full px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border",style:{minWidth:0}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-2",children:"验证码"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:k,onChange:e=>C(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"请输入验证码",required:!0,maxLength:6,className:"flex-1 min-w-0 px-4 py-3.5 input-modern rounded-xl text-white placeholder-white/30 outline-none box-border"}),e.jsx(n,{onSuccess:async e=>{var t,r;if(!N||L>0||_)return{captchaVerifyResult:!0,bizResult:!1};if(!/^1[3-9]\d{9}$/.test(N))return s.setState({error:"请输入正确的手机号"}),{captchaVerifyResult:!0,bizResult:!1};B();try{return await s.getState().sendPhoneCode(N,e,"login"),I(60),R.current&&clearInterval(R.current),R.current=setInterval(()=>{I(e=>e<=1?(R.current&&(clearInterval(R.current),R.current=null),0):e-1)},1e3),{captchaVerifyResult:!0,bizResult:!0}}catch(a){const e=null==(r=null==(t=null==a?void 0:a.response)?void 0:t.data)?void 0:r.retryAfter;throw e&&e>0&&I(Math.min(e,60)),a}},onError:e=>s.setState({error:e}),buttonText:L>0?"".concat(L,"s"):"发送验证码",buttonClassName:"px-4 py-3.5 btn-gradient rounded-xl font-medium text-white transition whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",disabled:L>0||_||!N})]})]}),e.jsx("button",{type:"submit",disabled:_||!k,className:"w-full py-3.5 btn-gradient rounded-xl font-medium text-white transition touch-target disabled:opacity-50",children:_?"登录中...":"登录"})]}),!g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 my-6",children:[e.jsx("div",{className:"flex-1 h-px bg-white/10"}),e.jsx("span",{className:"text-white/30 text-xs",children:"其他登录方式"}),e.jsx("div",{className:"flex-1 h-px bg-white/10"})]}),e.jsxs("button",{type:"button",onClick:async()=>{var e,t,r;K(!0);try{const t=await l.get("/auth/qq");(null==(e=t.data)?void 0:e.url)?window.location.href=t.data.url:(s.setState({error:"QQ 登录服务暂不可用"}),K(!1))}catch(a){s.setState({error:(null==(r=null==(t=a.response)?void 0:t.data)?void 0:r.error)||"QQ 登录请求失败，请稍后重试"}),K(!1)}},disabled:E,className:"w-full py-3 rounded-xl font-medium text-white transition flex items-center justify-center gap-2 hover:opacity-90 disabled:opacity-60",style:{backgroundColor:"#12B7F5"},children:[E?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx("svg",{viewBox:"0 0 48 48",width:"22",height:"22",fill:"white",children:e.jsx("path",{d:"M24 4C16.268 4 10 10.268 10 18c0 2.167.487 4.217 1.357 6.055C8.97 28.326 7 33.392 7 36c0 1.657 1.343 2 3 2 .852 0 1.86-.282 2.87-.746C14.87 40.29 19.09 43 24 43s9.13-2.71 11.13-5.746C36.14 37.718 37.148 38 38 38c1.657 0 3-.343 3-2 0-2.608-1.97-7.674-4.357-11.945A15.89 15.89 0 0038 18c0-7.732-6.268-14-14-14z"})}),E?"跳转中...":"QQ 登录"]})]}),!g&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(m,{to:"/register",className:"text-white/60 hover:text-white transition text-sm",children:A("login.switchToRegister")})}),!g&&e.jsx("div",{className:"mt-6 pt-6 border-t border-white/10 text-center",children:e.jsx(m,{to:"https://kighub.cn/",className:"text-white/50 hover:text-white transition text-sm",children:A("login.backHome")})})]})]})}export{u as default};
