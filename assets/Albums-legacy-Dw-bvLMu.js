!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function s(e,i,o,a){var s=i&&i.prototype instanceof c?i:c,u=Object.create(s.prototype);return t(u,"_invoke",function(e,t,i){var o,a,s,c=0,u=i||[],d=!1,f={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return o=e,a=0,s=n,f.n=t,l}};function m(e,t){for(a=e,s=t,r=0;!d&&c&&!i&&r<u.length;r++){var i,o=u[r],m=f.p,h=o[2];e>3?(i=h===t)&&(s=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=n):o[0]<=m&&((i=e<2&&m<o[1])?(a=0,f.v=t,f.n=o[1]):m<h&&(i=e<3||o[0]>t||t>h)&&(o[4]=e,o[5]=t,f.n=h,a=0))}if(i||e>1)return l;throw d=!0,t}return function(i,u,h){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,h),a=u,s=h;(r=a<2?n:s)||!d;){o||(a?a<3?(a>1&&(f.n=-1),m(a,s)):f.n=s:f.v=s);try{if(c=2,o){if(a||(i="next"),r=o[i]){if(!(r=r.call(o,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,a<2&&(a=0)}else 1===a&&(r=o.return)&&r.call(o),a<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=n}else if((r=(d=f.n<0)?s:e.call(t,f))!==l)break}catch(r){o=n,a=1,s=r}finally{c=1}}return{value:r,done:d}}}(e,o,a),!0),u}var l={};function c(){}function u(){}function d(){}r=Object.getPrototypeOf;var f=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),m=d.prototype=c.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,t(m,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,a,"GeneratorFunction"),t(m),t(m,a,"Generator"),t(m,o,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:h}})()}function t(e,n,r,i){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,i){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},t(e,n,r,i)}function n(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}System.register(["./query-legacy-CLxXWLnl.js","./sentry-legacy-CTr2CudU.js","./index-legacy-DVoFAd51.js","./router-legacy-9xrJEksD.js","./store-legacy-Bt3CCSnU.js"],function(t,i){"use strict";var o,a,s,l,c,u,d,f;return{setters:[function(e){o=e.u,a=e.b,s=e.c,l=e.j},function(e){c=e.a},function(e){u=e.u,d=e.b},function(e){f=e.d},null],execute:function(){function i(t){var i=t.onClose,o=t.onSuccess,a=r(c.useState(""),2),s=a[0],u=a[1],f=r(c.useState(""),2),m=f[0],h=f[1],x=r(c.useState(!0),2),p=x[0],b=x[1],g=r(c.useState(!1),2),v=g[0],y=g[1],j=function(){var t,r=(t=e().m(function t(n){return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n.preventDefault(),s.trim()){e.n=1;break}return e.a(2);case 1:return y(!0),e.p=2,e.n=3,d.post("/albums",{name:s,description:m,isPublic:p});case 3:o(),e.n=5;break;case 4:e.p=4,e.v;case 5:return e.p=5,y(!1),e.f(5);case 6:return e.a(2)}},t,null,[[2,4,5,6]])}),function(){var e=this,r=arguments;return new Promise(function(i,o){var a=t.apply(e,r);function s(e){n(a,i,o,s,l,"next",e)}function l(e){n(a,i,o,s,l,"throw",e)}s(void 0)})});return function(e){return r.apply(this,arguments)}}();return l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[l.jsx("h2",{className:"text-xl font-bold mb-4",children:"创建相册"}),l.jsxs("form",{onSubmit:j,children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"相册名称"}),l.jsx("input",{type:"text",value:s,onChange:function(e){return u(e.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"输入相册名称",required:!0})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述（可选）"}),l.jsx("textarea",{value:m,onChange:function(e){return h(e.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"输入相册描述",rows:3})]}),l.jsx("div",{className:"mb-6",children:l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:p,onChange:function(e){return b(e.target.checked)},className:"rounded text-indigo-600"}),l.jsx("span",{className:"text-sm text-gray-700",children:"公开相册"})]})}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:i,className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50",children:"取消"}),l.jsx("button",{type:"submit",disabled:v||!s.trim(),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:v?"创建中...":"创建"})]})]})]})})}t("default",function(){var e=f().profileId,t=u().user,n=o(),m=r(c.useState(null),2),h=m[0],x=m[1],p=r(c.useState(!1),2),b=p[0],g=p[1],v=a({queryKey:["albums",e],queryFn:function(){return d.get("/albums?profileId=".concat(e)).then(function(e){return e.data})},enabled:!!e}),y=v.data,j=v.isLoading,N=a({queryKey:["album-photos",null==h?void 0:h.id],queryFn:function(){return d.get("/albums/".concat(null==h?void 0:h.id,"/photos")).then(function(e){return e.data})},enabled:!!h}).data,w=s({mutationFn:function(e){return d.post("/albums/".concat(e,"/like"))},onSuccess:function(){return n.invalidateQueries({queryKey:["albums",e]})}}),k=s({mutationFn:function(e){return d.delete("/albums/".concat(e,"/like"))},onSuccess:function(){return n.invalidateQueries({queryKey:["albums",e]})}}),S=(null==y?void 0:y.albums)||[],C=(null==N?void 0:N.photos)||[],L=(null==t?void 0:t.profileId)===e;if(j)return l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})});return l.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h1",{className:"text-2xl font-bold",children:"相册"}),L&&l.jsx("button",{onClick:function(){return g(!0)},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"创建相册"})]}),0===S.length?l.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无相册"}):l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:S.map(function(e){return l.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden cursor-pointer hover:shadow-lg transition-shadow",onClick:function(){return x(e)},children:[l.jsx("div",{className:"aspect-square bg-gray-100",children:e.coverUrl?l.jsx("img",{src:e.coverUrl,alt:e.name,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:l.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),l.jsxs("div",{className:"p-3",children:[l.jsx("h3",{className:"font-medium truncate",children:e.name}),l.jsxs("div",{className:"flex items-center justify-between mt-1 text-sm text-gray-500",children:[l.jsxs("span",{children:[e.photoCount," 张照片"]}),l.jsxs("button",{onClick:function(t){t.stopPropagation(),function(e){e.isLiked?k.mutate(e.id):w.mutate(e.id)}(e)},className:"flex items-center gap-1 ".concat(e.isLiked?"text-red-500":""),children:[l.jsx("svg",{className:"w-4 h-4",fill:e.isLiked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),e.likeCount]})]})]})]},e.id)})}),h&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[l.jsx("h2",{className:"text-xl font-bold",children:h.name}),l.jsx("button",{onClick:function(){return x(null)},className:"p-2 hover:bg-gray-100 rounded-full",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l.jsxs("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-80px)]",children:[h.description&&l.jsx("p",{className:"text-gray-600 mb-4",children:h.description}),0===C.length?l.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无照片"}):l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:C.map(function(e){return l.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:l.jsx("img",{src:e.thumbnail||e.url,alt:e.caption||"",className:"w-full h-full object-cover"})},e.id)})})]})]})}),b&&l.jsx(i,{onClose:function(){return g(!1)},onSuccess:function(){g(!1),n.invalidateQueries({queryKey:["albums",e]})}})]})})}}})}();
