import{j as t}from"./query-DSsWWIdM.js";import{a as e}from"./sentry-DvvTOdwe.js";const n={BASE_URL:"https://cdn-frontend-static.kigermap.com/",DEV:!1,LEGACY:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ALIYUN_CAPTCHA_IDENTITY:"esa-sti6ljl6z5",VITE_ALIYUN_CAPTCHA_PREFIX:"ut6aks",VITE_ALIYUN_CAPTCHA_REGION:"cn",VITE_ALIYUN_CAPTCHA_SCENE_ID:"1wu7t9tq",VITE_AMAP_KEY:"05a185cb1d11ced37ca7d8f96d1a3aec",VITE_AMAP_SECRET:"65bd040d9943b44c16d1870e23fd9de9",VITE_API_URL:"https://api.kigermap.com/v1",VITE_QQ_APP_ID:"102821653"},a=(t,e="")=>{try{if(void 0!==import.meta&&n)return n[t]||e}catch(a){}return e},c=a("VITE_ALIYUN_CAPTCHA_SCENE_ID"),i=a("VITE_ALIYUN_CAPTCHA_PREFIX","ut6aks"),r=a("VITE_ALIYUN_CAPTCHA_REGION","cn");function l({onSuccess:n,onError:a,buttonText:l="获取验证码",buttonClassName:u,disabled:o=!1}){const s=e.useRef(null),[d,p]=e.useState(!1),[h,y]=e.useState(!1),[f,A]=e.useState(!1),I=e.useRef(n),C=e.useRef(a);return e.useEffect(()=>{I.current=n,C.current=a},[n,a]),e.useEffect(()=>{if(!c||!i)return y(!0),void A(!0);if(window.AliyunCaptchaConfig||(window.AliyunCaptchaConfig={region:r,prefix:i}),"function"==typeof window.initAliyunCaptcha)return void y(!0);if(document.getElementById("aliyun-captcha-script")){const t=setInterval(()=>{"function"==typeof window.initAliyunCaptcha&&(clearInterval(t),y(!0))},100);return void setTimeout(()=>{var e;clearInterval(t),"function"!=typeof window.initAliyunCaptcha&&(null==(e=C.current)||e.call(C,"验证码加载超时"))},5e3)}const t=document.createElement("script");t.id="aliyun-captcha-script",t.src="https://o.alicdn.com/captcha-frontend/aliyunCaptcha/AliyunCaptcha.js",t.async=!0,t.onload=()=>{const t=setInterval(()=>{"function"==typeof window.initAliyunCaptcha&&(clearInterval(t),y(!0))},50);setTimeout(()=>clearInterval(t),3e3)},t.onerror=()=>{var t;null==(t=C.current)||t.call(C,"验证码加载失败")},document.head.appendChild(t)},[]),e.useEffect(()=>{if(!h||!c||!s.current)return;if("function"!=typeof window.initAliyunCaptcha)return;return(async()=>{var t;try{await window.initAliyunCaptcha({SceneId:c,mode:"popup",element:"#aliyun-captcha-element",button:"#aliyun-captcha-button",captchaVerifyCallback:async t=>{var e,n,a;p(!0);try{const n=await I.current(t);return{captchaResult:n.captchaVerifyResult,bizResult:null!=(e=n.bizResult)?e:n.captchaVerifyResult}}catch(c){return!1===(null==(a=null==(n=null==c?void 0:c.response)?void 0:n.data)?void 0:a.captchaVerifyResult)?{captchaResult:!1,bizResult:!1}:{captchaResult:!0,bizResult:!1}}finally{p(!1)}},onBizResultCallback:()=>{p(!1)},getInstance:()=>{},slideStyle:{width:360,height:40},language:"cn",onError:()=>{var t;null==(t=C.current)||t.call(C,"验证码加载失败，请刷新页面重试")}}),A(!0)}catch(e){null==(t=C.current)||t.call(C,"验证码初始化失败")}})(),()=>{A(!1)}},[h]),c?t.jsx("div",{id:"aliyun-captcha-element",ref:s,children:t.jsx("button",{id:"aliyun-captcha-button",type:"button",disabled:o||d||!f,className:u||"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm whitespace-nowrap",children:d?"验证中...":f?l:"加载中..."})}):t.jsx("button",{type:"button",onClick:()=>n("").catch(()=>{}),disabled:o||d,className:u||"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm whitespace-nowrap",children:l})}export{l as A};
